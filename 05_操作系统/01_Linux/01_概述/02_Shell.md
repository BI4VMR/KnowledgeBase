# 简介
操作系统的内核控制各种硬件协同运作，但用户无法直接操纵内核。Shell是一个命令行解释器，它是用户与Linux内核交互的桥梁，用户通过Shell向系统发送指令，系统就会执行相应的操作。

Linux中的Shell有若干不同实现，其中较为常用的几种如下文列表所示：

- Bourne Shell(sh)
- Bourne Again Shell(bash)
- C Shell(csh)
- Korn Shell(ksh)
- Z Shell(zsh)

# Bash
## 简介
Bourne Shell是Unix最初使用的Shell，在Shell脚本编程方面十分优秀，但在用户交互方面不如其他几种Shell。大部分发行版默认使用Bourne Again Shell，它是Bourne Shell的扩展，简称"bash"，提供了命令补全、命令历史记录等实用的功能。

用户登录到控制台后，屏幕上将会显示“命令提示符”，用于显示重要的状态信息。

Redhat系列发行版的命令提示符如下文图片所示：

<div align="center">

![Redhat系列命令提示符](./Assets_Shell/Bash_Redhat系列命令提示符.jpg)

</div>

用户身份为管理员时权限显示为"#"，否则显示为"$"。

部分命令可以根据需要添加选项， `-<选项>` 是简化选项，使用单个字符表示，若选项携带参数，必须单独书写，如： `tail -n 2` ；多个不携带参数的选项可连续书写，例如： `tar -zxvf` 。 `--<选项>` 是完整选项，使用单词表示，通常是不常用的功能。

Shell命令分为两种：一种是Shell内置命令，没有独立的可执行文件；另一种是外置命令，有独立的可执行文件，执行 `type <命令>` 可以查看指定命令是否为内置命令。

```text
# "cd"为内置命令
[root@Fedora ~]# type cd
cd is a shell builtin

# "top"为外置命令
[root@Fedora ~]# type top
top is /usr/bin/top
```

Bash允许用户在键入部分字符后，按 `Tab` 键自动补全命令，但默认情况下仅能补全命令本身，无法补全命令的二级菜单与参数。我们可以安装软件包"bash-completion"，它提供了常用命令的二级菜单与参数补全，能够使Bash更加易用。

## 快捷键
Shell定义了一些快捷键，可以帮助我们提高操作效率，常用的快捷键详见下文表格：

<div align="center">

|  快捷键  |          用途          |
| :------: | :--------------------: |
| `Ctrl+C` |    强制终止当前命令    |
| `Ctrl+Z` | 将当前命令转为后台执行 |
| `Ctrl+R` |      搜索历史命令      |
| `Ctrl+L` |          清屏          |
| `Ctrl+A` |      光标移至行首      |
| `Ctrl+E` |      光标移至行尾      |
| `Ctrl+U` |  从光标位置删除至行首  |
| `Ctrl+K` |  从光标位置删除至行尾  |
| `Ctrl+D` |          注销          |

</div>

## 级联命令
我们可以使用一行命令，在Shell中执行多个语句，相关语法详见下文表格：

<div align="center">

| 执行符 |          格式          |             说明             |
| :----: | :--------------------: | :--------------------------: |
|  `;`   |   `<命令1>; <命令2>`   |      顺序执行，无联系。      |
|  `&&`  |  `<命令1> && <命令2>`  | 命令1执行成功后命令2才能执行 |
| `\|\|` | `<命令1> \|\| <命令2>` | 命令1执行失败后命令2才能执行 |

</div>

## 命令提示符
### 简介
命令提示符展示了当前用户、主机名、用户权限等信息，便于操作者了解自身所处的环境，各大发行版的默认命令提示符存在差异，我们也可以按需定制提示符样式。

### 提示符格式
环境变量 `PS1` 用于控制提示符的格式，我们可以修改变量值以定义个性化的提示符。使用 `export PS1=<字符串>` 命令能够为环境变量赋予新的值，将该语句写入 `/etc/bash.bashrc` 文件时全局生效（可能会被用户的私有配置覆盖）；写入用户主目录中的 `.bashrc` 配置文件时，仅对指定用户的Bash生效。

执行以下命令可以查看默认的提示符格式：

```text
[root@Fedora ~]# echo $PS1
[\u@\h \W]\$
```

其中各占位符的含义可参考下文表格：

<div align="center">

| 占位符 |         含义         |
| :----: | :------------------: |
|  `\u`  |        用户名        |
|  `\h`  |        主机名        |
|  `\H`  |      完整主机名      |
|  `\w`  | 当前目录（绝对路径） |
|  `\W`  |       当前目录       |
|  `\d`  |         日期         |
|  `\t`  | 时间（24H HH:MM:SS） |
|  `\T`  | 时间（12H HH:MM:SS） |
|  `\A`  |  时间（24H HH:MM）   |
|  `\$`  |       用户权限       |
|  `\#`  |       命令序号       |
|  `\v`  |      解释器版本      |

</div>

🔴 示例一

Fedora系统的提示符默认仅显示最后一级目录，我们将其改为绝对路径。

```text
# 编辑当前用户Home目录下的".bashrc"文件
[root@Fedora ~]# nano ~/.bashrc
# 在文件末尾添加以下内容
export PS1='[\u@\h \w]\$ '

# 保存文件后重新登录
[root@Fedora ~]# logout
# 进入某个层次较深的目录，并观察提示符变化。
[root@Fedora ~]# cd /var/lib/systemd/
[root@Fedora /var/lib/systemd]#
```

### 提示符颜色
Shell支持输出符合ANSI标准的特殊文字，对于提示符同样可用，我们可以更改文本的颜色，突出显示重要的信息。

ANSI是ASCII标准的扩展，控制码均以"Esc"作为起始符号，"Esc"的八进制码为"33"，因此ANSI控制码标准格式为 `"\033[Nm"` ，在Shell中记作 `"\[\e[Nm\]"` ，其中"N"表示属性，同时设置多个属性时需使用分号(";")隔开，相关属性详见下文表格：

<div align="center">

| 标记  |     符号     |     含义     |
| :---: | :----------: | :----------: |
|   0   | `\[\e[0m\]`  | 清除所有属性 |
|   1   | `\[\e[1m\]`  |     高亮     |
|   2   | `\[\e[2m\]`  |   取消高亮   |
|   4   | `\[\e[4m\]`  |    下划线    |
|   5   | `\[\e[5m\]`  |     闪烁     |
|   7   | `\[\e[7m\]`  |     反色     |
|   8   | `\[\e[8m\]`  |     消隐     |
| 30-37 | `\[\e[32m\]` |   文本颜色   |
| 40-47 | `\[\e[46m\]` |   背景颜色   |

</div>

ANSI支持8种颜色，书写在"3"或"4"的后一位，使用数字0-7表示，详见下文表格：

<div align="center">

| 数值  | 颜色  |
| :---: | :---: |
|   0   | 黑色  |
|   1   | 红色  |
|   2   | 绿色  |
|   3   | 黄色  |
|   4   | 蓝色  |
|   5   | 洋红  |
|   6   | 青色  |
|   7   | 白色  |

</div>

若需要设置文本颜色为红色，只需在文本前添加 `"\[\e[31m\]"` 即可，若还需要高亮显示此文本，则控制符记作 `"\[\e[31;1m\]"` 。当我们设置ANSI控制符后，Shell将会一直沿用此格式，因此不再需要特殊文本时，须插入控制符 `"\[\e[0m\]"` 清除格式。

🟠 示例二

将命令提示符设为下图所示的格式（此远程管理工具默认颜色即为绿色）。

<div align="center">

![彩色提示符示例](./Assets_Shell/Bash_彩色提示符示例.jpg)

</div>

编辑 `~/.bashrc` 文件，添加以下配置，保存文件并重新登录系统即可。

```text
[root@Fedora ~]# nano ~/.bashrc
# 在文件末尾添加以下内容
export PS1='[\[\e[35;1m\]\u\[\e[0m\]@\[\e[36;1;1m\]\h\[\e[0m\] \[\e[33;1m\]\w\[\e[0m\]]\$ '
```

### 修复命令提示符
若用户登录后，提示符显示为 `-bash-4.2$` ，可能是用户将其主目录中 `.bashrc` 等文件误删，此时可以从 `/etc/skel/` 目录中复制相应的文件至该用户的主目录，恢复默认的提示符。

```text
# 进入"/etc/skel"目录
-bash-4.2$ cd /etc/skel
-bash-4.2$ ls -a
.  ..  .bash_logout  .bash_profile  .bashrc

# 复制丢失的Bash配置文件
-bash-4.2$ cp .bash_profile ~
-bash-4.2$ cp .bash_logout ~
-bash-4.2$ cp .bashrc ~

# 进入当前用户的主目录
-bash-4.2$ cd ~
-bash-4.2$ ll -a
total 12
drwx------  2 user1 user1  62 Oct 31 15:50 .
drwxr-xr-x. 3 root  root   19 Oct 31 15:45 ..
-rw-r--r--  1 user1 user1  18 Oct 31 15:50 .bash_logout
-rw-r--r--  1 user1 user1 193 Oct 31 15:50 .bash_profile
-rw-r--r--  1 user1 user1 231 Oct 31 15:50 .bashrc

# 注销
-bash-4.2$ logout

# 重新登录，查看命令提示符是否恢复。
[user1@Fedora ~]$
```
