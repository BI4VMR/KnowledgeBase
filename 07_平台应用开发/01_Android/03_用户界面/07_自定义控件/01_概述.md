# 基本应用
下文将以组合多个控件的方式为例，实现一个名片控件，展示自定义控件的基本方法。

我们首先创建一个布局文件并放置若干控件，用于描述“名片”的外观。

"business_card.xml":

```xml
<!-- 此处省略不重要的属性... -->
<androidx.constraintlayout.widget.ConstraintLayout
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:background="@drawable/shape_business_card_background">

    <ImageView
        android:id="@+id/ivAvatar"
        android:layout_width="64dp"
        android:layout_height="64dp" />

    <TextView
        android:id="@+id/tvName"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        tools:text="[名称]" />

    <TextView
        android:id="@+id/tvPhone"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        tools:text="[电话号码]" />
</androidx.constraintlayout.widget.ConstraintLayout>
```

布局文件中的ImageView用于显示头像，两个TextView分别用于显示姓名和电话号码。

接下来，我们创建BusinessCard类，实现控件内部逻辑并加载上述的布局文件。

"BusinessCard.java":

```java
public class BusinessCard extends FrameLayout {

    private ImageView ivAvatar;
    private TextView tvName;
    private TextView tvPhone;

    // 构造方法1
    public BusinessCard(@NonNull Context context) {
        super(context);
        // 将布局文件渲染生成View实例
        View view = LayoutInflater.from(context).inflate(R.layout.business_card, this, true);
        // 获取View实例中各个子元素的引用
        ivAvatar = view.findViewById(R.id.ivAvatar);
        tvName = view.findViewById(R.id.tvName);
        tvPhone = view.findViewById(R.id.tvPhone);
    }

    // 构造方法2
    public BusinessCard(@NonNull Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
        /* 初始化操作 ... */
    }

    // 构造方法3
    public BusinessCard(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        /* 初始化操作 ... */
    }

    // 构造方法4
    public BusinessCard(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr, int defStyleRes) {
        super(context, attrs, defStyleAttr, defStyleRes);
        /* 初始化操作 ... */
    }

    // 更新文本与图像资源
    public void updateInfo(String name, String phone, @DrawableRes int avatarResID) {
        tvName.setText(name);
        tvPhone.setText(phone);
        ivAvatar.setImageResource(avatarResID);
    }
}
```

上述内容也可以使用Kotlin语言书写：

"BusinessCardKT.kt":

```kotlin
class BusinessCardKT : FrameLayout {

    private val binding: BusinessCardBinding by lazy {
        // 将布局文件渲染生成View实例
        BusinessCardBinding.inflate(LayoutInflater.from(context), this, true)
    }

    // 构造方法1
    constructor(context: Context) : super(context)

    // 构造方法2
    constructor(context: Context, attrs: AttributeSet?) : super(context, attrs)

    // 构造方法3
    constructor(context: Context, attrs: AttributeSet?, defStyleAttr: Int) : super(context, attrs, defStyleAttr)

    // 构造方法4
    constructor(context: Context, attrs: AttributeSet?, defStyleAttr: Int, defStyleRes: Int) : super(
        context,
        attrs,
        defStyleAttr,
        defStyleRes
    )

    // 更新文本与图像资源
    fun updateInfo(name: String, phone: String, @DrawableRes avatarResID: Int) {
        with(binding) {
            tvName.text = name
            tvPhone.text = phone
            ivAvatar.setImageResource(avatarResID)
        }
    }
}
```

View实例拥有四个构造方法，我们至少要选择其中的一个并实现它。当我们在代码中创建控件实例时，通常会调用 `BusinessCard(Context context)` 构造方法，此处需要实现控件的初始化逻辑；当系统加载布局文件时，将会调用 `BusinessCard(Context context, AttributeSet attrs)` 构造方法，第二参数 `attrs` 表示XML中的属性，此处需要实现控件的初始化逻辑，并解析XML属性。

上述示例代码中的“构造方法1”和“构造方法2”通常是必选的，另外两个构造方法中的参数 `defStyleAttr` 和 `defStyleRes` 与主题有关，系统不会主动调用它们，仅当使用者在代码中创建控件实例时可以选择它们。如果我们并不关心主题，也可以不实现这两个构造方法。

> ⚠️ 警告
>
> 当我们使用ViewBinding时，获取视图绑定实例阶段应当调用具有3个参数的 `inflate()` 方法，并将 `attachToParent` 参数置为"true"；否则布局将不会自动关联到顶层容器，导致程序运行时控件显示为空白画面。

自定义方法 `updateInfo()` 即BusinessCard控件对外暴露的接口，此处我们将文本与图片资源分别设置到对应的控件中。

至此，自定义控件“名片”已经封装完毕了。由于本示例并未实现XML属性解析逻辑，因此我们在代码中构造BusinessCard实例并调用 `updateInfo()` 方法设置控件的属性。

"TestUIBase.java":

```java
// 构建BusinessCard实例
BusinessCard businessCard = new BusinessCard(this);
// 设置文本与图像
businessCard.updateInfo("田所浩二", "11451419198", R.drawable.ic_funny_256);
// 将其添加到布局中
binding.container.addView(businessCard);
```

上述内容也可以使用Kotlin语言书写：

"TestUIBaseKT.kt":

```kotlin
// 构建BusinessCard实例
val businessCard = BusinessCardKT(this)
// 设置文本与图像
businessCard.updateInfo("田所浩二", "11451419198", R.drawable.ic_funny_256)
// 将其添加到布局中
binding.container.addView(businessCard)
```

此时运行示例程序，并查看界面外观：

<!-- TODO... -->
