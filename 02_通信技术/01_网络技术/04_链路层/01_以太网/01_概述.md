# 简介
以太网(Ethernet)最早由Xerox PARC与1975年研究成功，最初是一种基于CSMA/CD的基带总线网络，速率为2.94Mbps。由于初代以太网使用无源电缆传输数据帧，就以传播电磁波的物质“以太(Ether)”命名了。

1980年，由DEC、Intel和Xerox联合标准化形成了DIX Ethernet Ⅰ标准。到了1982年，标准化组织提出DIX Ethernet Ⅱ标准，主要更改了DIX Ethernet Ⅰ的电气特性和物理接口，在帧格式上并无变化。

1983年IEEE将Ethernet Ⅱ标准略作修改后定义为IEEE 802.3标准。为了使数据链路层能兼容多种局域网标准，IEEE委员会将数据链路层又细分成两个子层；与传输介质有关的标准都放在MAC子层，而逻辑控制相关标准则放在LLC子层，为网络层提供统一的接口。

Ethernet Ⅱ是被当今局域网广泛采用的通信协议标准，IEEE 802.3标准通常仅供学术研究使用，我们描述以太网的速率时也会使用IEEE 802.3标准（100Base-T4等）。

# 术语
## 逻辑链路控制子层
逻辑链路控制(Logical Link Control, LLC)子层是数据链路层中的上层部分，它在数据帧内附加了目的地址服务接入点和源地址服务接入点信息，用以兼容不同的网络类型。

LLC层可以实现无连接、带有确认功能的无连接和面向连接三种工作方式。由于当前的TCP/IP体系通常使用Ethernet Ⅱ标准，因此较少使用LLC子层。

## 介质访问控制子层
介质访问控制(Media Access Control, MAC)子层是数据链路层中的下层部分，它的主要功能是链路层编址与通信控制。

介质访问控制地址，也称为MAC地址、物理地址或硬件地址，用于在同一局域网中唯一标识每个接口。

MAC地址采用十六进制表示，共6字节(48bit)，其中前三字节由IEEE的注册管理机构RA负责分配给不同的厂家，称为编制上唯一的标识符(Organizationally Unique Identifier, OUI)，后三字节由各厂家自行指派给设备接口，称为扩展标识符。

OUI中左起第7位是Global/Local位，取值为"0"时表示全局地址，取值为"1"时表示本地地址，在以太网中全部使用全局地址。左起第8位是Individual/Group位，取值为"0"时表示节点地址，取值为"1"时则表示组播地址。

MAC地址有以下几种常见的书写格式：

```text
思科：XXXX.XXXX.XXXX

微软：XX-XX-XX-XX-XX-XX

其它：XX:XX:XX:XX:XX:XX
```

出厂内置在设备固件中的MAC地址通常无法更改，部分设备的驱动程序提供了修改MAC地址的功能，例如：有线网卡和虚拟网卡，当我们设置新的MAC地址后，设备就不再使用固件内置MAC地址进行通信了。

有些MAC地址具有特殊的用途，设备厂商不应当使用这些地址，我们自定义MAC地址时也不能填写这些值。

<div align="center">

|      MAC地址      |            用途            |
| :---------------: | :------------------------: |
| 01-00-0C-CC-CC-CC |       Cisco VTP协议        |
| 01-00-0C-CC-CC-CD | Cisco PVST/PVST+/RPVST协议 |
| 01-80-C2-00-00-00 |       标准生成树协议       |
| 01-80-C2-00-00-01 |        Pause流控帧         |
| 01-80-C2-00-00-02 |           LACP帧           |
| FF-FF-FF-FF-FF-FF |       链路层广播地址       |

</div>

## 冲突域
通信冲突产生时，冲突碎片影响到的设备与链路集合即为冲突域(Collision Domain)。

共享式以太网的冲突域为整个集线器；交换式以太网的冲突域为交换机的每个端口。

## 广播域
某台设备发送的广播消息可以被一组设备接收，该组设备的集合即广播域(Broadcast Domain)。

## 最大传输单元
最大传输单元(Maximum Transmission Unit, MTU)是指网络的某层次上所能通过的最大数据单元大小，通常以字节为单位。该数值越大，通信效率越高，传输延迟和出错概率也随之增大，所以要权衡通信效率和传输延迟选择合适的MTU值。

## 最小帧间隔
网络设备接收完一个数据帧之后，需要一段短暂的时间来恢复并为接收下一帧做准备。我们使用帧间隔(Interframe Gap, IFG)描述相邻两帧之间的间隔大小，以太网的最小帧间隔是12字节(96bit)。

# 工作方式
## 半双工
同一时刻只能接收或发送数据，采用CSMA/CD控制方式，逻辑上有最大距离限制。

## 全双工
同一时刻可以接收和发送数据，无需CSMA/CD方式，逻辑上无最大距离限制。

## 自动协商
自动设置双工模式和速率，只适用于双绞线介质。

# Ethernet Ⅱ的帧结构
Ethernet Ⅱ的帧结构在RFC 894中定义，各部分的名称如下图所示：

<div align="center">

![Ethernet Ⅱ的帧结构](./Assets-概述/Ethernet2的帧结构-Ethernet2的帧结构.jpg)

</div>

🔷 Dest

目的MAC地址。

🔷 Src

源MAC地址。

🔷 Type

上层协议类型，长度2字节。

表明该帧内部封装的上层协议类型，取值必定大于1536(0x0600)。

常见的上层协议与对应的值如下文表格所示：

<div align="center">

|  数值  |      协议       |
| :----: | :-------------: |
| 0x0800 |      IPv4       |
| 0x0805 |  X.25 Level 3   |
| 0x0806 |       ARP       |
| 0x0835 |      RARP       |
| 0x80F3 |  AppleTalk ARP  |
| 0x8137 |       IPX       |
| 0x86DD |      IPv6       |
| 0x8809 |      LACP       |
| 0x880B |       PPP       |
| 0x8847 |  MPLS Unicast   |
| 0x8848 | MPLS Multicast  |
| 0x8863 | PPPoE Discovery |
| 0x8864 |  PPPoE Session  |
| 0x88CC |      LLDP       |

</div>

🔷 Data

有效数据载荷。

通常是网络层的数据包，最小长度为46字节，最大长度通常为1500字节。

🔷 FCS

帧校验序列，长度4字节。

发送方使用CRC算法计算所有其他字段的校验码并填入FCS字段，接收方使用同样的方法进行CRC计算，将得到的结果与收到的FCS字段做对比，如果值不一致，就表示帧在传输过程中受到了干扰，需要丢弃。

<br />

除了以上内容，以太网帧前部还包含一些控制信息，首先是重复7次的"10101010"，称为前导字段(Preamble)，用于信号同步，传输时使用LSB方式；随后是"10101011"，称为帧起始定界符，表示一个帧的开始。

# IEEE 802.3的帧结构
IEEE 802.3帧格式类似于Ethernet Ⅱ帧，只是将Type字段变更为Length字段，并且额外占用有效载荷中的8个字节作为LLC和SNAP字段。

IEEE 802.3的帧结构各部分名称如下图所示：

<div align="center">

![IEEE 802.3的帧结构](./Assets-概述/IEEE802.3的帧结构-IEEE802.3的帧结构.jpg)

</div>

🔷 Dest

目的MAC地址。

🔷 Src

源MAC地址。

🔷 Length

控制信息与数据载荷长度，长度2字节。

表示LLC、SNAP和Data字段的总长度，不包括FCS字段。单位为字节，最小值为46(0x002E)，最大值为1500(0x05DC)。

🔷 Data

有效数据载荷。

🔷 FCS

帧校验序列，长度4字节。

<br />

逻辑链路控制(Logical Link Control, LLC)部分主要包括以下字段：

🔶 DSAP

目的服务访问点(Destination Service Access Point)，长度1字节。

用于指明目的上层协议类型。

🔶 SSAP

源服务访问点(Source Service Access Point)，长度1字节。

用于指明源上层协议类型。

🔶 Ctrl

控制信息字段，长度1-2字节。

LLC数据报为1字节(0x03)，是不可靠连接；LLC会话为2字节，是可靠连接。

<br />

子网访问协议(Sub-network Access Protocol, SNAP)部分主要包括以下字段：

🔷 Org Code

机构代码，长度3字节。

该字段通常不使用，取值为"0"。

🔷 Type

上层协议类型，长度2字节。

该字段的含义与Ethernet Ⅱ帧中的Type字段相同。

<br />

根据LLC字段的取值，IEEE 802.3帧可分为以下类型：

🔺 Netware-Ethernet

当DSAP和SSAP都取"0xFF"时，该帧为Netware-Ethernet帧，用于承载NetWare数据。

🔺 Ethernet-SNAP

当DSAP和SSAP都取"0xAA"时，该帧为Ethernet-SNAP帧，能够承载多种协议，可以用于实现自定义的链路层协议。

🔺 IEEE 802.3

当DSAP和SSAP取其它值时，该帧为普通的IEEE 802.3帧。

# IEEE 802.3系列标准
## 标准以太网
IEEE 802.3最初规定了6种以太网标准，分别如下表所示：

<div align="center">

|   名称    | 速率(Mbps) | 传输介质 | 拓扑形式 | 信号类型 | 最大段长(m) |
| :-------: | :--------: | :------: | :------: | :------: | :---------: |
|  1Base5   |     1      |   UTP    |   星型   |   基带   |     250     |
|  10Base2  |     10     |   细缆   |  总线型  |   基带   |     185     |
|  10Base5  |     10     |   粗缆   |  总线型  |   基带   |     500     |
| 10Broad36 |     10     | CATV电缆 |  总线型  |   宽带   |    3600     |
| 10Base-T  |     10     |   UTP    |   星型   |   基带   |     100     |
| 10Base-F  |     10     |   光纤   |   星型   |   基带   |  500/2000   |

</div>

由此可知各个标准的命名规范：

- 第一个数字表示最大带宽。
- 第二个单词表示信号类型，基带信号为"Base"，宽带信号为"Broad"。
- 末尾是数字时表示无中继最大传输距离。
- 末尾是字母时表示介质类型，"T"表示双绞线，"F"表示光纤，"C"表示屏蔽电缆。

## 快速以太网
1995年3月IEEE公布了IEEE 802.3u快速以太网(Fast Ethernet, FE)标准，数据速率可以达到100Mbps，是标准以太网的十倍，并且基本布线系统可以不做改变，从此进入了快速以太网的时代。

快速以太网包含以下标准：

🔷 100Base-T2

100Base-T2使用两对3类双绞线，应用较少。

🔷 100Base-T4

100Base-T4使用四对3类双绞线，其中三对用于传输数据，一对用于检测冲突信号。

该标准使用8B/6T编码方式，信号频率为25MHz，最大段长为100米，应用较少。

🔷 100Base-TX

100Base-TX使用两对5类双绞线，一对用于发送，一对用于接收。

该标准使用4B/5B编码方式，信号频率为125MHz，最大段长为100米，支持全双工数据传输。

🔷 100Base-FX

100Base-FX使用一对光缆，可使用单模或多模光纤（62.5或125um）。

该标准使用4B/5B编码方式，信号频率为125MHz，最大段长为150m、412m、2km或10km，支持全双工数据传输；适用于有电气干扰、长距离通信、高保密环境等情况。

<br />

IEEE 802.3u标准还定义了10Mbps与100Mbps的自动协商功能，100Mbps网卡初始化时会首先发送快速链路脉冲(Fast Link Pulse, FLP)，这是一种33位二进制信号，前17位用于同步，后16位为协商信息。10Mbps网卡只会发出正常链路脉冲(Normal Link Pulse, NLP)，两端设备根据这些脉冲信号就能自动协商出最佳的工作模式。

## 千兆以太网
千兆以太网和标准以太网、快速以太网完全兼容，当前已经发展成为主流的局域网技术。

1998年6月IEEE公布了IEEE 802.3z标准，其中包括使用单模光纤、多模光纤与屏蔽双绞线实现1000Mbps速率通信的标准；1999年6月，IEEE又正式批准了IEEE 802.3ab标准(1000Base-T)，可以使用非屏蔽双绞线构建千兆以太网。

千兆以太网包含以下标准：

🔶 1000Base-LX

1000Base-LX中的LX代表长波，波长为1270nm-1355nm，所使用的光纤主要有：62.5μm、50μm多模光纤或9μm单模光纤，其中多模光纤最大传输距离为550米，单模光纤最大传输距离为5千米，采用8B/10B编码方式。

🔶 1000Base-SX

1000Base-SX中的SX代表短波，波长为770nm-860nm，只能使用多模光纤，所使用的光纤为62.5μm或50μm多模光纤。其中62.5μm多模光纤最大传输距离为275米，50μm多模光纤最大传输距离为550米，采用8B/10B编码方式。

🔶 1000Base-CX

1000Base-CX采用150Ω平衡屏蔽双绞线，使用9芯D型连接器，最大传输距离25米，采用8B/10B编码方式，适用于交换机、服务器之间的短距离连接。

🔶 1000Base-ZX

1000Base-ZX是Cisco制定的千兆以太网标准，使用1550nm长波激光，在单模光纤链路上，最大通信距离可达70km，采用8B/10B编码方式。

🔶 1000Base-T

1000Base-T采用四对五类平衡双绞线，两对用于接收，两对用于发送，最远传输距离可达100米，采用8B/10B编码方式。

该标准可以兼容10/100Mbps以太网技术，因此成为价格低廉并具有良好性能的标准，应用最为广泛。

## 万兆以太网
2002年6月，IEEE 802.3ae标准发布，其支持10Gbps的传输速率，并且基于星型拓扑的交换式以太网，仅支持全双工模式，不再使用CSMA/CD技术。

IEEE 802.3ae主要是以光纤为传输介质的10G标准：

🔷 10GBase-SR

10GBase-SR中的"SR"是"short range"的缩写，表示仅用于短距离链路。该标准使用的编码方式为64B/66B，支持短波(850nm)多模光纤，最大传输距离为300米。

🔷 10GBase-LR

10GBase-LR中的"LR"是"Long Range"的缩写，表示用于长距离链路。该标准使用的编码方式为64B/66B，支持长波(1310nm)单模光纤，最大传输距离为10千米。

🔷 10GBase-ER

10GBase-ER中的"ER"是"Extended Range"的缩写，表示用于超长距离链路。该标准使用的编码方式为64B/66B，支持超长波(1550nm)单模光纤，最大传输距离为40千米。

<br />

随着技术发展，后来又出现了一些新的万兆以太网标准。

🔶 10GBase-ZR

几个厂商在OC-192/STM-64 SDH/SONET规范中提出了传输距离可达到80km的超长距离标准，这就是10GBase-ZR，使用超长波(1550nm)单模光纤。

🔶 10GBase-LX4

10GBase-LX4采用波分复用技术，通过4路波长统一为1300nm，速率为3.125Gb/s的分离光源来实现10Gb/s传输。该规范使用多模光纤时最大传输距离为300米，使用单模光纤时最大传输距离可达10千米。

10GBase-LX4主要适用于需要在一个光纤模块中同时支持多模和单模光纤的环境。因为10GBase-LX4规范采用了4路激光光源，所以在成本、光纤线径和功耗方面较10GBase-LRM有不足之处。

🔶  10GBase-LRM

10GBase-LRM中的"LRM"代表“长度延伸多点模式(Long Reach Multimode)”，对应的标准为2006年发布的IEEE 802.3aq。在OM3光纤中最大传输距离可达260米，低于10GBase-LX4规范，但它的光纤模块比10GBase-LX4更便宜且低功耗。

🔶  10GBase-CX4

10GBase-CX4对应2004年发布的IEEE 802.3ak标准，使用IEEE 802.3ae中定义的XAUI（万兆附加单元接口）和InfiniBand中的4X连接器，传输介质称为“CX4铜缆”（一种屏蔽电缆），它的有效传输距离仅为15米。

<div align="center">

![CX4电缆](./Assets-概述/IEEE802.3系列标准-CX4电缆.jpg)

</div>

10GBase-CX4使用4路独立信道来传送万兆数据，每条信道利用8B/10B编码，以3.125GHz的波特率传送2.5Gbps的数据。

该标准的优势是电源消耗少、成本较低、响应延时低；但是接口体积较大，且CX4电缆需要在工厂端接，无法手工制作。

🔶 10GBase-T

10GBase-T来自2006年发布的IEEE 802.3an标准，其使用双绞线作为传输介质，在6类双绞线上最大传输距离为55米，而在6a类双绞线上可以达到100米。

10GBase-T是万兆以太网的一项革命性进步，在此之前，人们认为双绞线不可能实现这么高的传输速率，因为双绞线运行在较高频率时损耗太大。该标准使用四项技术使10GBase-T成为现实：损耗消除、模拟/数字信号转换、线缆性能增强和编码方式改进。

🔶 10GBase-KX4和10GBase-KR

该系列标准仅用于设备背板，存在并行和串行两种版本。

并行版本(10GBase-KX4)是背板的通用设计，将万兆信号拆分为4条通道，每条通道的带宽都是3.125Gbps。串行版本(10GBase-KR)中只定义了一条通道，采用64/66B编码方式实现10Gbps高速传输。

# 以太网网卡
终端设备通过网络接口卡(Network Interface Card, NIC)接入网络中，网络接口卡简称网卡，包括控制器、缓存、收发电路、ROM等部分，它与终端设备的I/O通道相连，在计算机系统中作为一种输入/输出设备工作。

网卡根据具体的网络类型而设计，随着以太网的普及，目前应用最多的就是以太网网卡，很多计算机主板也集成了网卡组件，用户不需要额外购买即可使用。

以下图片展示的是一种使用双绞线电缆作为传输介质的以太网网卡：

<div align="center">

![RJ45网卡](./Assets-概述/以太网网卡-RJ45网卡.jpg)

</div>

除了常见的铜缆接口网卡之外，对速率要求较高的场合也会使用光纤网卡。

<div align="center">

![SFP网卡](./Assets-概述/以太网网卡-SFP网卡.jpg)

</div>
