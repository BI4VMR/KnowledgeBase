# 简介
Broadcast是Android中的一种系统级消息机制，它与“发布-订阅”设计模式相似。每个应用程序可以声明自身感兴趣的事件，例如：充电完成、屏幕锁定等；当事件发生时，系统会向感兴趣的应用发送广播消息，应用程序收到广播后可以执行对应的操作。广播通常用于跨应用或系统级的消息传递，但是开发者不能滥用广播机制，否则可能会导致系统性能问题。

我们根据处理机制可以将广播分为普通广播与有序广播，普通广播同时发送给所有接收者，每个接收者都是平等的；有序广播按照优先级单点传递给最优先的接收者，接收者可以传递给次优先的接收者，也可以将其截断，终止消息传递。

# 调试工具
## ADB命令
为了测试广播接收器是否能够正常工作，我们可以使用ADB命令模拟广播事件，该功能有助于减少部分测试代码。

发送广播事件的ADB命令基本语法如下文代码块所示：

```text
ADB$ am broadcast -a <Action字符串> [-e <额外数据的键名> <数据值>]
```

假设我们需要发送Action为"net.bi4vmr.MY_BROADCAST"的广播消息，可以使用以下命令：

```text
ADB$ am broadcast -a "net.bi4vmr.MY_BROADCAST"
```

如果我们需要模拟携带额外数据的广播消息，可以添加 `-e` 选项。

```text
ADB$ am broadcast -a "net.bi4vmr.MY_BROADCAST" -e "message" "This is extra message."
```

`-e` 选项的数据类型为字符串，除此之外，还有一些选项可供设置其他数据类型：

- `--es` : 字符串，等同于 `-e` 选项。
- `--ez` : 布尔值。使用示例： `--ez "key" true` 。
- `--ei` : 整型。使用示例： `--ei "key" 1` 。
- `--el` : 长整型。使用示例： `--el "key" 1` 。
- `--ef` : 浮点数。使用示例： `--ef "key" 0.1` 。
- `--eia` : `int[]` 。使用示例： `--eia "key" 1,2,100` 。
- `--eial` : `List<Integer>` 。使用示例： `--eial "key" 1,2,100` 。
- `--ela` : `long[]` 。
- `--elal` : `List<Long>` 。
- `--efa` : `float[]` 。
- `--efal` : `List<Float>` 。
- `--esa` : `String[]` 。
- `--esal` : `List<String>` 。

上述选项中不包含"double"类型及对应的数组与列表，因此我们无法通过ADB命令模拟这种数据。

> 🚩 提示
>
> 仅有 `-e` 选项的前导符号为单横杠( `-` )，其他选项的前导符号均为双横杠( `--` )。
>
> 如果我们输入 `-ei "Key" 100` 等语法不正确的命令，Shell会将第2个参数"100"解析为包名，而不会报错，这会产生广播已发送但接收端未收到消息的假象。

# 版本变更
## 索引

<div align="center">

|       序号        |   版本    |          摘要          |
| :---------------: | :-------: | :--------------------: |
| [变更一](#变更一) | Android 8 | 静态注册广播接收器限制 |

</div>

## 变更一
### 摘要
自从Android 8开始，静态注册广播接收器将受到限制。

### 详情
静态注册的广播接收器会占用更多的系统性能，为防止开发者滥用此类广播，自从Android 8开始，大部分广播均不再支持静态注册，只能在代码中动态注册。

我们可以访问 [🔗 隐式广播例外情况](https://developer.android.google.cn/guide/components/broadcast-exceptions?hl=zh-cn) 页面以查询目前仍然允许静态注册的广播信息：
