# ç®€ä»‹
å½“ç³»ç»Ÿå‘ç”Ÿå…³é”®äº‹ä»¶ï¼ˆä¾‹å¦‚æ—¶åŒºå˜æ›´ã€ç³»ç»Ÿå¯åŠ¨å®Œæ¯•ï¼‰æ—¶ï¼Œå°†ä¼šå‘é€å¹¿æ’­æ¶ˆæ¯ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡BroadcastReceiverç±»ç›‘å¬è¿™äº›æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®éœ€è¦ä½œå‡ºç›¸åº”çš„åŠ¨ä½œã€‚

æœ¬ç« ç¤ºä¾‹ä»£ç è¯¦è§ä»¥ä¸‹é“¾æ¥ï¼š

- [ğŸ”— ç¤ºä¾‹å·¥ç¨‹ï¼šç³»ç»Ÿå¹¿æ’­](https://github.com/BI4VMR/Study-Android/tree/master/M04_System/C03_Broadcast/S01_System)

# åŸºæœ¬åº”ç”¨
## åŠ¨æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
åº”ç”¨ç¨‹åºè‹¥è¦æ¥æ”¶å¹¿æ’­ï¼Œé¦–å…ˆéœ€è¦æ³¨å†ŒBroadcastReceiverï¼Œå‘ŠçŸ¥ç³»ç»Ÿè‡ªèº«å¯¹ä½•ç§æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨é€»è¾‘ä»£ç ä¸­åŠ¨æ€æ³¨å†ŒBroadcastReceiverï¼Œæ­¤æ–¹å¼è¾ƒä¸ºçµæ´»ï¼Œä½†åªèƒ½åœ¨ç¨‹åºè¿è¡Œæ—¶æ¥æ”¶å¹¿æ’­ã€‚

ç³»ç»Ÿä¼šæ¯éš”ä¸€åˆ†é’Ÿå‘é€ä¸€æ¬¡æ—¶é—´å˜æ›´äº‹ä»¶å¹¿æ’­ï¼Œæˆ‘ä»¬å°è¯•åœ¨åº”ç”¨ç¨‹åºä¸­ç›‘å¬æ­¤å¹¿æ’­ã€‚

"TestUIBase.java":

```java
public class TestUIBase extends AppCompatActivity {

    private static final String TAG = "TestApp-" + TestUIBase.class.getSimpleName();

    private TimeTickReceiver receiver;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.testui_base);

        // åˆ›å»ºè¿‡æ»¤å™¨ï¼Œè®¾ç½®æƒ³è¦æ¥æ”¶çš„å¹¿æ’­ç±»å‹ã€‚
        IntentFilter filter = new IntentFilter();
        filter.addAction(Intent.ACTION_TIME_TICK);

        // åˆ›å»ºæ¥æ”¶å™¨å®ä¾‹ï¼Œå¹¶è¿›è¡ŒåŠ¨æ€æ³¨å†Œã€‚
        receiver = new TimeTickReceiver();
        registerReceiver(receiver, filter);
        Log.i(TAG, "å·²æ³¨å†ŒTimeTickReceiverã€‚");
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        // ç»„ä»¶è¢«é”€æ¯æ—¶ï¼Œæ³¨é”€å¹¿æ’­æ¥æ”¶å™¨ã€‚
        unregisterReceiver(receiver);
        Log.i(TAG, "å·²æ³¨é”€TimeTickReceiverã€‚");
    }

    // è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶å™¨ç±»ï¼Œæ”¶åˆ°ç›¸åº”å¹¿æ’­æ—¶æ‰§è¡Œ"onReceive()"æ–¹æ³•ä¸­çš„æ“ä½œã€‚
    static class TimeTickReceiver extends BroadcastReceiver {
        @Override
        public void onReceive(Context context, Intent intent) {
            // æ¥æ”¶åˆ°å¹¿æ’­æ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚
            Log.i(TAG, "Time Tick.");
        }
    }
}
```

ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªTimeTickReceiverç±»ï¼Œç»§æ‰¿è‡ªç³»ç»Ÿæä¾›çš„BroadcastReceiverï¼Œå¹¶åœ¨ `onReceive()` æ–¹æ³•ä¸­è¾“å‡ºäº†ä¸€æ¡æ—¥å¿—æ¶ˆæ¯ï¼Œæ¯å½“æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œ `onReceive()` æ–¹æ³•å°±ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚æ­¤æ–¹æ³•å°†åœ¨åº”ç”¨çš„ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå› æ­¤ä¸èƒ½è¿›è¡Œè€—æ—¶æ“ä½œã€‚

æˆ‘ä»¬åœ¨Activityçš„ `onCreate()` æ–¹æ³•åŠ¨æ€æ³¨å†Œäº†å¹¿æ’­æ¥æ”¶å™¨ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªIntentFilterå®ä¾‹ï¼Œè®¾ç½®Actionä¸º"Intent.ACTION_TIME_TICK"ï¼Œç³»ç»Ÿæ¯è¿‡ä¸€åˆ†é’Ÿå°†ä¼šå‘é€ä¸€æ¬¡è¿™ç§å¹¿æ’­ï¼›ç„¶ååˆ›å»ºäº†TimeTickReceiverçš„å®ä¾‹ï¼Œå¹¶é€šè¿‡ `registerReceiver()` æ³¨å†Œè¯¥å¹¿æ’­æ¥æ”¶å™¨ã€‚æˆ‘ä»¬åœ¨Activityçš„ `onDestroy()` æ–¹æ³•ä¸­ä½¿ç”¨ `unregisterReceiver()` æ³¨é”€å¹¿æ’­æ¥æ”¶å™¨ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨ç»„ä»¶åœæ­¢è¿è¡Œæ—¶é‡Šæ”¾èµ„æºã€‚

è¿è¡Œæ­¤ç¤ºä¾‹ç¨‹åºä¸€æ®µæ—¶é—´åï¼Œè§‚å¯ŸLogcatçš„è¾“å‡ºæ¶ˆæ¯ï¼š

```text
17:34:00.524 27108 27108 I TestApp: å·²æ³¨å†ŒTimeTickReceiverã€‚
17:35:00.004 27108 27108 I TestApp: Time Tick.
17:36:00.005 27108 27108 I TestApp: Time Tick.
17:37:00.002 27108 27108 I TestApp: Time Tick.
17:38:00.005 27108 27108 I TestApp: Time Tick.
```

å½“Activityåˆ›å»ºåï¼Œå¹¿æ’­æ¥æ”¶å™¨è¢«æ³¨å†Œï¼Œæ¯å½“ç³»ç»Ÿå‘é€"ACTION_TIME_TICK"å¹¿æ’­æ—¶ï¼ŒTimeTickReceiverçš„ `onReceive()` æ–¹æ³•è§¦å‘ä¸€æ¬¡ï¼Œè¾“å‡ºä¸€æ¡æ—¥å¿—ã€‚

## é™æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
é™¤äº†åœ¨ä»£ç ä¸­åŠ¨æ€æ³¨å†Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨Manifestæ–‡ä»¶ä¸­é™æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ï¼Œè¿™ç§æ–¹å¼å¯ä»¥åœ¨åº”ç”¨ç¨‹åºæ²¡æœ‰å¯åŠ¨æ—¶æ¥æ”¶å¹¿æ’­ã€‚

æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªBootCompleteReceiverï¼Œç”¨äºæ”¶åˆ°å¹¿æ’­åæ‰§è¡ŒåŠ¨ä½œï¼Œè¿™é‡Œå°†æ‰“å°ä¸€æ¡æ—¥å¿—ã€‚

"BootCompleteReceiver.java":

```java
public class BootCompleteReceiver extends BroadcastReceiver {

    private static final String TAG = "TestApp-" + BootCompleteReceiver.class.getSimpleName();

    @Override
    public void onReceive(Context context, Intent intent) {
        // è·å–Action
        String action = intent.getAction();
        // æ ¹æ®Actionæ‰§è¡Œå¯¹åº”åŠ¨ä½œ
        if (action != null && action.equals(Intent.ACTION_BOOT_COMPLETED)) {
            // æ¥æ”¶åˆ°å¹¿æ’­æ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚
            Log.i(TAG, "ç³»ç»Ÿå¯åŠ¨å®Œæˆ");
        }
    }
}
```

ç”±äºIntentFilterå¯ä»¥è®¾ç½®å¤šä¸ªActionï¼ŒåŒ¹é…åˆ°ä»»æ„ä¸€ä¸ªActionå°±ä¼šè§¦å‘å¹¿æ’­æ¥æ”¶å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è°ƒç”¨Intentçš„ `getAction()` æ–¹æ³•è·å–å½“å‰äº‹ä»¶çš„Actionï¼Œæ ¹æ®å…·ä½“æƒ…å†µæ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚

æˆ‘ä»¬éœ€è¦åœ¨Manifestæ–‡ä»¶çš„ `<application>` æ ‡ç­¾å†…è¿›è¡Œæ³¨å†Œï¼Œå°†IntentFilterçš„Actionè®¾ç½®ä¸º"android.intent.action.BOOT_COMPLETED"ã€‚

"AndroidManifest.xml":

```xml
<!-- é™æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶å™¨-->
<receiver
    android:name=".base.BootCompleteReceiver"
    android:enabled="true"
    android:exported="true">

    <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
</receiver>
```

æœ€åè¿˜è¦åœ¨ `<manifest>` æ ‡ç­¾å†…æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå‘ç³»ç»Ÿç”³è¯·æ¥æ”¶æ­¤å¹¿æ’­çš„æƒé™ã€‚

"AndroidManifest.xml":

```xml
<!-- ç”³è¯·æ¥æ”¶â€œç³»ç»Ÿå¯åŠ¨å®Œæ¯•â€äº‹ä»¶å¹¿æ’­çš„æƒé™-->
<uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
```

é…ç½®å®Œæˆåï¼Œå°†ç¤ºä¾‹ç¨‹åºè£…å…¥è®¾å¤‡å¹¶é‡å¯è®¾å¤‡ï¼Œå½“è®¾å¤‡å¯åŠ¨å®Œæ¯•åï¼Œæˆ‘ä»¬æ— éœ€æ‰‹åŠ¨æ‰“å¼€è¯¥ç¨‹åºï¼Œæ§åˆ¶å°ä¹Ÿèƒ½è¾“å‡ºâ€œç³»ç»Ÿå¯åŠ¨å®Œæˆâ€æ¶ˆæ¯ã€‚æ­¤å¤„çš„æ—¥å¿—è¾“å‡ºå¯ä»¥æ›¿æ¢ä¸ºå®é™…éœ€è¦æ‰§è¡Œçš„è‡ªå¯ä»»åŠ¡ï¼Œå®ç°ç¨‹åºå¼€æœºè‡ªå¯ã€‚
