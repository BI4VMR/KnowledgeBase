# ç®€ä»‹
æœ‰åºå¹¿æ’­å°†ä¼šæŒ‰ä¼˜å…ˆçº§é¡ºåºå‘é€ç»™å„æ¥æ”¶è€…ï¼Œå¹¶ä¸”æ¯ä¸ªæ¥æ”¶è€…å¯ä»¥é€‰æ‹©æ˜¯å¦æˆªæ–­å¹¿æ’­ã€‚

æœ¬ç« ç¤ºä¾‹ä»£ç è¯¦è§ä»¥ä¸‹é“¾æ¥ï¼š

- [ğŸ”— ç¤ºä¾‹å·¥ç¨‹ï¼šæœ‰åºå¹¿æ’­](https://github.com/BI4VMR/Study-Android/tree/master/M04_System/C03_Broadcast/S03_Ordered)

# åŸºæœ¬åº”ç”¨
æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸¤ä¸ªå¹¿æ’­æ¥æ”¶å™¨MyReceiver1å’ŒMyReceiver2ï¼Œå½“æ”¶åˆ°å¹¿æ’­åå„è‡ªå‘æ§åˆ¶å°è¾“å‡ºæ¶ˆæ¯ï¼Œç„¶ååˆ†åˆ«åœ¨æµ‹è¯•Activityä¸­æ³¨å†Œè¿™ä¸¤ä¸ªæ¥æ”¶å™¨ã€‚

"TestUIBase.java":

```java
// æ³¨å†Œç¬¬ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨
IntentFilter filter1 = new IntentFilter();
filter1.addAction("net.bi4vmr.MY_BROADCAST");
MyReceiver1 receiver1 = new MyReceiver1();
registerReceiver(receiver1, filter1);

// æ³¨å†Œç¬¬äºŒä¸ªå¹¿æ’­æ¥æ”¶å™¨
IntentFilter filter2 = new IntentFilter();
filter2.addAction("net.bi4vmr.MY_BROADCAST");
MyReceiver2 receiver2 = new MyReceiver2();
registerReceiver(receiver2, filter2);
```

æ­¤ç¤ºä¾‹ä¸­æˆ‘ä»¬ä»ç„¶é€šè¿‡æµ‹è¯•Activityä¸­çš„æŒ‰é’®æ§åˆ¶å¹¿æ’­çš„å‘é€ï¼Œæœ‰åºå¹¿æ’­éœ€è¦ä½¿ç”¨Contextçš„ `sendOrderedBroadcast()` æ–¹æ³•å‘é€ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºIntentï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæƒé™ï¼Œæ­¤å¤„æˆ‘ä»¬å°†å…¶å¿½ç•¥ï¼Œä¼ å…¥"null"ã€‚

"TestUIBase.java":

```java
// å‘é€æŒ‰é’®
btSend.setOnClickListener(v -> {
    Intent intent = new Intent("net.bi4vmr.MY_BROADCAST");
    sendOrderedBroadcast(intent, null);
});
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œæˆ‘ä»¬ç‚¹å‡»å‘é€å¹¿æ’­æŒ‰é’®ï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„æ¶ˆæ¯ã€‚

```text
15:06:43.570 3990-3990 I TestApp-MyReceiver1: Receiver1æ¥æ”¶åˆ°å¹¿æ’­
15:06:43.583 3990-3990 I TestApp-MyReceiver2: Receiver2æ¥æ”¶åˆ°å¹¿æ’­
```

æ­¤æ—¶ä¸¤ä¸ªIntentè¿‡æ»¤å™¨æ‹¥æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰ï¼Œä¸¤ä¸ªå¹¿æ’­æ¥æ”¶å™¨æŒ‰ç…§æ³¨å†Œé¡ºåºæ¥æ”¶æ¶ˆæ¯ã€‚æ¶ˆæ¯é¦–å…ˆä¼ ç»™Receiver1ï¼Œç”±äºReceiver1å¹¶æœªæˆªæ–­æ¶ˆæ¯ï¼Œæ¶ˆæ¯ç»§ç»­ä¼ é€’ç»™Receiver2ã€‚

æ¥ç€æˆ‘ä»¬ä½¿ç”¨IntentFilterçš„ `setPriority()` æ–¹æ³•ä¸º `filter2` è®¾ç½®ä¼˜å…ˆçº§100ï¼Œå¹¶åœ¨MyReceiver2çš„ `onReceive()` æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ `abortBroadcast()` æ–¹æ³•æˆªæ–­å¹¿æ’­ã€‚

```java
/* "filter2"ç›¸å…³ä¿®æ”¹ */
// æ³¨å†Œç¬¬äºŒä¸ªå¹¿æ’­æ¥æ”¶å™¨
IntentFilter filter2 = new IntentFilter("net.bi4vmr.MY_BROADCAST");
// è®¾ç½®ä¼˜å…ˆçº§
filter2.setPriority(100);
MyReceiver2 receiver2 = new MyReceiver2();
registerReceiver(receiver2, filter2);

/* "MyReceiver2"ç›¸å…³ä¿®æ”¹ */
public class MyReceiver2 extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {
        Log.i(TAG, "Receiver2æ¥æ”¶åˆ°å¹¿æ’­ã€‚");
        // æˆªæ–­å¹¿æ’­ä¼ é€’
        abortBroadcast();
    }
}
```

æˆ‘ä»¬å†æ¬¡è¿è¡Œç¨‹åºï¼Œç‚¹å‡»å‘é€å¹¿æ’­æŒ‰é’®ï¼Œæ­¤æ—¶æ§åˆ¶å°ä»…æ˜¾ç¤ºâ€œReceiver2æ¥æ”¶åˆ°å¹¿æ’­â€ã€‚

è¿™æ˜¯å› ä¸º `filter2` è®¾ç½®äº†è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œå¹¿æ’­é¦–å…ˆå‘é€ç»™MyReceiver2ï¼ŒMyReceiver2æ‰§è¡Œçš„ `abortBroadcast()` æ–¹æ³•å°†å¹¿æ’­æˆªæ–­ï¼Œå› æ­¤ä¸ä¼šå†ä¼ é€’ç»™ä¼˜å…ˆçº§è¾ƒä½çš„MyReceiver1ã€‚
