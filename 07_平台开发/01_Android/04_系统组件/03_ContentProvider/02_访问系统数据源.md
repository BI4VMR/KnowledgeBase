# ç®€ä»‹
Androidç³»ç»Ÿæä¾›äº†ä¸€äº›å†…ç½®çš„ContentProviderï¼Œä»¥ä¾¿æˆ‘ä»¬è·å–è”ç³»äººã€æ—¥å†ã€è®¾ç½®ç­‰å…¬å…±æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ContentResolverä¸è¿™äº›ç»„ä»¶äº¤äº’ã€‚

ContentResolveré»˜è®¤åœ¨å®¢æˆ·ç«¯ä¸»çº¿ç¨‹ä¸­å·¥ä½œï¼Œå› æ­¤è‹¥æŸ¥è¯¢ç›®æ ‡éœ€è¦è”ç½‘æˆ–æ•°æ®é‡è¾ƒå¤§ï¼Œå®¹æ˜“å¯¼è‡´å®¢æˆ·ç«¯ç¨‹åºå‘ç”ŸANRï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åº”å½“åœ¨å­çº¿ç¨‹ä¸­è¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚

æœ¬ç« ç¤ºä¾‹ä»£ç è¯¦è§ä»¥ä¸‹é“¾æ¥ï¼š

- [ğŸ”— ç¤ºä¾‹å·¥ç¨‹ï¼šè®¿é—®ç³»ç»Ÿæ•°æ®æº](https://github.com/BI4VMR/Study-Android/tree/master/M04_System/C04_ContentProvider/S02_Internal)

# åŸºæœ¬åº”ç”¨
æˆ‘ä»¬ä»¥ç³»ç»Ÿè‡ªå¸¦çš„è”ç³»äººContentProviderä¸ºä¾‹ï¼Œç¼–å†™å®¢æˆ·ç«¯ç¨‹åºï¼Œä½¿ç”¨ContentResolveræŸ¥è¯¢æ‰€æœ‰è”ç³»äººçš„IDå’Œåç§°ã€‚

è”ç³»äººæ•°æ®å±äºç”¨æˆ·çš„æ•æ„Ÿæ•°æ®ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨Manifestæ–‡ä»¶ä¸­å£°æ˜â€œè¯»å–è”ç³»äººâ€çš„æƒé™ã€‚

"AndroidManifest.xml":

```xml
<manifest ...>
    <!-- æŸ¥è¯¢è”ç³»äººæ•°æ®çš„æƒé™å£°æ˜ -->
    <uses-permission android:name="android.permission.READ_CONTACTS" />
</manifest>
```

â€œè¯»å–è”ç³»äººâ€æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶æƒé™ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­å½“å‰åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»è¢«æˆäºˆè¯¥æƒé™ï¼Œå·²æœ‰æƒé™æ‰èƒ½ç»§ç»­æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼›å¦åˆ™åº”å½“åŠ¨æ€è¯·æ±‚è¯¥æƒé™ã€‚

æ­¤å¤„çœç•¥åŠ¨æ€ç”³è¯·æƒé™çš„é€»è¾‘ï¼Œè¯¥éƒ¨åˆ†çŸ¥è¯†å¯å‚è€ƒç›¸å…³ç« èŠ‚ï¼š [ğŸ§­ æƒé™ç®¡ç† - è¯·æ±‚è¿è¡Œæ—¶æƒé™](../05_æ ¸å¿ƒèƒ½åŠ›/01_æƒé™ç®¡ç†.md#è¯·æ±‚è¿è¡Œæ—¶æƒé™) ï¼›åœ¨æœ¬ç¤ºä¾‹ç¨‹åºä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥åº”ç”¨æƒé™è®¾ç½®ç•Œé¢æ‰‹åŠ¨å®Œæˆæˆæƒã€‚

å½“åº”ç”¨ç¨‹åºå·²æœ‰â€œè¯»å–è”ç³»äººâ€æƒé™æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ContentResolveræŸ¥è¯¢è”ç³»äººæ•°æ®äº†ã€‚

"TestUIContacts.java":

```java
// è·å–ContentResolverå¯¹è±¡
ContentResolver contentResolver = getContentResolver();
// æŸ¥è¯¢æ‰€æœ‰è”ç³»äºº
Cursor cursor = contentResolver.query(ContactsContract.Contacts.CONTENT_URI,
        null, null, null, null);
// éå†æ¸¸æ ‡ï¼Œè¯»å–è”ç³»äººä¿¡æ¯ã€‚
if (cursor != null && cursor.moveToFirst()) {
    // è·å–åˆ—ç´¢å¼•
    int indexID = cursor.getColumnIndex(ContactsContract.Contacts._ID);
    int indexName = cursor.getColumnIndex(ContactsContract.Contacts.DISPLAY_NAME);
    // éƒ¨åˆ†ç³»ç»Ÿç‰ˆæœ¬å¯èƒ½ç¼ºå°‘æŸäº›å­—æ®µï¼Œå¯¼è‡´ç´¢å¼•æ•°å€¼ä¸º"-1"ï¼Œéœ€è¦æ³¨æ„è¿™ç§æƒ…å†µã€‚
    if (indexID < 0 || indexName < 0) {
        // æ­¤å¤„ä¸åšå®¹é”™å¤„ç†ï¼Œç¼ºå°‘å­—æ®µåˆ™ç»“æŸæ“ä½œã€‚
        cursor.close();
        return;
    }

    // å¾ªç¯è¯»å–æ•°æ®
    do {
        int id = cursor.getInt(indexID);
        String name = cursor.getString(indexName);

        Log.i(TAG, "Contact ID:" + id + ", Name:" + name);
    } while (cursor.moveToNext());
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨Contextå¯¹è±¡çš„ `getContentResolver()` æ–¹æ³•è·å–ContentResolverå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒæä¾›çš„å¢åˆ æ”¹æŸ¥æ¥å£æ“ä½œè¿œç¨‹æ•°æ®ã€‚æ­¤å¤„ä»¥æŸ¥è¯¢æ–¹æ³• `query()` ä¸ºä¾‹ï¼Œä¸»è¦å‚æ•°ä¸ºæŸ¥è¯¢ç›®æ ‡URIï¼Œè¿”å›å€¼ä¸ºæ¸¸æ ‡(Cursor)ï¼Œæˆ‘ä»¬å¯ä»¥éå†æ¸¸æ ‡è·å–æŸ¥è¯¢ç»“æœã€‚

æˆ‘ä»¬é¦–å…ˆè¿›å…¥ç¤ºä¾‹ç¨‹åºçš„æƒé™è®¾ç½®é¡µé¢æˆäºˆâ€œè¯»å–è”ç³»äººâ€æƒé™ï¼Œå†è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
11:20:09.388  7815  7815 I TestApp: Contact ID:1, Name:Alice
11:20:09.388  7815  7815 I TestApp: Contact ID:2, Name:Bob
```

# è°ƒè¯•å‘½ä»¤

usage: adb shell content [subcommand] [options]

usage: adb shell content insert --uri <URI> [--user <USER_ID>] --bind <BINDING> [--bind <BINDING>...]
  <URI> a content provider URI.
  <BINDING> binds a typed value to a column and is formatted:
  <COLUMN_NAME>:<TYPE>:<COLUMN_VALUE> where:
  <TYPE> specifies data type such as:
  b - boolean, s - string, i - integer, l - long, f - float, d - double
  Note: Omit the value for passing an empty string, e.g column:s:
  Example:
  # Add "new_setting" secure setting with value "new_value".
  adb shell content insert --uri content://settings/secure --bind name:s:new_setting --bind value:s:new_value

usage: adb shell content update --uri <URI> [--user <USER_ID>] [--where <WHERE>]
  <WHERE> is a SQL style where clause in quotes (You have to escape single quotes - see example below).
  Example:
  # Change "new_setting" secure setting to "newer_value".
  adb shell content update --uri content://settings/secure --bind value:s:newer_value --where "name='new_setting'"

usage: adb shell content delete --uri <URI> [--user <USER_ID>] --bind <BINDING> [--bind <BINDING>...] [--where <WHERE>]
  Example:
  # Remove "new_setting" secure setting.
  adb shell content delete --uri content://settings/secure --where "name='new_setting'"

usage: adb shell content query --uri <URI> [--user <USER_ID>] [--projection <PROJECTION>] [--where <WHERE>] [--sort <SORT_ORDER>]
  <PROJECTION> is a list of colon separated column names and is formatted:
  <COLUMN_NAME>[:<COLUMN_NAME>...]
  <SORT_ORDER> is the order in which rows in the result should be sorted.
  Example:
  # Select "name" and "value" columns from secure settings where "name" is equal to "new_setting" and sort the result by name in ascending order.
  adb shell content query --uri content://settings/secure --projection name:value --where "name='new_setting'" --sort "name ASC"

usage: adb shell content call --uri <URI> --method <METHOD> [--arg <ARG>]
       [--extra <BINDING> ...]
  <METHOD> is the name of a provider-defined method
  <ARG> is an optional string argument
  <BINDING> is like --bind above, typed data of the form <KEY>:{b,s,i,l,f,d}:<VAL>

usage: adb shell content read --uri <URI> [--user <USER_ID>]
  Example:
  # cat default ringtone to a file, then pull to host
  adb shell 'content read --uri content://settings/system/ringtone > /mnt/sdcard/tmp.ogg' && adb pull /mnt/sdcard/tmp.ogg

usage: adb shell content gettype --uri <URI> [--user <USER_ID>]
  Example:
  # Show the mime-type of the URI
  adb shell content gettype --uri content://media/internal/audio/media/

