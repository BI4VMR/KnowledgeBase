# ç®€ä»‹
Android SDKã€Material Designä»¥åŠç¬¬ä¸‰æ–¹åº“æä¾›äº†ä¸°å¯Œçš„UIæ§ä»¶ï¼Œä½†æœ‰æ—¶ä»ç„¶æ— æ³•æ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ¶ä½œè‡ªå®šä¹‰æ§ä»¶ã€‚

è‡ªå®šä¹‰æ§ä»¶æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹å¼ï¼š

- ç»„åˆç°æœ‰æ§ä»¶ï¼šå°†å¤šä¸ªå­æ§ä»¶ç»„åˆä¸ºä¸€ä¸ªæ–°çš„æ§ä»¶ï¼Œå°è£…å­æ§ä»¶ä¹‹é—´çš„è”åŠ¨é€»è¾‘ï¼Œä»¥ä¾¿å¤šå¤„å¤ç”¨ã€‚
- ç»§æ‰¿ç°æœ‰æ§ä»¶ï¼šç»§æ‰¿ç°æœ‰çš„æ§ä»¶æˆ–å¸ƒå±€ï¼Œä¸ºå…¶æ‰©å±•æ–°çš„åŠŸèƒ½ã€‚
- è‡ªç”±å®šåˆ¶æ§ä»¶ï¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å›¾å½¢èƒ½åŠ›ï¼Œè‡ªç”±åœ°ç¼–å†™ç»˜å›¾é€»è¾‘ã€‚

æœ¬ç« ç¤ºä¾‹å·¥ç¨‹è¯¦è§ä»¥ä¸‹é“¾æ¥ï¼š

[ğŸ”— ç¤ºä¾‹å·¥ç¨‹ï¼šæ¦‚è¿°](https://github.com/BI4VMR/Study-Android/tree/master/M03_UI/C07_CtrlCustom/S01_Base)


# åŸºæœ¬åº”ç”¨
ä¸‹æ–‡ç¤ºä¾‹å±•ç¤ºäº†è‡ªå®šä¹‰æ§ä»¶çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼š

ğŸ”´ ç¤ºä¾‹ä¸€ï¼šé€šè¿‡ç»„åˆç°æœ‰æ§ä»¶çš„æ–¹å¼åˆ›å»ºâ€œåç‰‡â€æ§ä»¶ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»„åˆç°æœ‰æ§ä»¶çš„æ–¹å¼ï¼Œå®ç°ä¸€ä¸ªåç‰‡æ§ä»¶ï¼Œå±•ç¤ºè‡ªå®šä¹‰æ§ä»¶çš„åˆ¶ä½œæ–¹æ³•ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¸ƒå±€æ–‡ä»¶å¹¶æ”¾ç½®è‹¥å¹²æ§ä»¶ï¼Œç”¨äºæè¿°â€œåç‰‡â€çš„å¤–è§‚ã€‚

"business_card.xml":

```xml
<!-- æ­¤å¤„å·²çœç•¥éƒ¨åˆ†å±æ€§... -->
<androidx.constraintlayout.widget.ConstraintLayout
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:background="@drawable/shape_business_card_background">

    <ImageView
        android:id="@+id/ivAvatar"
        android:layout_width="64dp"
        android:layout_height="64dp" />

    <TextView
        android:id="@+id/tvName"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        tools:text="[åç§°]" />

    <TextView
        android:id="@+id/tvPhone"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        tools:text="[ç”µè¯å·ç ]" />
</androidx.constraintlayout.widget.ConstraintLayout>
```

åœ¨ä¸Šè¿°å¸ƒå±€æ–‡ä»¶ä¸­ï¼ŒImageViewç”¨äºæ˜¾ç¤ºå¤´åƒï¼Œä¸¤ä¸ªTextViewåˆ†åˆ«ç”¨äºæ˜¾ç¤ºå§“åå’Œç”µè¯å·ç ã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºBusinessCardç±»ï¼Œå®ç°æ§ä»¶å†…éƒ¨é€»è¾‘å¹¶åŠ è½½ä¸Šè¿°å¸ƒå±€æ–‡ä»¶ã€‚

"BusinessCard.java":

```java
public class BusinessCard extends FrameLayout {

    private ImageView ivAvatar;
    private TextView tvName;
    private TextView tvPhone;

    // æ„é€ æ–¹æ³•1
    public BusinessCard(@NonNull Context context) {
        super(context);
        // å°†å¸ƒå±€æ–‡ä»¶æ¸²æŸ“ç”ŸæˆViewå®ä¾‹
        View view = LayoutInflater.from(context).inflate(R.layout.business_card, this, true);
        // è·å–Viewå®ä¾‹ä¸­å„ä¸ªå­å…ƒç´ çš„å¼•ç”¨
        ivAvatar = view.findViewById(R.id.ivAvatar);
        tvName = view.findViewById(R.id.tvName);
        tvPhone = view.findViewById(R.id.tvPhone);
    }

    // æ„é€ æ–¹æ³•2
    public BusinessCard(@NonNull Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
        /* åˆå§‹åŒ–æ“ä½œ ... */
    }

    // æ„é€ æ–¹æ³•3
    public BusinessCard(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        /* åˆå§‹åŒ–æ“ä½œ ... */
    }

    // æ„é€ æ–¹æ³•4
    public BusinessCard(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr, int defStyleRes) {
        super(context, attrs, defStyleAttr, defStyleRes);
        /* åˆå§‹åŒ–æ“ä½œ ... */
    }

    // æ›´æ–°æ–‡æœ¬ä¸å›¾åƒèµ„æº
    public void updateInfo(String name, String phone, @DrawableRes int avatarResID) {
        tvName.setText(name);
        tvPhone.setText(phone);
        ivAvatar.setImageResource(avatarResID);
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"BusinessCardKT.kt":

```kotlin
class BusinessCardKT : FrameLayout {

    private val binding: BusinessCardBinding by lazy {
        // å°†å¸ƒå±€æ–‡ä»¶æ¸²æŸ“ç”ŸæˆViewå®ä¾‹
        BusinessCardBinding.inflate(LayoutInflater.from(context), this, true)
    }

    // æ„é€ æ–¹æ³•1
    constructor(context: Context) : super(context)

    // æ„é€ æ–¹æ³•2
    constructor(context: Context, attrs: AttributeSet?) : super(context, attrs)

    // æ„é€ æ–¹æ³•3
    constructor(context: Context, attrs: AttributeSet?, defStyleAttr: Int) : super(context, attrs, defStyleAttr)

    // æ„é€ æ–¹æ³•4
    constructor(context: Context, attrs: AttributeSet?, defStyleAttr: Int, defStyleRes: Int) : super(
        context,
        attrs,
        defStyleAttr,
        defStyleRes
    )

    // æ›´æ–°æ–‡æœ¬ä¸å›¾åƒèµ„æº
    fun updateInfo(name: String, phone: String, @DrawableRes avatarResID: Int) {
        with(binding) {
            tvName.text = name
            tvPhone.text = phone
            ivAvatar.setImageResource(avatarResID)
        }
    }
}
```

Viewæ‹¥æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå½“æˆ‘ä»¬åœ¨ä»£ç ä¸­åˆ›å»ºæ§ä»¶å®ä¾‹æ—¶ï¼Œéœ€è¦è°ƒç”¨ `BusinessCard(Context context)` æ„é€ æ–¹æ³•ï¼Œæ­¤å¤„éœ€è¦å®ç°æ§ä»¶çš„åˆå§‹åŒ–é€»è¾‘ï¼›å½“LayoutInflaterè§£æå¸ƒå±€æ–‡ä»¶ç”Ÿæˆæ§ä»¶å®ä¾‹æ—¶ï¼Œå°†ä¼šè°ƒç”¨ `BusinessCard(Context context, AttributeSet attrs)` æ„é€ æ–¹æ³•ï¼Œç¬¬äºŒå‚æ•° `attrs` è¡¨ç¤ºXMLä¸­çš„æ§ä»¶å±æ€§ï¼Œæ­¤å¤„éœ€è¦å®ç°æ§ä»¶çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå¹¶è§£æXMLå±æ€§ã€‚

å…·æœ‰ä¸€ä¸ªå‚æ•°ä¸ä¸¤ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•æ˜¯å¿…é€‰çš„ï¼Œå®ƒä»¬è¦†ç›–äº†åŠ¨æ€åˆ›å»ºViewä¸é€šè¿‡XMLå£°æ˜Viewçš„åœºæ™¯ã€‚å¦å¤–ä¸¤ä¸ªæ„é€ æ–¹æ³•çš„å‚æ•° `defStyleAttr` å’Œ `defStyleRes` ä¸ä¸»é¢˜å’Œæ ·å¼æœ‰å…³ï¼Œæ­¤å¤„å°†å…¶å¿½ç•¥ï¼Œåæ–‡ç¤ºä¾‹å°†è¯¦ç»†ä»‹ç»å®ƒä»¬ã€‚

> âš ï¸ è­¦å‘Š
>
> å½“æˆ‘ä»¬ä½¿ç”¨ViewBindingæ—¶ï¼Œå¿…é¡»è°ƒç”¨å…·æœ‰3ä¸ªå‚æ•°çš„ `inflate()` æ–¹æ³•ä»¥è·å–ViewBindingå®ä¾‹ï¼Œå¹¶å°† `attachToParent` å‚æ•°ç½®ä¸º `true` ï¼›å¦åˆ™å¸ƒå±€å°†ä¸ä¼šå…³è”åˆ°é¡¶å±‚å®¹å™¨ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œæ—¶æ§ä»¶æ˜¾ç¤ºä¸ºç©ºç™½ç”»é¢ã€‚

`updateInfo()` æ–¹æ³•å³BusinessCardæ§ä»¶å¯¹å¤–æš´éœ²çš„ä¸šåŠ¡æ¥å£ï¼Œæˆ‘ä»¬å°†è¯¥æ–¹æ³•å‚æ•°ä¼ å…¥çš„æ–‡æœ¬ä¸å›¾ç‰‡èµ„æºåˆ†åˆ«è®¾ç½®åˆ°å¯¹åº”çš„æ§ä»¶ä¸­ï¼Œå®ç°åŠ¨æ€æ›´æ–°UIçš„åŠŸèƒ½ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™æ§ä»¶ï¼Œè¿˜å¯ä»¥åˆ©ç”¨é»˜è®¤å‚æ•°å°†æ„é€ æ–¹æ³•åˆå¹¶ä¸ºä¸€ä¸ªï¼Œè¿›ä¸€æ­¥ç®€åŒ–ä»£ç ï¼š

"BusinessCardSimpleKT.kt":

```kotlin
class BusinessCardSimpleKT @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = 0,
    defStyleRes: Int = 0
) : FrameLayout(context, attrs, defStyleAttr, defStyleRes) {

    init {
        // åœ¨æ­¤å¤„æ”¾ç½®æ„é€ é˜¶æ®µçš„åˆå§‹åŒ–é€»è¾‘...
    }

    // æ­¤å¤„å·²çœç•¥éƒ¨åˆ†ä»£ç ...
}
```

è‡³æ­¤ï¼Œè‡ªå®šä¹‰æ§ä»¶â€œåç‰‡â€å·²ç»åˆ¶ä½œå®Œæ¯•äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ‡æ¢åˆ°æ§ä»¶è°ƒç”¨è€…è§†è§’ï¼Œåˆ›å»ºæ§ä»¶å®ä¾‹å¹¶ä½¿ç”¨å®ƒã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬è°ƒç”¨å…·æœ‰ä¸€ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºåç‰‡æ§ä»¶å®ä¾‹ï¼Œè®¾ç½®å§“åã€ç”µè¯ä¸å¤´åƒï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æµ‹è¯•Activityçš„è§†å›¾å®¹å™¨ä¸­ã€‚

"TestUIBase.java":

```java
// æ„å»ºBusinessCardå®ä¾‹
BusinessCard businessCard = new BusinessCard(this);
// è®¾ç½®æ–‡æœ¬ä¸å›¾åƒ
businessCard.updateInfo("ç”°æ‰€æµ©äºŒ", "11451419198", R.drawable.ic_funny_256);
// å°†å…¶æ·»åŠ åˆ°å¸ƒå±€ä¸­
binding.container.addView(businessCard);
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"TestUIBaseKT.kt":

```kotlin
// æ„å»ºBusinessCardå®ä¾‹
val businessCard = BusinessCardKT(this)
// è®¾ç½®æ–‡æœ¬ä¸å›¾åƒ
businessCard.updateInfo("ç”°æ‰€æµ©äºŒ", "11451419198", R.drawable.ic_funny_256)
// å°†å…¶æ·»åŠ åˆ°å¸ƒå±€ä¸­
binding.container.addView(businessCard)
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹ç•Œé¢å¤–è§‚ï¼š

<div align="center">

![åç‰‡æ§ä»¶çš„æ˜¾ç¤ºæ•ˆæœ](./Assets_æ¦‚è¿°/åŸºæœ¬åº”ç”¨_åç‰‡æ§ä»¶çš„æ˜¾ç¤ºæ•ˆæœ.jpg)

</div>


# XMLå±æ€§
## åŸºæœ¬åº”ç”¨
åœ¨å‰æ–‡â€œç¤ºä¾‹ä¸€â€ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥æ™“äº†è‡ªå®šä¹‰æ§ä»¶çš„åˆ¶ä½œæ–¹æ³•ï¼Œä½†BusinessCardæ§ä»¶åªèƒ½åˆ©ç”¨ `updateInfo()` æ–¹æ³•æ›´æ–°UIï¼Œæ— æ³•è§£æXMLå±æ€§ã€‚æœ¬èŠ‚å†…å®¹å°†ä»‹ç»XMLå±æ€§çš„å®šä¹‰ä¸è§£ææ–¹æ³•ï¼Œä¸ºBusinessCardæ§ä»¶æ·»åŠ è‡ªå®šä¹‰XMLå±æ€§æ”¯æŒã€‚

ğŸŸ  ç¤ºä¾‹äºŒï¼šä¸ºâ€œåç‰‡â€æ§ä»¶æ·»åŠ XMLå±æ€§æ”¯æŒã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºBusinessCardæ§ä»¶æ·»åŠ è‡ªå®šä¹‰XMLå±æ€§æ”¯æŒã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨ `<æ¨¡å—æ ¹ç›®å½•>/src/main/res/values/` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªå±æ€§å£°æ˜æ–‡ä»¶ `attrs_business_card.xml` ï¼Œå¹¶åœ¨å…¶ä¸­å£°æ˜ä¸€äº›å±æ€§ã€‚

"attrs_business_card.xml":

```xml
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <declare-styleable name="BusinessCard2">
        <attr name="name" format="string" />
        <attr name="phone" format="string" />
        <attr name="avatar" format="reference" />
    </declare-styleable>
</resources>
```

æ¯ä¸ª `<declare-styleable/>` å°èŠ‚è¡¨ç¤ºä¸€ä¸ªå±æ€§é›†åˆï¼Œå®ƒçš„åç§°åº”å½“ä¸è‡ªå®šä¹‰æ§ä»¶çš„ç±»åä¿æŒä¸€è‡´ï¼Œä»¥æé«˜å¯è¯»æ€§ã€‚

æ¯ä¸ª `<attr/>` å°èŠ‚è¡¨ç¤ºä¸€æ¡å±æ€§ï¼Œé…ç½®é¡¹ `name` è¡¨ç¤ºåç§°ï¼›é…ç½®é¡¹ `format` è¡¨ç¤ºæ•°æ®ç±»å‹ã€‚æ­¤å¤„çš„â€œå§“å("name")â€ä¸â€œç”µè¯å·ç ("phone")â€å±æ€§æ¥å—æ–‡æœ¬ç±»å‹æ•°æ®ï¼Œä½¿ç”¨è€…å¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²æˆ–æ–‡æœ¬èµ„æºIDï¼›â€œå¤´åƒ("avatar")â€å±æ€§æ¥å—èµ„æºå¼•ç”¨ç±»å‹æ•°æ®ï¼Œä½¿ç”¨è€…å¯ä»¥ä¼ å…¥å›¾åƒæˆ–é¢œè‰²èµ„æºIDã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬å¯¹å‰æ–‡â€œç¤ºä¾‹ä¸€â€ä¸­çš„BusinessCardæ§ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä¸ºå…¶æ·»åŠ è§£æXMLå±æ€§çš„ç›¸å…³ä»£ç ã€‚

"BusinessCard2.java":

```java
public class BusinessCard2 extends FrameLayout {

    private BusinessCardBinding binding;

    // æ„é€ æ–¹æ³•1
    public BusinessCard2(@NonNull Context context) {
        // è°ƒç”¨æ„é€ æ–¹æ³•2ï¼ŒXMLå±æ€§é›†åˆä¼ å…¥ç©ºå€¼ï¼Œé¿å…é‡å¤ä¹¦å†™â€œåˆå§‹åŒ–è§†å›¾â€çš„é€»è¾‘ã€‚
        this(context, null);
    }

    // æ„é€ æ–¹æ³•2
    public BusinessCard2(@NonNull Context context, @Nullable AttributeSet attrs) {
        this(context, attrs, 0);
    }

    // æ„é€ æ–¹æ³•3
    public BusinessCard2(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        this(context, attrs, 0, 0);
    }

    // æ„é€ æ–¹æ³•4
    public BusinessCard2(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr, int defStyleRes) {
        super(context, attrs, defStyleAttr, defStyleRes);

        // åˆå§‹åŒ–è§†å›¾
        initView();

        // å¦‚æœå½“å‰å®ä¾‹ä¸æ˜¯é€šè¿‡å¸ƒå±€æ–‡ä»¶ç”Ÿæˆçš„ï¼Œåˆ™ä¸å¿…è§£æXMLå±æ€§ã€‚
        if (attrs == null) {
            return;
        }

        // è·å–è‡ªå®šä¹‰å±æ€§æ•°ç»„
        TypedArray ta = context.obtainStyledAttributes(attrs, R.styleable.BusinessCard2, defStyleAttr, defStyleRes);
        // è·å–å±æ€§ï¼Œå¹¶è®¾ç½®åˆ°å­æ§ä»¶ä¸Šã€‚
        if (ta.hasValue(R.styleable.BusinessCard2_name)) {
            String name = ta.getString(R.styleable.BusinessCard2_name);
            binding.tvName.setText(name);
        }
        if (ta.hasValue(R.styleable.BusinessCard2_phone)) {
            String phone = ta.getString(R.styleable.BusinessCard2_phone);
            binding.tvPhone.setText(phone);
        }
        if (ta.hasValue(R.styleable.BusinessCard2_avatar)) {
            Drawable avatar = ta.getDrawable(R.styleable.BusinessCard2_avatar);
            binding.ivAvatar.setImageDrawable(avatar);
        }

        // é‡Šæ”¾TypedArrayèµ„æº
        ta.recycle();
    }

    // åˆå§‹åŒ–è§†å›¾
    private void initView() {
        binding = BusinessCardBinding.inflate(LayoutInflater.from(getContext()), this, true);
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"BusinessCard2KT.kt":

```kotlin
class BusinessCard2KT @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = 0,
    defStyleRes: Int = 0
) : FrameLayout(context, attrs, defStyleAttr, defStyleRes) {

    companion object {
        private val TAG: String = "TestApp-${BusinessCard2KT::class.java.simpleName}"
    }

    private val binding: BusinessCardBinding by lazy {
        // å°†å¸ƒå±€æ–‡ä»¶æ¸²æŸ“ç”ŸæˆViewå®ä¾‹
        BusinessCardBinding.inflate(LayoutInflater.from(context), this, true)
    }

    init {
        // åˆå§‹åŒ–è§†å›¾
        // æ­¤å¤„ç•™ç©ºï¼Œå› ä¸º"binding"å˜é‡å·²ç»é€šè¿‡"lazy"å‡½æ•°å»¶è¿Ÿåˆå§‹åŒ–ã€‚

        // å¦‚æœå½“å‰å®ä¾‹ä¸æ˜¯é€šè¿‡å¸ƒå±€æ–‡ä»¶ç”Ÿæˆçš„ï¼Œåˆ™ä¸å¿…è§£æXMLå±æ€§ã€‚
        if (attrs != null) {
            // è·å–è‡ªå®šä¹‰å±æ€§æ•°ç»„
            val ta: TypedArray =
                context.obtainStyledAttributes(attrs, R.styleable.BusinessCard2, defStyleAttr, defStyleRes)
            ta.use {
                if (ta.hasValue(R.styleable.BusinessCard2_name)) {
                    val name: String? = ta.getString(R.styleable.BusinessCard2_name)
                    binding.tvName.text = name
                }
                if (ta.hasValue(R.styleable.BusinessCard2_phone)) {
                    val phone: String? = ta.getString(R.styleable.BusinessCard2_phone)
                    binding.tvPhone.text = phone
                }
                if (ta.hasValue(R.styleable.BusinessCard2_avatar)) {
                    val avatar: Drawable? = ta.getDrawable(R.styleable.BusinessCard2_avatar)
                    binding.ivAvatar.setImageDrawable(avatar)
                }
            }
        }
    }
}
```

`attrs` ã€ `defStyleAttr` å’Œ `defStyleRes` å‚æ•°åªåœ¨LayoutInflaterè§£æå¸ƒå±€æ–‡ä»¶æ—¶æ‰ä¼šè¢«ä¼ é€’ï¼Œæˆ‘ä»¬é€šè¿‡ä»£ç åˆ›å»ºæ§ä»¶å®ä¾‹æ—¶åªä¼šè°ƒç”¨ `BusinessCard2(Context context)` æ„é€ æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿å‚æ•°è¾ƒå°‘çš„æ„é€ æ–¹æ³•è°ƒç”¨å‚æ•°è¾ƒå¤šçš„æ„é€ æ–¹æ³•ï¼Œå¹¶å°†å¤šä½™çš„å‚æ•°è®¾ä¸ºé»˜è®¤å€¼ï¼Œæ­¤æ—¶åˆå§‹åŒ–é€»è¾‘åªéœ€è¦åœ¨å‚æ•°æœ€å¤šçš„æ„é€ æ–¹æ³•ä¸­ç»Ÿä¸€ç¼–å†™ï¼Œæˆ‘ä»¬æ ¹æ® `attrs` æ˜¯å¦ä¸ºç©ºå€¼å³å¯åˆ¤æ–­æ˜¯å¦éœ€è¦è§£æXMLå±æ€§ï¼Œä¸å¿…ä¸ºæ¯ä¸ªæ„é€ æ–¹æ³•å•ç‹¬ç¼–å†™åˆå§‹åŒ–é€»è¾‘ã€‚

XMLå±æ€§å‚æ•° `attrs` æ˜¯AttributeSetç±»å‹ï¼Œå±æ€§çš„å€¼ä¸ºåŸå§‹æ–‡æœ¬æˆ–èµ„æºå¼•ç”¨åœ°å€ï¼Œä¸ä¾¿äºæˆ‘ä»¬è¿›ä¸€æ­¥ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡Contextå®ä¾‹çš„ `obtainStyledAttributes()` æ–¹æ³•å°†AttributeSetè½¬æ¢ä¸ºTypedArrayã€‚

TypedArrayæä¾›äº†æ•°æ®ç±»å‹è½¬æ¢å’Œè§£èµ„æºå¼•ç”¨çš„åŠŸèƒ½ï¼Œæ­¤å¤„æˆ‘ä»¬é¦–å…ˆé€šè¿‡ `hasValue(int index)` æ–¹æ³•åˆ¤æ–­æ§ä»¶è°ƒç”¨è€…æ˜¯å¦åœ¨å¸ƒå±€æ–‡ä»¶ä¸­æŒ‡å®šäº†å¯¹åº”çš„å±æ€§ï¼Œè‹¥å±æ€§å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ `getString(int index)` ã€ `getDrawable(int index)` ç­‰æ–¹æ³•å°†å±æ€§å€¼è½¬ä¸ºå¯¹åº”ç±»å‹ï¼Œç„¶åè®¾ç½®åˆ°å­æ§ä»¶ä¸Šã€‚

è‡³æ­¤ï¼Œè‡ªå®šä¹‰æ§ä»¶â€œåç‰‡â€å·²ç»æ”¯æŒäº†XMLå±æ€§è§£æèƒ½åŠ›ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ‡æ¢åˆ°æ§ä»¶è°ƒç”¨è€…è§†è§’ï¼Œåˆ›å»ºæ§ä»¶å®ä¾‹å¹¶ä½¿ç”¨å®ƒã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•Activityçš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ â€œåç‰‡â€æ§ä»¶ï¼Œå¹¶ä½¿ç”¨å‰æ–‡å®šä¹‰çš„ä¸‰ä¸ªå±æ€§è®¾ç½®æ•°æ®ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.BusinessCard2
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    app:avatar="@drawable/ic_funny_256"
    app:name="ç”°æ‰€æµ©äºŒ"
    app:phone="11451419198" />
```

## å±æ€§ç±»å‹
### åŸºæœ¬æ•°æ®
åŸºæœ¬æ•°æ®ç±»å‹å±æ€§åŒ…æ‹¬å¸ƒå°”å‹ã€æ•´å‹ã€æµ®ç‚¹å‹ä¸‰ç§æ•°æ®ã€‚

TypedArrayæä¾›äº†ä»¥ä¸‹æ–¹æ³•ç”¨äºä»XMLè§£æåŸºæœ¬æ•°æ®ç±»å‹å±æ€§çš„å€¼ï¼š

- `boolean getBoolean(int index, boolean defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºå¸ƒå°”å€¼ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚
- `int getInt(int index, int defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºæ•´å‹å€¼ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚
- `int getInteger(int index, int defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºæ•´å‹å€¼ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ï¼›è‹¥ç±»å‹ä¸åŒ¹é…åˆ™æŠ›å‡ºUnsupportedOperationExceptionå¼‚å¸¸
- `float getFloat(int index, float defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºæµ®ç‚¹å€¼ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨Kotlinè¯­è¨€å¹¶å¼•å…¥äº† `core-ktx` ç»„ä»¶ï¼Œè¿˜å¯ä»¥è°ƒç”¨TypedArrayæä¾›çš„ä¸€äº›æ‰©å±•æ–¹æ³•ï¼š

- `getBooleanOrThrow(index: Int): Boolean`
- `getIntOrThrow(index: Int): Int`
- `getIntegerOrThrow(index: Int): Int`
- `getFloatOrThrow(index: Int): Float`

å®ƒä»¬ä¸åŒå‰ç¼€çš„Javaæ–¹æ³•åŠŸèƒ½ç±»ä¼¼ï¼Œä½†è¦æ±‚æ§ä»¶è°ƒç”¨è€…å¿…é¡»æŒ‡å®š `index` å¯¹åº”çš„å±æ€§ï¼Œå¦åˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚

ğŸŸ¡ ç¤ºä¾‹ä¸‰ï¼šåŸºæœ¬æ•°æ®ç±»å‹å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›åŸºæœ¬æ•°æ®ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šåŸºæœ¬æ•°æ®ç±»å‹ -->
        <attr name="booleanValue" format="boolean" />
        <attr name="integerValue" format="integer" />
        <attr name="floatValue" format="float" />
    </declare-styleable>
</resources>
```

åä¸º `booleanValue` çš„å±æ€§å€¼æ˜¯å¸ƒå°”ç±»å‹ï¼›åä¸º `integerValue` çš„å±æ€§å€¼æ˜¯æ•´å‹ï¼›åä¸º `floatValue` çš„å±æ€§å€¼æ˜¯æµ®ç‚¹å‹ã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// è·å–å¸ƒå°”å€¼
boolean booleanValue = ta.getBoolean(R.styleable.AttrTypes_booleanValue, false);
tvBooleanValue.setText(booleanValue + "");

// è·å–æ•´å‹å€¼
int intValue = ta.getInt(R.styleable.AttrTypes_integerValue, 0);
tvIntegerValue.setText(intValue + "");

// è·å–æµ®ç‚¹å€¼
float floatValue = ta.getFloat(R.styleable.AttrTypes_floatValue, 0.0F);
tvFloatValue.setText(floatValue + "");

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // è·å–å¸ƒå°”å€¼
    val booleanValue: Boolean = it.getBoolean(R.styleable.AttrTypes_booleanValue, false)
    tvBooleanValue.text = booleanValue.toString()

    // è·å–æ•´å‹å€¼
    val intValue: Int = it.getInt(R.styleable.AttrTypes_integerValue, 0)
    tvIntegerValue.text = intValue.toString()

    // è·å–æµ®ç‚¹å€¼
    val floatValue: Float = it.getFloat(R.styleable.AttrTypes_floatValue, 0.0F)
    tvFloatValue.text = floatValue.toString()
}
```

ä»¥ `getBoolean()` æ–¹æ³•ä¸ºä¾‹ï¼Œå®ƒä¼šå°è¯•å°† `R.styleable.AttrTypes_booleanValue` å±æ€§çš„å€¼è½¬æ¢ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¦‚æœè°ƒç”¨è€…æ²¡æœ‰å®šä¹‰è¯¥å±æ€§ï¼Œæˆ–å±æ€§å€¼æ— æ³•è¢«è¯†åˆ«ä¸ºå¸ƒå°”ç±»å‹ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `false` ã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:booleanValue="true"
    app:floatValue="0.05"
    app:integerValue="-1000" />
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼ŒAttrTestViewåº”å½“æ˜¾ç¤ºäº†XMLä¸­æ‰€è®¾ç½®çš„å€¼ã€‚

### æ–‡æœ¬
æ–‡æœ¬ç±»å‹åŒ…æ‹¬æ— æ ¼å¼çš„æ™®é€šå­—ç¬¦ä¸²å’ŒåŒ…å«æ ¼å¼çš„å­—ç¬¦åºåˆ—ã€‚

TypedArrayæä¾›äº†ä»¥ä¸‹æ–¹æ³•ç”¨äºä»XMLè§£ææ–‡æœ¬ç±»å‹å±æ€§çš„å€¼ï¼š

- `String getString(int index)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºå­—ç¬¦ä¸²ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§åˆ™è¿”å›ç©ºå€¼ï¼›è‹¥å±æ€§ä¸ºéå­—ç¬¦ä¸²çš„å¼•ç”¨ç±»å‹ï¼Œåˆ™è¿”å›èµ„æºè·¯å¾„ã€‚
- `CharSequence getText(int index)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºå­—ç¬¦åºåˆ—ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§åˆ™è¿”å›ç©ºå€¼ï¼›è‹¥å±æ€§ä¸ºéå­—ç¬¦ä¸²çš„å¼•ç”¨ç±»å‹ï¼Œåˆ™è¿”å›èµ„æºè·¯å¾„ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨Kotlinè¯­è¨€å¹¶å¼•å…¥äº† `core-ktx` ç»„ä»¶ï¼Œè¿˜å¯ä»¥è°ƒç”¨TypedArrayæä¾›çš„ä¸€äº›æ‰©å±•æ–¹æ³•ï¼š

- `getStringOrThrow(index: Int): String`
- `getTextOrThrow(index: Int): CharSequence`

å®ƒä»¬ä¸åŒå‰ç¼€çš„Javaæ–¹æ³•åŠŸèƒ½ç±»ä¼¼ï¼Œä½†è¦æ±‚æ§ä»¶è°ƒç”¨è€…å¿…é¡»æŒ‡å®š `index` å¯¹åº”çš„å±æ€§ï¼Œå¦åˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚

ğŸŸ¢ ç¤ºä¾‹å››ï¼šæ–‡æœ¬ç±»å‹å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›æ–‡æœ¬ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šæ–‡æœ¬ç±»å‹ -->
        <attr name="textValue1" format="string" />
        <attr name="textValue2" format="string" />
    </declare-styleable>
</resources>
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// è·å–æ–‡æœ¬ï¼ˆå¿½ç•¥æ ¼å¼ï¼‰
String textValue1 = ta.getString(R.styleable.AttrTypes_textValue1);
tvTextValue1.setText(textValue1);

// è·å–æ–‡æœ¬ï¼ˆè§£ææ ¼å¼ï¼‰
CharSequence textValue2 = ta.getText(R.styleable.AttrTypes_textValue2);
tvTextValue2.setText(textValue2);

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // è·å–æ–‡æœ¬ï¼ˆå¿½ç•¥æ ¼å¼ï¼‰
    val textValue1: String? = it.getString(R.styleable.AttrTypes_textValue1)
    tvTextValue1.text = textValue1

    // è·å–æ–‡æœ¬ï¼ˆè§£ææ ¼å¼ï¼‰
    val textValue2: CharSequence? = it.getText(R.styleable.AttrTypes_textValue2)
    tvTextValue2.text = textValue2
}
```

`getString()` æ–¹æ³•å°†ä¼šè¿”å›å­—ç¬¦ä¸²å¹¶å¿½ç•¥æ ¼å¼ï¼›è€Œ `getText()` æ–¹æ³•å°†ä¼šè¿”å›å¸¦æœ‰æ ¼å¼çš„å­—ç¬¦åºåˆ—ã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:textValue1="@string/text_with_format"
    app:textValue2="@string/text_with_format" />
```

æ­¤å¤„çš„ `text_with_format` å†…å®¹ä¸º `AB<b>CD</b>EF` ï¼Œä¸­é—´ä¸¤ä¸ªå­—ç¬¦å¸¦æœ‰åŠ ç²—æ ¼å¼ã€‚

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹ç•Œé¢å¤–è§‚ï¼š

<div align="center">

![æ–‡æœ¬å±æ€§ç¤ºä¾‹](./Assets_æ¦‚è¿°/XMLå±æ€§_æ–‡æœ¬å±æ€§ç¤ºä¾‹.jpg)

</div>

### å°ºå¯¸
å°ºå¯¸ç±»å‹åŒ…æ‹¬å•ä½ä¸º `dp` ã€ `sp` ã€ `px` ç­‰çš„é•¿åº¦å€¼ã€‚

TypedArrayæä¾›äº†ä»¥ä¸‹æ–¹æ³•ç”¨äºä»XMLè§£æå°ºå¯¸ç±»å‹å±æ€§çš„å€¼ï¼š

- `float getDimension(int index, float defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºåƒç´ å€¼ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚
- `int getDimensionPixelSize(int index, int defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºåƒç´ å€¼ï¼Œå¦‚æœæœ‰å°æ•°éƒ¨åˆ†ï¼Œåˆ™å››èˆäº”å…¥åˆ°æ•´æ•°ã€‚è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚
- `int getDimensionPixelOffset(int index, int defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºåƒç´ å€¼ï¼Œå¦‚æœæœ‰å°æ•°éƒ¨åˆ†ï¼Œåˆ™ä¸¢å¼ƒå¹¶æˆªæ–­åˆ°æ•´æ•°ã€‚è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨Kotlinè¯­è¨€å¹¶å¼•å…¥äº† `core-ktx` ç»„ä»¶ï¼Œè¿˜å¯ä»¥è°ƒç”¨TypedArrayæä¾›çš„ä¸€äº›æ‰©å±•æ–¹æ³•ï¼š

- `getDimensionOrThrow(index: Int): Float`
- `getDimensionPixelSizeOrThrow(index: Int): Int`
- `getDimensionPixelOffset(index: Int): Int`

å®ƒä»¬ä¸åŒå‰ç¼€çš„Javaæ–¹æ³•åŠŸèƒ½ç±»ä¼¼ï¼Œä½†è¦æ±‚æ§ä»¶è°ƒç”¨è€…å¿…é¡»æŒ‡å®š `index` å¯¹åº”çš„å±æ€§ï¼Œå¦åˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚

ğŸ”µ ç¤ºä¾‹äº”ï¼šå°ºå¯¸ç±»å‹å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›å°ºå¯¸ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šå°ºå¯¸ç±»å‹ -->
        <attr name="dimenValue" format="dimension" />
    </declare-styleable>
</resources>
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// è§£æå°ºå¯¸ä¸ºåƒç´ å€¼
Float dimenValue = ta.getDimension(R.styleable.AttrTypes_dimenValue, 1.0F);
tvDimenValue.setText(dimenValue + "");

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // è§£æå°ºå¯¸ä¸ºåƒç´ å€¼
    val dimenValue1: Float = it.getDimension(R.styleable.AttrTypes_dimenValue, 1.0F)
    tvDimenValue.text = dimenValue1.toString()
}
```

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:dimenValue="100dp" />
```

æ­¤å¤„æˆ‘ä»¬è®¾ç½®çš„é•¿åº¦ä¸º `100dp` ï¼Œ`dimenValue1` çš„å€¼åœ¨ç¼©æ”¾å€æ•°ä¸º2çš„è®¾å¤‡ä¸Šåº”å½“ä¸º `200` ï¼Œä»¥æ­¤ç±»æ¨ã€‚

### æ¯”ä¾‹
æœ‰æ—¶æˆ‘ä»¬ä¸ä¼šæ˜ç¡®åœ°è®¾ç½®é•¿åº¦å€¼ï¼Œè€Œæ˜¯ä½¿ç”¨æ¯”ä¾‹æè¿°é•¿åº¦ï¼Œä¾‹å¦‚ï¼šâ€œå½“å‰æ§ä»¶çš„å®½åº¦ä¸ºçˆ¶æ§ä»¶çš„ä¸€åŠâ€ç­‰ã€‚

TypedArrayæä¾›äº†ä»¥ä¸‹æ–¹æ³•ç”¨äºä»XMLè§£æå°ºå¯¸ç±»å‹å±æ€§çš„å€¼ï¼š

- `float getFraction(int index, int base, int pbase, float defValue)` : å°†å±æ€§ `index` çš„æ¯”ä¾‹è§£æä¸ºæ•°å€¼ï¼Œå¦‚æœå±æ€§ä¸º `50%` ç±»ä¼¼çš„æ ¼å¼ï¼Œåˆ™è¿”å› `base * 50%` ï¼Œå¦‚æœå±æ€§ä¸º `25%p` ç±»ä¼¼çš„æ ¼å¼ï¼Œåˆ™è¿”å› `pbase * 25%` ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚

ğŸŸ£ ç¤ºä¾‹å…­ï¼šæ¯”ä¾‹ç±»å‹å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›æ¯”ä¾‹ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šæ¯”ä¾‹ç±»å‹ -->
        <attr name="fractionValue1" format="fraction" />
        <attr name="fractionValue2" format="fraction" />
    </declare-styleable>
</resources>
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// è§£ææ¯”ä¾‹
float fractionValue1 = ta.getFraction(R.styleable.AttrTypes_fractionValue1, 500, 1000, 1.0F);
tvFractionValue1.setText(fractionValue1 + "");

// è§£ææ¯”ä¾‹
float fractionValue2 = ta.getFraction(R.styleable.AttrTypes_fractionValue2, 500, 1000, 1.0F);
tvFractionValue2.setText(fractionValue2 + "");

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // è§£ææ¯”ä¾‹
    val fractionValue1: Float = it.getFraction(R.styleable.AttrTypes_fractionValue1, 500, 1000, 1.0f)
    tvFractionValue1.text = fractionValue1.toString()

    // è§£ææ¯”ä¾‹
    val fractionValue2: Float = it.getFraction(R.styleable.AttrTypes_fractionValue2, 500, 1000, 1.0f)
    tvFractionValue2.text = fractionValue2.toString()
}
```

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:fractionValue1="50%"
    app:fractionValue2="50%p" />
```

æ­¤å¤„æˆ‘ä»¬æŒ‡å®š `fractionValue1` å±æ€§çš„å€¼ä¸º `50%` ï¼Œå› æ­¤ä»£ç ä¸­è·å–åˆ°çš„å€¼åº”ä¸º `50% * 500 = 250` ï¼›è€Œ `fractionValue2` å±æ€§çš„å€¼ä¸º `50%p` ï¼Œä»£ç ä¸­è·å–åˆ°çš„å€¼åº”ä¸º `50% * 1000 = 500` ã€‚

åœ¨ç³»ç»Ÿå†…ç½®æ§ä»¶ä¸­ï¼Œæ¯”ä¾‹ç±»å‹çš„å±æ€§é€šå¸¸ç”¨äºè®¾ç½®å°ºå¯¸ï¼Œä½†å®ƒåœ¨ç¨‹åºä¸­è¡¨ç°ä¸ºä¸€ä¸ªæµ®ç‚¹æ•°å€¼ï¼Œå› æ­¤å½“æˆ‘ä»¬è‡ªå®šä¹‰æ§ä»¶æ—¶ä¹Ÿå¯ä»¥ç”¨å…¶è¡¨ç¤ºå…¶ä»–å«ä¹‰ã€‚

### é¢œè‰²
é¢œè‰²ç±»å‹åŒ…æ‹¬åå…­è¿›åˆ¶å½¢å¼çš„è‰²å€¼æˆ–å…¶ä»–é¢œè‰²èµ„æºçš„å¼•ç”¨ã€‚

TypedArrayæä¾›äº†ä»¥ä¸‹æ–¹æ³•ç”¨äºä»XMLè§£æé¢œè‰²ç±»å‹å±æ€§çš„å€¼ï¼š

- `int getColor(int index, @ColorInt int defValue)` : å°†å±æ€§ `index` çš„å€¼è§£æä¸ºæ•´å‹è‰²å€¼ï¼›è‹¥è°ƒç”¨è€…æœªæŒ‡å®šè¯¥å±æ€§æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `defValue` ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨Kotlinè¯­è¨€å¹¶å¼•å…¥äº† `core-ktx` ç»„ä»¶ï¼Œè¿˜å¯ä»¥è°ƒç”¨TypedArrayæä¾›çš„ä¸€äº›æ‰©å±•æ–¹æ³•ï¼š

- `getColorOrThrow(index: Int): Int`

å®ƒä»¬ä¸åŒå‰ç¼€çš„Javaæ–¹æ³•åŠŸèƒ½ç±»ä¼¼ï¼Œä½†è¦æ±‚æ§ä»¶è°ƒç”¨è€…å¿…é¡»æŒ‡å®š `index` å¯¹åº”çš„å±æ€§ï¼Œå¦åˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚

ğŸŸ¤ ç¤ºä¾‹ä¸ƒï¼šé¢œè‰²ç±»å‹å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›é¢œè‰²ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šé¢œè‰²ç±»å‹ -->
        <attr name="colorValue" format="color" />
    </declare-styleable>
</resources>
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// è§£æé¢œè‰²å±æ€§çš„å€¼ä¸ºè‰²å€¼
@ColorInt
int colorValue = ta.getColor(R.styleable.AttrTypes_colorValue, Color.BLACK);
tvColorValue.setTextColor(colorValue);

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // è§£æé¢œè‰²å±æ€§çš„å€¼ä¸ºè‰²å€¼
    @ColorInt
    val colorValue: Int = it.getColor(R.styleable.AttrTypes_colorValue, Color.BLACK)
    tvColorValue.setTextColor(colorValue)
}
```

`getColor()` æ–¹æ³•ä¼šå°è¯•å°† `R.styleable.AttrTypes_colorValue` å±æ€§çš„å€¼è½¬æ¢ä¸ºè‰²å€¼ï¼Œå¦‚æœè°ƒç”¨è€…æ²¡æœ‰å®šä¹‰è¯¥å±æ€§ï¼Œæˆ–å±æ€§å€¼æ— æ³•è¢«è¯†åˆ«ä¸ºè‰²å€¼ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ `Color.BLACK` ã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:colorValue="@color/purple_700" />
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼ŒAttrTestViewä¸­çš„ `tvColorValue` æ–‡æœ¬é¢œè‰²åº”å½“å·²è¢«è®¾ç½®ä¸º `purple_700` ã€‚

### æšä¸¾
æšä¸¾å±æ€§å¯ä»¥ä¸ºå±æ€§çš„å€¼èµ‹äºˆåç§°ï¼Œæé«˜é…ç½®æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”è¿˜çº¦æŸäº†è°ƒç”¨è€…çš„è¾“å…¥å†…å®¹ï¼Œé˜²æ­¢ä¼ å…¥æ— æ„ä¹‰çš„å€¼ã€‚

ğŸ”´ ç¤ºä¾‹å…«ï¼šæšä¸¾ç±»å‹å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›æšä¸¾ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šæšä¸¾ç±»å‹ -->
        <attr name="enumValue" format="enum">
            <enum name="vertical" value="0" />
            <enum name="horizontal" value="1" />
        </attr>
    </declare-styleable>
</resources>
```

æ­¤å¤„æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª `enumValue` å±æ€§ï¼Œç”¨äºé…ç½®æ§ä»¶çš„å¸ƒå±€æ–¹å‘ï¼šå–å€¼ `vertical (0)` è¡¨ç¤ºæŒ‰å‚ç›´æ–¹å‘æ’å¸ƒå†…å®¹ï¼›å–å€¼ `horizontal (2)` è¡¨ç¤ºæŒ‰æ°´å¹³æ–¹å‘æ’å¸ƒå†…å®¹ã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// è·å–æšä¸¾å¯¹åº”çš„æ•´å‹å€¼
int enumIndex = ta.getInt(R.styleable.AttrTypes_enumValue, 0);
tvEnumValue.setText(enumIndex + "");

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // è·å–æšä¸¾å¯¹åº”çš„æ•´å‹å€¼
    val enumValue: Int = it.getInt(R.styleable.AttrTypes_enumValue, 0)
    tvEnumValue.text = enumValue.toString()
}
```

æšä¸¾å±æ€§åœ¨ä»£ç ä¸­çš„è¡¨ç°å½¢å¼ä¸ºæ•´å‹æ•°å€¼ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ `getInt()` æ–¹æ³•è·å–ï¼Œå€¼ä¸è°ƒç”¨è€…ä¼ å…¥æšä¸¾çš„ `value` å±æ€§ä¸€è‡´ã€‚è‹¥ä»£ç ä¸­æœ‰å«ä¹‰ç›¸åŒçš„æšä¸¾ç±»ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨æ­¤å¤„è·å–åˆ°çš„æ•°å€¼è¿›è¡Œè½¬æ¢ï¼Œä¾¿äºè¿›ä¸€æ­¥ä½¿ç”¨ã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:enumValue="horizontal" />
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œç”±äº `horizontal` çš„æ•°å€¼ä¸º `1` ï¼ŒAttrTestViewåº”å½“æ˜¾ç¤º `enumValue` çš„å€¼ä¹Ÿä¸º `1` ã€‚

### æ ‡å¿—ä½
æ ‡å¿—ä½å±æ€§çš„è¯­æ³•ä¸æšä¸¾ç±»ä¼¼ï¼Œä½†è°ƒç”¨è€…å¯ä»¥åŒæ—¶é€‰æ‹©å…¶ä¸­çš„å¤šä¸ªå€¼ï¼Œé€‚ç”¨äºæ§åˆ¶ä¸€ç»„åŠŸèƒ½çš„å¯ç”¨ä¸ç¦ç”¨ã€‚

ğŸŸ  ç¤ºä¾‹ä¹ï¼šæ ‡å¿—ä½å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›æ ‡å¿—ä½ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šæ ‡å¿—ä½ç±»å‹ -->
        <attr name="flagValue" format="flags">
            <flag name="none" value="0" />
            <flag name="vertical" value="0x1" />
            <flag name="horizontal" value="2" />
        </attr>
    </declare-styleable>
</resources>
```

æ­¤å¤„æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª `flagValue` å±æ€§ï¼Œç”¨äºé…ç½®æ§ä»¶éœ€è¦æ˜¾ç¤ºå“ªäº›æ»šåŠ¨æ¡ï¼šå–å€¼ `vertical (1)` è¡¨ç¤ºæ˜¾ç¤ºå‚ç›´æ»šåŠ¨æ¡ï¼›å–å€¼ `horizontal (2)` è¡¨ç¤ºæ˜¾ç¤ºæ°´å¹³æ»šåŠ¨æ¡ï¼›å–å€¼ `vertical|horizontal (0x01 | 0x10 = 0x11)` åˆ™è¡¨ç¤ºä¸¤ä¸ªæ–¹å‘çš„æ»šåŠ¨æ¡å‡æ˜¾ç¤ºã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// è·å–æ ‡å¿—ä½ç»„åˆå¯¹åº”çš„æ•´å‹å€¼
int flags = ta.getInt(R.styleable.AttrTypes_flagValue, 0);
tvFlagValue.setText(flags + "");

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // è·å–æ ‡å¿—ä½ç»„åˆå¯¹åº”çš„æ•´å‹å€¼
    val flags: Int = it.getInt(R.styleable.AttrTypes_flagValue, 0)
    tvFlagValue.text = flags.toString()
}
```

è·å–æ ‡å¿—ä½ç»„åˆæ•°å€¼ä¹Ÿéœ€è¦ä½¿ç”¨ `getInt()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¼šè¿”å›è°ƒç”¨è€…é…ç½®çš„æ‰€æœ‰æ ‡å¿—ä½æˆ–è¿ç®—ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å€¼å’Œæ¯ä¸ªåŠŸèƒ½ç‰¹æ€§å¯¹åº”çš„å€¼åˆ†åˆ«è¿›è¡Œä¸è¿ç®—ï¼Œè¿›ä¸€æ­¥å¤„ç†å“ªäº›åŠŸèƒ½éœ€è¦å¼€å¯ã€å“ªäº›åŠŸèƒ½éœ€è¦å…³é—­ã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:flagValue="horizontal|vertical" />
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œç”±äº `horizontal` å’Œ `vertical` éƒ½è¢«é…ç½®äº†ï¼ŒAttrTestViewåº”å½“æ˜¾ç¤º `flagValue` çš„å€¼ä¸º `3` ï¼Œå¯¹åº”äºŒè¿›åˆ¶çš„ `11` ã€‚

### å¼•ç”¨
é™¤äº†å‰æ–‡æ‰€æè¿°çš„å±æ€§ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–å±æ€§ç»Ÿä¸€è¢«å½’ç±»ä¸ºå¼•ç”¨ç±»å‹ï¼Œå¸¸è§çš„ç±»å‹æœ‰ï¼šå›¾åƒã€é¢œè‰²çŠ¶æ€åˆ—è¡¨å’Œæ–‡æœ¬æ•°ç»„ã€‚

å¯¹äºå¼•ç”¨ç±»å‹ï¼ŒXMLè¯­æ³•æ£€æŸ¥æ— æ³•çº¦æŸè°ƒç”¨è€…ä¼ å…¥çš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬åº”å½“åœ¨ç¨‹åºæ–‡æ¡£ä¸­æè¿°æ¸…æ¥šæ­¤ç±»å±æ€§æ”¯æŒçš„ç±»å‹ï¼Œå¹¶åœ¨ä»£ç ä¸­æ·»åŠ å®¹é”™æœºåˆ¶ã€‚

ğŸŸ¡ ç¤ºä¾‹åï¼šå¼•ç”¨å±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›å¼•ç”¨ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šå¼•ç”¨ç±»å‹ -->
        <attr name="refValue1" format="reference" />
        <attr name="refValue2" format="reference" />
        <attr name="refValue3" format="reference" />
    </declare-styleable>
</resources>
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// å°†èµ„æºè§£æä¸ºDrawable
Drawable drawable = ta.getDrawable(R.styleable.AttrTypes_refValue1);
ivRefType1.setImageDrawable(drawable);

// å°†èµ„æºè§£æä¸ºColorStateList
ColorStateList csl = ta.getColorStateList(R.styleable.AttrTypes_refValue2);
cbRefType2.setTextColor(csl);

// å°†èµ„æºè§£æä¸ºCharSequenceæ•°ç»„
CharSequence[] array = ta.getTextArray(R.styleable.AttrTypes_refValue3);
tvRefType3.setText(TextUtils.concat(array));

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // å°†èµ„æºè§£æä¸ºDrawable
    val drawable: Drawable? = it.getDrawable(R.styleable.AttrTypes_refValue1)
    ivRefType1.setImageDrawable(drawable)

    // å°†èµ„æºè§£æä¸ºColorStateList
    val colorStateList: ColorStateList? = it.getColorStateList(R.styleable.AttrTypes_refValue2)
    cbRefType2.setTextColor(colorStateList)

    // å°†èµ„æºè§£æä¸ºCharSequenceæ•°ç»„
    val array: Array<CharSequence> = it.getTextArray(R.styleable.AttrTypes_refValue3)
    tvRefType3.text = array.joinToString()
}
```

å±æ€§ `refValue1` ç”¨äºæ¥æ”¶å›¾åƒèµ„æºï¼Œæˆ‘ä»¬ä½¿ç”¨ `getDrawable()` æ–¹æ³•å°†å…¶è§£æä¸ºDrawableå¯¹è±¡ï¼›å±æ€§ `refValue2` ç”¨äºæ¥æ”¶é¢œè‰²çŠ¶æ€åˆ—è¡¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ `getColorStateList()` æ–¹æ³•å°†å…¶è§£æä¸ºColorStateListå¯¹è±¡ï¼›å±æ€§ `refValue3` ç”¨äºæ¥æ”¶æ–‡æœ¬æ•°ç»„ï¼Œæˆ‘ä»¬ä½¿ç”¨ `getTextArray()` æ–¹æ³•å°†å…¶è§£æä¸ºCharSequenceæ•°ç»„ã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°è°ƒç”¨è€…è§†è§’ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä¸ºAttrTestViewæŒ‡å®šå±æ€§ä¸å€¼ã€‚

"testui_xmlattrs.xml":

```xml
<net.bi4vmr.study.xmlattrs.AttrTestView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:refValue1="@drawable/ic_funny_256"
    app:refValue2="@color/color_state_list"
    app:refValue3="@array/text_array" />
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹ç•Œé¢å¤–è§‚ï¼š

<div align="center">

![å¼•ç”¨å±æ€§ç¤ºä¾‹](./Assets_æ¦‚è¿°/XMLå±æ€§_å¼•ç”¨å±æ€§ç¤ºä¾‹.gif)

</div>

### ç»„åˆç±»å‹
TypedArrayçš„éƒ¨åˆ†æ–¹æ³•èƒ½å¤Ÿè§£æå¤šç§ç±»å‹çš„åŸå§‹æ•°æ®ï¼Œä¾‹å¦‚ `getDrawable()` æ–¹æ³•èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¹¶è§£æé¢œè‰²ã€Drawableã€Mipmapç­‰èµ„æºã€‚

ğŸŸ¢ ç¤ºä¾‹åä¸€ï¼šç»„åˆå±æ€§çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›æ”¯æŒå¤šç§ç±»å‹çš„XMLå±æ€§ï¼Œå¹¶åœ¨è‡ªå®šä¹‰Viewä¸­è§£æå®ƒä»¬ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨èµ„æºæ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼Œå£°æ˜ä¸€äº›å±æ€§ï¼š

"attrs_type.xml":

```xml
<resources>
    <declare-styleable name="AttrTypes">
        <!-- å®šä¹‰å±æ€§ï¼šç»„åˆç±»å‹ -->
        <attr name="multiTypeValue" format="color|reference" />
    </declare-styleable>
</resources>
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨è‡ªå®šä¹‰æ§ä»¶ä¸­ç¼–å†™é€»è¾‘ä»£ç ï¼Œä»æ§ä»¶çš„XMLå±æ€§ä¸­è§£æå±æ€§å€¼ã€‚

"AttrTestView.java":

```java
TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.AttrTypes);

// å°†èµ„æºè§£æä¸ºDrawable
Drawable drawable = ta.getDrawable(R.styleable.AttrTypes_multiTypeValue);
ivMultiTypes.setImageDrawable(drawable);

ta.recycle();
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"AttrTestViewKT.kt":

```kotlin
context.obtainStyledAttributes(attrs, R.styleable.AttrTypes).use {
    // å°†èµ„æºè§£æä¸ºDrawable
    val drawable: Drawable? = it.getDrawable(R.styleable.AttrTypes_multiTypeValue)
    ivMultiTypes.setImageDrawable(drawable)
}
```

`getDrawable()` æ–¹æ³•èƒ½å¤Ÿè‡ªåŠ¨è§£æå¤šç§å±æ€§å€¼ï¼Œå¦‚æœå±æ€§å€¼æ˜¯é¢œè‰²èµ„æºï¼Œåˆ™è¿”å›ColorDrawableï¼›å¦‚æœå±æ€§å€¼æ˜¯å›¾åƒèµ„æºï¼Œåˆ™è¿”å›BitmapDrawableã€‚

æ­¤æ—¶è°ƒç”¨è€…å¯ä»¥è®¾ç½® `app:multiTypeValue="@drawable/ic_funny_256"` æˆ– `app:multiTypeValue="#00FF00"` ï¼ŒäºŒè€…å‡èƒ½è¢«æ­£å¸¸è§£æã€‚
