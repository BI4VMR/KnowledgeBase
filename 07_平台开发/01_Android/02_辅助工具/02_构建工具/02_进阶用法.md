# BuildConfig
## ç®€ä»‹
BuildConfigæ˜¯Gradleåœ¨æ„å»ºè¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªJavaç±»ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ç³»åˆ—çš„é™æ€å¸¸é‡ï¼Œç”¨äºæè¿°æ¨¡å—çš„æ„å»ºç¯å¢ƒï¼Œä¾‹å¦‚ï¼šæ„å»ºå˜ä½“ã€ç‰ˆæœ¬å·ç­‰ã€‚

BuildConfigæ–‡ä»¶ä¸Ræ–‡ä»¶ç±»ä¼¼ï¼Œå®ƒçš„ç”Ÿæˆä½ç½®ç”±å½“å‰æ¨¡å—çš„å‘½åç©ºé—´å±æ€§å†³å®šï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å…¶ä¸­æ‰€åŒ…å«çš„é»˜è®¤å¸¸é‡ï¼š

"BuildConfig.java":

```java
package net.bi4vmr.study;

public final class BuildConfig {
    // å…¬å…±å±æ€§ï¼šæ˜¯å¦å…è®¸è°ƒè¯•
    public static final boolean DEBUG = false;
    // å…¬å…±å±æ€§ï¼šæ„å»ºå˜ä½“åç§°
    public static final String BUILD_TYPE = "release";

    // LIBæ¨¡å—ä¸“æœ‰å±æ€§ï¼šå‘½åç©ºé—´åç§°
    public static final String LIBRARY_PACKAGE_NAME = "net.bi4vmr.study";

    // APPæ¨¡å—ä¸“æœ‰å±æ€§ï¼šåº”ç”¨ç¨‹åºåŒ…å
    public static final String APPLICATION_ID = "net.bi4vmr.study";
    // APPæ¨¡å—ä¸“æœ‰å±æ€§ï¼šç‰ˆæœ¬å·
    public static final int VERSION_CODE = 1;
    // APPæ¨¡å—ä¸“æœ‰å±æ€§ï¼šç‰ˆæœ¬åç§°
    public static final String VERSION_NAME = "1.0.0";
}
```

æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„é€»è¾‘ä»£ç ä¸­è®¿é—®è¿™äº›å¸¸é‡ï¼Œä»¥ä¾¿äº†è§£ç¼–è¯‘é˜¶æ®µçš„ç›¸å…³é…ç½®ï¼ŒåŠ¨æ€åœ°æ”¹å˜ç¨‹åºçš„è¡Œä¸ºã€‚

ğŸ”´ ç¤ºä¾‹ä¸€ï¼šé€šè¿‡BuildConfigæ§åˆ¶æ—¥å¿—è¾“å‡ºã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¯»å–BuildConfigç±»ä¸­çš„ `DEBUG` å¸¸é‡ï¼Œå½“è¯¥å±æ€§ä¸º"false"æ—¶ï¼Œå…³é—­æ—¥å¿—è¾“å‡ºï¼›å½“è¯¥å±æ€§ä¸º"true"æ—¶ï¼Œå¼€å¯æ—¥å¿—è¾“å‡ºã€‚

"App.java":

```java
if (BuildConfig.DEBUG) {
    LogUtil.printOn();
} else {
    LogUtil.printOff();
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"App.kt":

```kotlin
if (BuildConfig.DEBUG) {
    LogUtil.printOn()
} else {
    LogUtil.printOff()
}
```

> ğŸš© æç¤º
>
> BuildConfigæ–‡ä»¶åœ¨æ¨¡å—é¦–æ¬¡è¢«æ„å»ºæˆåŠŸæ—¶æ‰ä¼šç”Ÿæˆï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¼–å†™ä¸Šè¿°ä»£ç ä¹‹å‰åº”å½“å…ˆæ‰§è¡Œä¸€æ¬¡æ„å»ºã€‚

## åŠŸèƒ½å¼€å…³
åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒBuildConfigæ–‡ä»¶å°†ä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›ç¦æ­¢ç”Ÿæˆè¯¥æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šä¸¤ä¸ªLIBæ¨¡å—éƒ½ä½¿ç”¨äº†ç›¸åŒçš„å‘½åç©ºé—´ï¼Œå½“æŸä¸ªAPPæ¨¡å—åŒæ—¶ä¾èµ–è¿™ä¸¤ä¸ªLIBæ¨¡å—æ—¶ï¼ŒLIBæ¨¡å—çš„BuildConfigæ–‡ä»¶å°±ä¼šäº§ç”Ÿå†²çªã€‚

æˆ‘ä»¬å¯ä»¥åœ¨LIBæ¨¡å—Gradleé…ç½®æ–‡ä»¶çš„ `android {}` å°èŠ‚ä¸­æ·»åŠ ä»¥ä¸‹è¯­å¥ï¼Œæ§åˆ¶æ˜¯å¦ç”ŸæˆBuildConfigæ–‡ä»¶ï¼š

"build.gradle":

```groovy
android {
    buildFeatures {
        // æ§åˆ¶æ˜¯å¦ç”ŸæˆBuildConfigæ–‡ä»¶
        buildConfig = false
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    buildFeatures {
        // æ§åˆ¶æ˜¯å¦ç”ŸæˆBuildConfigæ–‡ä»¶
        buildConfig = false
    }
}
```

## æ·»åŠ è‡ªå®šä¹‰å¸¸é‡
æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æ¨¡å—çš„Gradleé…ç½®æ–‡ä»¶ï¼Œå‘BuildConfigç±»ä¸­æ·»åŠ æ–°çš„å¸¸é‡ï¼Œå¹¶åœ¨æ„å»ºè¿‡ç¨‹ä¸­èµ‹å€¼ï¼Œæé«˜ç¨‹åºçš„çµæ´»ç¨‹åº¦ã€‚

ğŸŸ  ç¤ºä¾‹äºŒï¼šé€šè¿‡BuildConfigæ§åˆ¶ç¨‹åºéœ€è¦ä½¿ç”¨çš„æœåŠ¡å™¨ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘BuildConfigç±»æ·»åŠ  `SERVER_NAME` å¸¸é‡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨çš„åŸŸåï¼Œå½“æ„å»ºç±»å‹ä¸º"debug"æ—¶ä½¿ç”¨æµ‹è¯•æœåŠ¡å™¨ï¼›å½“æ„å»ºç±»å‹ä¸º"release"æ—¶åˆ™ä½¿ç”¨ç”Ÿäº§æœåŠ¡å™¨ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å½“å‰æ¨¡å—çš„Gradleé…ç½®æ–‡ä»¶ï¼Œåœ¨æ¯ç§æ„å»ºç±»å‹ä¸­æ·»åŠ å¸¸é‡å¹¶è®¾ç½®å¯¹åº”çš„å€¼ã€‚

"build.gradle":

```groovy
android {
    buildTypes {
        debug {
            buildConfigField 'String', 'SERVER_NAME', '\"http://test.example.net/\"'
        }

        release {
            buildConfigField 'String', 'SERVER_NAME', '\"http://prod.example.net/\"'
        }
    }
}
```

`buildConfigField(String type, String name, String value)` æ–¹æ³•ç”¨äºæ·»åŠ BuildConfigå¸¸é‡ï¼Œç¬¬ä¸€å‚æ•° `type` è¡¨ç¤ºå¸¸é‡ç±»å‹ï¼Œæ­¤å¤„åº”å½“å¡«å†™ä¸ºå­—ç¬¦å½¢å¼çš„Javaæˆ–Kotlinæ•°æ®ç±»å‹ï¼›ç¬¬äºŒå‚æ•° `name` è¡¨ç¤ºå¸¸é‡åç§°ï¼›ç¬¬ä¸‰å‚æ•° `value` è¡¨ç¤ºå¸¸é‡çš„å€¼ï¼Œå½“å¸¸é‡ç±»å‹ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è½¬ä¹‰ç¬¦å·è¡¨ç¤ºå­—é¢é‡é¦–å°¾çš„åŒå¼•å·ã€‚

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    buildTypes {
        getByName("debug") {
            buildConfigField("String", "SERVER_NAME", "\"http://test.example.net/\"")
        }
        getByName("release") {
            buildConfigField("String", "SERVER_NAME", "\"http://prod.example.net/\"")
        }
    }
}
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡æ„å»ºä»»åŠ¡ï¼ŒBuildConfigæ–‡ä»¶ä¸­å°±ä¼šç”Ÿæˆ `SERVER_NAME` å¸¸é‡ã€‚

"BuildConfig.java":

```java
public final class BuildConfig {
    public static final String SERVER_NAME = "http://prod.example.net/";
}
```

æ­¤æ—¶æˆ‘ä»¬ä¾¿å¯ä»¥åœ¨é€»è¾‘ä»£ç ä¸­è¯»å– `SERVER_NAME` å¸¸é‡ï¼Œå¹¶å°†å¸¸é‡å€¼ä½œä¸ºæœåŠ¡å™¨URLã€‚


# Product Flavors
## ç®€ä»‹
Product Flavorsç”¨äºåŒºåˆ†ä¸åŒå‹å·çš„äº§å“ï¼Œæ¯ä¸ªFlavoråœ¨æ„å»ºåéƒ½å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„APKã€‚

Product Flavorså¯ä»¥æŒ‡å®šç‹¬ç«‹çš„ä¾èµ–ç»„ä»¶å¹¶æ”¹å†™ `defaultConfig {}` å°èŠ‚ä¸­çš„å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Flavoré…ç½®ä¸åŒçš„å‘å¸ƒæ¸ é“ï¼ˆä¾‹å¦‚ï¼šâ€œè½¯ä»¶å•†åŸAâ€ã€â€œè½¯ä»¶å•†åŸBâ€ç­‰ï¼‰æˆ–ä¸åŒçš„å¹³å°æ¶æ„ï¼ˆä¾‹å¦‚ï¼š"x86"ã€"arm"ç­‰ï¼‰ã€‚

## åŸºæœ¬åº”ç”¨
ä¸‹æ–‡ç¤ºä¾‹å±•ç¤ºäº†Product Flavorsçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚

ğŸŸ  ç¤ºä¾‹äºŒï¼šProduct Flavorsçš„åŸºæœ¬åº”ç”¨ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å£°æ˜â€œå‹å·Aâ€ä¸â€œå‹å·Bâ€ä¸¤ä¸ªFlavorï¼Œå¹¶åˆ†åˆ«è®¾ç½®ä¸åŒçš„åŒ…åä¸ç‰ˆæœ¬å±æ€§ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨å½“å‰æ¨¡å— `build.gradle` æ–‡ä»¶çš„ `android {}` å°èŠ‚ä¸­æ·»åŠ é…ç½®è¯­å¥ï¼Œå£°æ˜è‡ªå®šä¹‰Flavorã€‚

"build.gradle":

```groovy
android {
    defaultConfig {
        // æŒ‡å®šFlavorçš„ç»„åˆé¡ºåº
        flavorDimensions = ["default"]
    }

    // å£°æ˜Product Flavors
    productFlavors {
        // å£°æ˜ç¬¬ä¸€ä¸ªFlavor
        ModelA {
            // å®šä¹‰"ModelA"æ‰€å±çš„ç»´åº¦ä¸º"default"
            dimension "default"
            // æŒ‡å®šåŒ…å
            applicationId "net.bi4vmr.study.modela"
            // æŒ‡å®šç‰ˆæœ¬å·
            versionCode 1
            // æŒ‡å®šç‰ˆæœ¬åç§°
            versionName "1.0"
        }

        // å£°æ˜ç¬¬äºŒä¸ªFlavor
        ModelB {
            dimension "default"
            applicationId "net.bi4vmr.study.modelb"
            versionCode 2
            versionName "2.0"
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    defaultConfig {
        // æŒ‡å®šFlavorçš„ç»„åˆé¡ºåº
        flavorDimensions.add("default")
    }

    // å£°æ˜Product Flavors
    productFlavors {
        // å£°æ˜ç¬¬ä¸€ä¸ªFlavor
        create("ModelA") {
            // å®šä¹‰"ModelA"æ‰€å±çš„ç»´åº¦ä¸º"default"
            dimension = "default"
            // æŒ‡å®šåŒ…å
            applicationId = "net.bi4vmr.study.modela"
            // æŒ‡å®šç‰ˆæœ¬å·
            versionCode = 1
            // æŒ‡å®šç‰ˆæœ¬åç§°
            versionName = "1.0"
        }

        // å£°æ˜ç¬¬äºŒä¸ªFlavor
        create("ModelB") {
            dimension = "default"
            applicationId = "net.bi4vmr.study.modelb"
            versionCode = 2
            versionName = "2.0"
        }
    }
}
```

Flavorçš„åç§°ä¸èƒ½ä¸å…¶ä»–æ ‡è¯†ç¬¦å†²çªï¼ŒåŒ…æ‹¬BuildTypesã€SourceSetsç­‰ã€‚

å½“æˆ‘ä»¬é€‰æ‹©æŸä¸ªFlavorè¿›è¡Œç¼–è¯‘æ—¶ï¼Œå…¶ä¸­çš„å±æ€§å°±ä¼šè¦†ç›– `defaultConfig {}` å°èŠ‚ä¸­çš„åŒåå±æ€§ã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨Android Studioä¸­æ‰§è¡Œä¸€æ¬¡Gradle Syncï¼Œå³å¯åœ¨Build Varianté¢æ¿ä¸­æŸ¥çœ‹å¹¶é€‰æ‹©Flavorï¼Œç›¸å…³ç•Œé¢çš„æ ·å¼å¦‚ä¸‹æ–‡å›¾ç‰‡æ‰€ç¤ºï¼š

<div align="center">

![ProductFlavorsçš„åŸºæœ¬åº”ç”¨](./Assets_è¿›é˜¶ç”¨æ³•/ProductFlavors_ProductFlavorsçš„åŸºæœ¬åº”ç”¨.jpg)

</div>

åœ¨å‰æ–‡ç« èŠ‚ [ğŸ§­ BuildTypes](./01_åŸºç¡€ç”¨æ³•.md#build-types) çš„â€œç¤ºä¾‹ä¸€â€ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†ä¸‰ä¸ªæ„å»ºç±»å‹ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯"release"ã€"debug"å’Œ"dev"ï¼Œä¸ä¸Šè¿°Flavoræ’åˆ—ç»„åˆä¹‹åå°†ä¼šç”Ÿæˆ6ä¸ªBuild Variantï¼š

- "ModelA" + "debug" = ModelADebug
- "ModelA" + "dev" = ModelADev
- "ModelA" + "release" = ModelARelease
- "ModelB" + "debug" = ModelBDebug
- "ModelB" + "dev" = ModelBDev
- "ModelB" + "release" = ModelBRelease

å½“å­˜åœ¨è‡ªå®šä¹‰Flavoræ—¶ï¼Œç¼–è¯‘è¾“å‡ºç›®å½•ç»“æ„å°†å˜æ›´ä¸º `build/outputs/apk/<Flavoråç§°>/<BuildTypeåç§°>` ï¼Œå¦‚ä¸‹æ–‡ä»£ç å—æ‰€ç¤ºï¼š

```text
[root@Fedora RootProject]# tree ./app/build/outputs/apk/
./app/build/outputs/apk/
â”œâ”€â”€ ModelA
â”‚Â Â  â”œâ”€â”€ debug
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ app-ModelA-debug.apk
â”‚Â Â  â”‚Â Â  â””â”€â”€ output-metadata.json
â”‚Â Â  â”œâ”€â”€ dev
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ app-ModelA-dev-unsigned.apk
â”‚Â Â  â”‚Â Â  â””â”€â”€ output-metadata.json
â”‚Â Â  â””â”€â”€ release
â”‚Â Â      â”œâ”€â”€ app-ModelA-release-unsigned.apk
â”‚Â Â      â””â”€â”€ output-metadata.json
â””â”€â”€ ModelB
    â””â”€â”€ æ­¤å¤„çœç•¥éƒ¨åˆ†è¾“å‡ºå†…å®¹...
```

æ­¤æ—¶æ„å»ºæ¨¡å—çš„Taskåç§°ä¹Ÿä¼šå˜æ›´ä¸º `assemble<Flavoråç§°><BuildTypeåç§°>` æ ¼å¼ï¼š

```text
# ç¼–è¯‘"app"æ¨¡å—ï¼ŒæŒ‡å®šFlavorä¸ºModelAã€æ„å»ºç±»å‹ä¸º"release"ã€‚
[root@Fedora RootProject]# ./gradlew app:assembleModelARelease

# ç¼–è¯‘"app"æ¨¡å—ï¼ŒæŒ‡å®šFlavorä¸ºModelBã€æ„å»ºç±»å‹ä¸º"debug"ã€‚
[root@Fedora RootProject]# ./gradlew app:assembleModelBDebug
```

å½“æˆ‘ä»¬æ²¡æœ‰é…ç½®Flavoræ—¶ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ªåç§°ä¸ºç©ºå­—ç¬¦ä¸²çš„é»˜è®¤Flavorï¼Œå› æ­¤Build Varianté¢æ¿ä¸­çš„é€‰é¡¹çœ‹èµ·æ¥ä¸Build Typesä¸€è‡´ã€‚

## é…ç½®ä¾èµ–ç»„ä»¶
æ¯ä¸ªFlavorå¯ä»¥æ‹¥æœ‰ä¸“å±çš„ä¾èµ–é…ç½®ï¼Œè¿™ç§é…ç½®é€šè¿‡ `<Flavoråç§°>Implementation '<ç»„ä»¶åç§°>'` æ–¹æ³•è¿›è¡Œå£°æ˜ã€‚å½“æŸä¸ªFlavorè¢«ç¼–è¯‘æ—¶ï¼Œè‹¥å­˜åœ¨åç§°ä¸ä¹‹åŒ¹é…çš„"implementation"æ–¹æ³•ï¼Œå°±ä¼šå–ä»£é»˜è®¤çš„ `implementation '<ç»„ä»¶åç§°>'` é…ç½®ã€‚

"build.gradle":

```groovy
dependencies {
    // é»˜è®¤ä¾èµ–
    implementation 'com.example:sdk:1.0'

    // ModelAä¸“å±ä¾èµ–
    ModelAImplementation 'com.example:sdk-typea:1.0'
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
dependencies {
    // é»˜è®¤ä¾èµ–
    implementation("com.example:sdk:1.0")

    // ModelAä¸“å±ä¾èµ–
    add("ModelAImplementation", "com.example:sdk-typea:1.0")
}
```

ä»¥ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ"app:assembleModelARelease"ä»»åŠ¡æ—¶ï¼Œå°†ä¼šä½¿ç”¨"sdk-typea"ä¾èµ–é¡¹ï¼›å½“æˆ‘ä»¬æ‰§è¡Œ"app:assembleModelBRelease"ä»»åŠ¡æ—¶ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤çš„"sdk"ä¾èµ–é¡¹ã€‚

## å¤šç»´åº¦Flavor
åœ¨å‰æ–‡â€œç¤ºä¾‹äºŒâ€ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨Flavorå®šä¹‰äº†"ModelA"å’Œ"ModelB"ä¸¤ä¸ªäº§å“å‹å·ã€‚è‹¥åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼Œè¿˜éœ€è¦åŒºåˆ†"x86"å’Œ"arm"ä¸¤ç§ç¡¬ä»¶æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å‰æ–‡ç¤ºä¾‹ä¸­çš„æ–¹å¼ï¼Œæ‰‹åŠ¨å®šä¹‰ä»¥ä¸‹4ä¸ªFlavorï¼š

- "ModelA" + "x86" = ModelAX86
- "ModelA" + "arm" = ModelAArm
- "ModelB" + "x86" = ModelBX86
- "ModelB" + "arm" = ModelBArm

è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯å­˜åœ¨é‡å¤é…ç½®ï¼Œå¹¶ä¸”åç»­æ–°å¢å…¶ä»–ç»´åº¦æ—¶ï¼Œéœ€è¦ä¿®æ”¹æ‰€æœ‰çš„Flavoré…ç½®ï¼Œä¸åˆ©äºç»´æŠ¤ã€‚

ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šä¸ªFlavorç»´åº¦ï¼Œä½¿å®ƒä»¬è‡ªåŠ¨ç»„åˆã€‚

ğŸŸ¡ ç¤ºä¾‹ä¸‰ï¼šå¤šç»´åº¦Flavorçš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰â€œäº§å“å‹å·â€ä¸â€œç¡¬ä»¶æ¶æ„â€ä¸¤ä¸ªç»´åº¦ï¼Œå®ç°è‡ªåŠ¨ç»„åˆã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨å½“å‰æ¨¡å— `build.gradle` æ–‡ä»¶çš„ `android {}` å°èŠ‚ä¸­æ·»åŠ é…ç½®è¯­å¥ï¼Œå£°æ˜è‡ªå®šä¹‰Flavorã€‚

"build.gradle":

```groovy
android {
    defaultConfig {
        // æŒ‡å®šFlavorçš„ç»„åˆé¡ºåº
        flavorDimensions = ["model", "arch"]
    }

    productFlavors {
        ModelA {
            // å®šä¹‰"ModelA"æ‰€å±çš„ç»´åº¦ä¸º"model"
            dimension "model"
        }

        ModelB {
            // å®šä¹‰"ModelB"æ‰€å±çš„ç»´åº¦ä¸º"model"
            dimension "model"
        }

        x86 {
            // å®šä¹‰"x86"æ‰€å±çš„ç»´åº¦ä¸º"arch"
            dimension "arch"
        }

        arm {
            // å®šä¹‰"arm"æ‰€å±çš„ç»´åº¦ä¸º"arch"
            dimension "arch"
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    defaultConfig {
        // æŒ‡å®šFlavorçš„ç»„åˆé¡ºåº
        flavorDimensions.add("model")
        flavorDimensions.add("arch")
    }

    // å£°æ˜Product Flavors
    productFlavors {
        create("ModelA") {
            // å®šä¹‰"ModelA"æ‰€å±çš„ç»´åº¦ä¸º"model"
            dimension = "model"
        }

        create("ModelB") {
            // å®šä¹‰"ModelB"æ‰€å±çš„ç»´åº¦ä¸º"model"
            dimension = "model"
        }

        create("x86") {
            // å®šä¹‰"x86"æ‰€å±çš„ç»´åº¦ä¸º"arch"
            dimension = "arch"
        }

        create("arm") {
            // å®šä¹‰"arm"æ‰€å±çš„ç»´åº¦ä¸º"arch"
            dimension = "arch"
        }
    }
}
```

åœ¨ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡"dimension"é…ç½®é¡¹å°†æ‰€æœ‰Flavoråˆ†ä¸ºä¸¤ä¸ªç»´åº¦ï¼Œå…¶ä¸­"model"è¡¨ç¤ºäº§å“å‹å·ç»´åº¦ï¼›"arch"è¡¨ç¤ºç¡¬ä»¶æ¶æ„ç»´åº¦ã€‚ç„¶åæˆ‘ä»¬åœ¨ `defaultConfig {}` å°èŠ‚ä¸­ï¼Œé€šè¿‡"flavorDimensions"å±æ€§æŒ‡å®šå„ç»´åº¦çš„ç»„åˆé¡ºåºã€‚

æ­¤æ—¶ä¸¤ç§Flavorå³å¯æŒ‰ç…§äº§å“å‹å·ã€ç¡¬ä»¶æ¶æ„çš„é¡ºåºè‡ªåŠ¨ç»„åˆï¼Œç”Ÿæˆå‰æ–‡æ‰€è¿°çš„å››ç§Flavorã€‚Flavorå†ä¸BuildTypeç»„åˆåï¼Œå°†ç”Ÿæˆå®Œæ•´çš„ç¼–è¯‘ä»»åŠ¡åç§°ã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨Android Studioä¸­æ‰§è¡Œä¸€æ¬¡Gradle Syncï¼Œå³å¯åœ¨Build Varianté¢æ¿ä¸­æŸ¥çœ‹Flavorçš„ç»„åˆæƒ…å†µï¼Œç›¸å…³ç•Œé¢çš„æ ·å¼å¦‚ä¸‹æ–‡å›¾ç‰‡æ‰€ç¤ºï¼š

<div align="center">

![å¤šç»´åº¦Flavorç»„åˆç¤ºä¾‹](./Assets_è¿›é˜¶ç”¨æ³•/ProductFlavors_å¤šç»´åº¦Flavorç»„åˆç¤ºä¾‹.jpg)

</div>

å¤šä¸ªFlavoråç§°æ‹¼æ¥æ—¶ï¼Œé¦–ä¸ªFlavorçš„å¤§å°å†™ä¿æŒåŸçŠ¶ï¼Œåç»­Flavorçš„é¦–å­—æ¯å°†è‡ªåŠ¨å˜ä¸ºå¤§å†™ã€‚


# Maven Publish
## ç®€ä»‹
Android Libraryçš„Mavenä»“åº“å‘å¸ƒé…ç½®ä¸Java Libraryç±»ä¼¼ï¼Œè¯¦è§ç›¸å…³ç« èŠ‚ï¼š [ğŸ§­ Gradle - Maven Publish](../../../../04_è½¯ä»¶æŠ€å·§/06_è½¯ä»¶å¼€å‘/02_ç¼–è¯‘æ„å»º/02_Gradle/05_æ’ä»¶åº”ç”¨.md#maven-publish) ï¼Œæœ¬æ–‡ä»…å¯¹äºŒè€…æœ‰å·®å¼‚çš„éƒ¨åˆ†ä½œå‡ºè¯´æ˜ã€‚

## åŸºæœ¬åº”ç”¨
ä¸‹æ–‡ç¤ºä¾‹å±•ç¤ºäº†Maven Publishæ’ä»¶åœ¨Android Libraryä¸­çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚

ğŸŸ¢ ç¤ºä¾‹å››ï¼šMaven Publishæ’ä»¶çš„ä½¿ç”¨æ–¹æ³•ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºä¸€ä¸ªAndroid Libraryæ¨¡å—é…ç½®Maven Publishæ’ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿå°†ç¼–è¯‘äº§ç”Ÿçš„AARåŒ…å‘å¸ƒè‡³Mavenä»“åº“ã€‚

"build.gradle":

```groovy
publishing {
    publications {
        maven(MavenPublication) {
            // åœ¨ç¼–è¯‘å®Œæˆåï¼Œå°†"release"ç±»å‹çš„äº§ç‰©ä½œä¸ºç¨‹åºåŒ…å‘å¸ƒã€‚
            afterEvaluate {
                from components.release
            }

            pom {
                // æŒ‡æ˜ç»„ä»¶çš„æ ¼å¼
                packaging = "aar"
            }
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
publishing {
    publications {
        create<MavenPublication>("maven") {
            // åœ¨ç¼–è¯‘å®Œæˆåï¼Œå°†"release"ç±»å‹çš„äº§ç‰©ä½œä¸ºç¨‹åºåŒ…å‘å¸ƒã€‚
            afterEvaluate {
                from(components.getByName("release"))
            }

            pom {
                // æŒ‡æ˜ç»„ä»¶çš„æ ¼å¼
                packaging = "aar"
            }
        }
    }
}
```

ä¸‹æ–‡åˆ—è¡¨å±•ç¤ºäº†å°†Java Libraryå‘å¸ƒè„šæœ¬æ”¹ä¸ºAndroid Libraryå‘å¸ƒè„šæœ¬çš„å…³é”®æ­¥éª¤ï¼š

- åœ¨Android Libraryä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨ `from components.release` è¯­å¥å‘å¸ƒç¨‹åºåŒ…ï¼Œéœ€è¦å°†å…¶æ”¾ç½®åœ¨ `afterEvaluate {}` å°èŠ‚ä¸­ï¼Œç­‰å¾…"release"ç¼–è¯‘ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶å°†äº§ç‰©AARä½œä¸ºç»„ä»¶å‘å¸ƒã€‚
- å‘å¸ƒäº§ç‰©çš„ç±»å‹ä»JARå˜æ›´ä¸ºAARåï¼Œæˆ‘ä»¬éœ€è¦åŒæ­¥æ›´æ”¹ `pom {}` å°èŠ‚ä¸­çš„ `packaging` å±æ€§ã€‚

## å‘å¸ƒæºç ä¸æ–‡æ¡£åŒ…
æˆ‘ä»¬å¯ä»¥åœ¨Android Libraryçš„Gradleé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®é¡¹ï¼Œä»¥å®ç°æºç ä¸æ–‡æ¡£åŒ…çš„å‘å¸ƒã€‚

"build.gradle":

```groovy
android {
    publishing {
        // ä¸ºåä¸º"release"çš„Build Variantæ·»åŠ é…ç½®
        singleVariant('release') {
            withSourcesJar()
            withJavadocJar()
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    publishing {
        // ä¸ºåä¸º"release"çš„Build Variantæ·»åŠ é…ç½®
        singleVariant("release") {
            withSourcesJar()
            withJavadocJar()
        }
    }
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºåä¸º"release"çš„Build Variantæ·»åŠ äº†æºç ä¸æ–‡æ¡£åŒ…å‘å¸ƒä»»åŠ¡ï¼Œå¦‚æœè¿˜éœ€è¦ä¸ºå…¶ä»–Build Varianté…ç½®å‘å¸ƒä»»åŠ¡ï¼Œå¯ä»¥æ·»åŠ æ–°çš„ `singleVariant() {}` å°èŠ‚ï¼›å¦‚æœè¦ä¸ºæ‰€æœ‰Build Varianté…ç½®å‘å¸ƒä»»åŠ¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®€åŒ–å†™æ³•ï¼š

"build.gradle":

```groovy
android {
    publishing {
        multipleVariants {
             // æŒ‡å®šä»¥ä¸‹é…ç½®å¯¹æ‰€æœ‰Build Variantç”Ÿæ•ˆ
             allVariants()
             withSourcesJar()
             withJavadocJar()
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    publishing {
        multipleVariants {
             // æŒ‡å®šä»¥ä¸‹é…ç½®å¯¹æ‰€æœ‰Build Variantç”Ÿæ•ˆ
             allVariants()
             withSourcesJar()
             withJavadocJar()
        }
    }
}
```

ä¸Java Libraryç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ä»»åŠ¡æ›´æ”¹é»˜è®¤çš„å‘å¸ƒäº§ç‰©ï¼š

"build.gradle":

```groovy
// æ‰“åŒ…æºç çš„ä»»åŠ¡
def sourcesJar = tasks.register('sourcesJar', Jar) {
    // å°†"src/main"ç›®å½•ä¸‹çš„æºç æ–‡ä»¶æ‰“åŒ…
    from android.sourceSets.main.allJava
    // ä¸ºæºç åŒ…æ·»åŠ åç¼€ä¸ç¨‹åºåŒ…ä½œåŒºåˆ†
    archiveClassifier = 'sources'
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
// å‘å¸ƒæºç åŒ…çš„ä»»åŠ¡
val sourcesJar by tasks.creating(Jar::class) {
    // å°†"src/main"ç›®å½•ä¸‹çš„æºç æ–‡ä»¶æ‰“åŒ…
    from(android.sourceSets.getByName("main").allJava.srcDirs)
    // ä¸ºæºç åŒ…æ·»åŠ åç¼€ä¸ç¨‹åºåŒ…ä½œåŒºåˆ†
    archiveClassifier.set("sources")
}
```

åœ¨Android Libraryä¸­ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ `android.sourceSets` æ‰“åŒ…æºç ï¼Œå¦‚æœè°ƒç”¨Java Libraryçš„ `sourceSets` åˆ™ä¼šå¯¼è‡´é”™è¯¯ï¼š `SourceSet with name 'main' not found.` ã€‚
