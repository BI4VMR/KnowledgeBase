# ç›®å½•ç»“æ„
ç›®å‰Androidå®˜æ–¹æŒ‡å®šçš„åº”ç”¨ç¨‹åºæ„å»ºå·¥å…·æ˜¯Gradleï¼Œå½“æˆ‘ä»¬ä½¿ç”¨Android Studioåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹åï¼Œå°†ä¼šç”Ÿæˆåä¸º"app"çš„å­æ¨¡å—ï¼Œä»¥åŠä¸€äº›Gradleé…ç½®æ–‡ä»¶ï¼Œå®ƒä»¬çš„ç›®å½•ç»“æ„å¦‚ä¸‹æ–‡ä»£ç å—æ‰€ç¤ºï¼š

```text
NewProject
â”œâ”€â”€ app
â”‚   â””â”€â”€ build.gradle
â”œâ”€â”€ build.gradle
â””â”€â”€ settings.gradle
```

å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„ `settings.gradle` é…ç½®æ–‡ä»¶åŒ…å«å…¨å±€å±æ€§ã€å­æ¨¡å—å£°æ˜ã€ä»“åº“å£°æ˜ç­‰ä¿¡æ¯ã€‚

"settings.gradle":

```groovy
// æ„å»ºå·¥å…·çš„ä¾èµ–é…ç½®
pluginManagement {
    // å£°æ˜Gradleæ’ä»¶ä»“åº“
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

// æ‰€æœ‰æ¨¡å—çš„ä¾èµ–é…ç½®
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    // å£°æ˜Mavenç»„ä»¶ä»“åº“
    repositories {
        google()
        mavenCentral()
    }
}

/* å·¥ç¨‹ç»“æ„å£°æ˜ */
// ä¸»å·¥ç¨‹åç§°
rootProject.name = "RootProject"

// å­æ¨¡å—"app"
include ':app'
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"settings.gradle.kts":

```kotlin
// æ„å»ºå·¥å…·çš„ä¾èµ–é…ç½®
pluginManagement {
    // å£°æ˜Gradleæ’ä»¶ä»“åº“
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

// æ‰€æœ‰æ¨¡å—çš„ä¾èµ–é…ç½®
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    // å£°æ˜Mavenç»„ä»¶ä»“åº“
    repositories {
        google()
        mavenCentral()
    }
}

/* å·¥ç¨‹ç»“æ„å£°æ˜ */
// ä¸»å·¥ç¨‹åç§°
rootProject.name = "RootProject"

// å­æ¨¡å—"app"
include(":app")
```

ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­çš„ `pluginManagement {}` ä¸ `dependencyResolutionManagement {}` å°èŠ‚ç”¨äºé…ç½®Gradleæ’ä»¶ä¸ä¾èµ–ç»„ä»¶ä»“åº“ä¿¡æ¯ï¼Œè¯¦è§ç›¸å…³ç« èŠ‚ï¼š [ğŸ§­ Gradle - ä»“åº“ç®¡ç†](../../../../04_è½¯ä»¶æŠ€å·§/06_è½¯ä»¶å¼€å‘/02_ç¼–è¯‘æ„å»º/02_Gradle/03_ä¾èµ–ç®¡ç†.md#ä»“åº“é…ç½®) ã€‚

è¯¥é…ç½®æ–‡ä»¶ä¸­çš„å‰©ä½™éƒ¨åˆ†ç”¨äºé…ç½®é¡¹ç›®ç»“æ„ï¼Œå£°æ˜å„ä¸ªå­æ¨¡å—ï¼Œè¯¦è§ç›¸å…³ç« èŠ‚ï¼š [ğŸ§­ Gradle - æ¨¡å—ç®¡ç†](../../../../04_è½¯ä»¶æŠ€å·§/06_è½¯ä»¶å¼€å‘/02_ç¼–è¯‘æ„å»º/02_Gradle/02_åŸºç¡€åº”ç”¨.md#æ¨¡å—ç®¡ç†) ã€‚

å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„ `build.gradle` é…ç½®æ–‡ä»¶åŒ…å«Gradleæ’ä»¶å£°æ˜ã€‚

"build.gradle":

```groovy
plugins {
    // å£°æ˜Gradleæ’ä»¶ï¼šAndroidåº”ç”¨ç¨‹åº
    id 'com.android.application' version '7.4.2' apply false
    // å£°æ˜Gradleæ’ä»¶ï¼šAndroidåº“
    id 'com.android.library' version '7.4.2' apply false
    // å£°æ˜Gradleæ’ä»¶ï¼šAndroidçš„Kotlinè¯­è¨€æ”¯æŒ
    id 'org.jetbrains.kotlin.android' version '1.8.0' apply false
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
plugins {
    id("com.android.application").version("7.4.2").apply(false)
    id("com.android.library").version("7.4.2").apply(false)
    id("org.jetbrains.kotlin.android").version("1.8.0").apply(false)
}
```

Androidç›¸å…³çš„æ’ä»¶éƒ½ä¸æ˜¯Gradleå®˜æ–¹æ’ä»¶ï¼Œå› æ­¤æˆ‘ä»¬åœ¨å£°æ˜å®ƒä»¬æ—¶å¿…é¡»æŒ‡æ˜ç‰ˆæœ¬ã€‚ç”±äºæ ¹å·¥ç¨‹æ— éœ€æ”¾ç½®Androidæºä»£ç ï¼Œæ­¤å¤„æ·»åŠ äº† `apply false` å±æ€§ï¼Œä½¿æ’ä»¶ä¸å¯¹æ ¹å·¥ç¨‹ç”Ÿæ•ˆã€‚

Android Gradleæ’ä»¶(Android Gradle Plugin, AGP)ä½¿Gradleå…·æœ‰ç”ŸæˆAndroidäº§ç‰©çš„èƒ½åŠ›ï¼Œå…¶åŠŸèƒ½åŒ…æ‹¬ç¼–è¯‘Javaæºç ã€æ‰“åŒ…èµ„æºæ–‡ä»¶ã€é…ç½®ç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚

AGPçš„ç‰ˆæœ¬éœ€è¦ä¸Gradleç‰ˆæœ¬ç›¸åŒ¹é…ï¼Œç›¸å…³ä¿¡æ¯å¯åœ¨Android Developerç½‘ç«™çš„ [ğŸ”— AGPç‰ˆæœ¬è¯´æ˜](https://developer.android.google.cn/studio/releases/gradle-plugin#updating-gradle) é¡µé¢ä¸­æŸ¥è¯¢ã€‚

ä¸‹æ–‡å†…å®¹å°†å¯¹ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„ä¸‰ä¸ªGradleæ’ä»¶è¿›è¡Œä»‹ç»ï¼š

ğŸ”· `com.android.application`

è¯¥AGPçš„ä½œç”¨æ˜¯ç”ŸæˆAndroidåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥æ’ä»¶çš„æ¨¡å—ç®€ç§°ä¸ºâ€œAPPæ¨¡å—â€ï¼Œå®ƒä»¬çš„æ„å»ºäº§ç‰©ä¸ºAPKæ–‡ä»¶ï¼Œå¯ä»¥è¢«å®‰è£…åˆ°è®¾å¤‡ä¸­å¹¶è¿è¡Œã€‚

ğŸ”· `com.android.library`

è¯¥AGPçš„ä½œç”¨æ˜¯ç”ŸæˆAndroidåº“ç»„ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥æ’ä»¶çš„æ¨¡å—ç®€ç§°ä¸ºâ€œLIBæ¨¡å—â€ï¼Œå®ƒä»¬çš„æ„å»ºäº§ç‰©ä¸ºAARæ–‡ä»¶ï¼Œåªèƒ½ä½œä¸ºAPPæ¨¡å—æˆ–å…¶ä»–LIBæ¨¡å—çš„ä¾èµ–é¡¹ï¼Œæä¾›å¯å¤ç”¨çš„èƒ½åŠ›ï¼Œæ— æ³•ç›´æ¥è¢«å®‰è£…åˆ°è®¾å¤‡ä¸­ã€‚

ğŸ”· `org.jetbrains.kotlin.android`

è¯¥æ’ä»¶ä¸å±äºAGPï¼Œå®ƒæ˜¯ç”±Jetbrainsæä¾›çš„ï¼Œèƒ½å¤Ÿä½¿APPæˆ–LIBæ¨¡å—æ”¯æŒKotlinè¯­è¨€ã€‚

å¯¹äºåªä½¿ç”¨Javaè¯­è¨€çš„æ¨¡å—ï¼Œæˆ‘ä»¬ä¸å¿…ä¸ºå®ƒä»¬é…ç½®è¯¥æ’ä»¶ã€‚

<br />

"app"æ¨¡å—çš„ `build.gradle` é…ç½®æ–‡ä»¶åŒ…å«æ„å»ºåº”ç”¨ç¨‹åºçš„å…·ä½“é…ç½®ã€‚

"build.gradle":

```groovy
/* å½“å‰æ¨¡å—å¯ç”¨çš„Gradleæ’ä»¶ */
plugins {
    id 'com.android.application'
    id 'org.jetbrains.kotlin.android'
}

/* Androidç›¸å…³é…ç½® */
android {
    namespace 'net.bi4vmr.helloworld'
    compileSdk 33

    // é»˜è®¤é…ç½®
    defaultConfig {
        applicationId "net.bi4vmr.helloworld"
        minSdk 26
        targetSdk 33
        versionCode 1
        versionName "1.0"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    // æ„å»ºç±»å‹é…ç½®
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }

    // Javaç¼–è¯‘é…ç½®
    compileOptions {
        // æŒ‡å®šæºç ç‰ˆæœ¬
        sourceCompatibility JavaVersion.VERSION_1_8
        // æŒ‡å®šç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ç‰ˆæœ¬
        targetCompatibility JavaVersion.VERSION_1_8
    }

    // Kotlinç¼–è¯‘é…ç½®
    kotlinOptions {
        // æŒ‡å®šç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ç‰ˆæœ¬
        jvmTarget = '1.8'
    }
}

/* ä¾èµ–ç»„ä»¶å£°æ˜ */
dependencies {
    implementation 'androidx.core:core-ktx:1.7.0'
    implementation 'androidx.appcompat:appcompat:1.4.1'
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
/* å½“å‰æ¨¡å—å¯ç”¨çš„Gradleæ’ä»¶ */
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
}

/* Androidç›¸å…³é…ç½® */
android {
    namespace = "net.bi4vmr.helloworld"
    compileSdk = 33

    // é»˜è®¤é…ç½®
    defaultConfig {
        applicationId = "net.bi4vmr.helloworld"
        minSdk = 26
        targetSdk = 33
        versionCode = 1
        versionName = "1.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    // æ„å»ºç±»å‹é…ç½®
    buildTypes {
        getByName("release") {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    // Javaç¼–è¯‘é…ç½®
    compileOptions {
        // æŒ‡å®šæºç ç‰ˆæœ¬
        sourceCompatibility = JavaVersion.VERSION_1_8
        // æŒ‡å®šç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ç‰ˆæœ¬
        targetCompatibility = JavaVersion.VERSION_1_8
    }

    // Kotlinç¼–è¯‘é…ç½®
    kotlinOptions {
        // æŒ‡å®šç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ç‰ˆæœ¬
        jvmTarget = "1.8"
    }
}

/* ä¾èµ–ç»„ä»¶å£°æ˜ */
dependencies {
    implementation("androidx.core:core-ktx:1.7.0")
    implementation("androidx.appcompat:appcompat:1.4.1")
}
```

è¯¥é…ç½®æ–‡ä»¶ä¸­çš„ `plugins {}` å°èŠ‚ç”¨äºå£°æ˜å½“å‰æ¨¡å—å¯ç”¨çš„Gradleæ’ä»¶ï¼Œæ­¤å¤„å£°æ˜äº† `com.android.application` æ’ä»¶ï¼Œå› æ­¤ç¼–è¯‘äº§ç‰©ä¸ºAPKæ–‡ä»¶ã€‚æ­¤å¤„è¿˜å£°æ˜äº† `org.jetbrains.kotlin.android` æ’ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡å—ä¸­ç¼–å†™Kotlinä»£ç ã€‚

è¯¥é…ç½®æ–‡ä»¶ä¸­çš„ `android {}` å°èŠ‚ç”¨äºå£°æ˜ä¸Androidæœ‰å…³çš„é…ç½®ï¼ŒåŒ…æ‹¬åŒ…åã€SDKç‰ˆæœ¬ã€æµ‹è¯•å·¥å…·ã€æ··æ·†é…ç½®ç­‰ï¼Œè¯¦è§åæ–‡ç« èŠ‚ã€‚

è¯¥é…ç½®æ–‡ä»¶ä¸­çš„ `dependencies {}` å°èŠ‚ç”¨äºå£°æ˜å½“å‰æ¨¡å—æ‰€ä¾èµ–çš„å¤–éƒ¨ç»„ä»¶ï¼Œè¯¦è§ç›¸å…³ç« èŠ‚ï¼š [ğŸ§­ Gradle - ä¾èµ–ç®¡ç†](../../../../04_è½¯ä»¶æŠ€å·§/07_ç¼–ç¨‹å·¥å…·/02_ç¼–è¯‘æ„å»º/02_Gradle/03_ä¾èµ–ç®¡ç†.md) ã€‚


# Build Types
## ç®€ä»‹
Build Typesï¼ˆæ„å»ºç±»å‹ï¼‰ç”¨äºåŒºåˆ†æ„å»ºäº§ç‰©çš„ç”¨é€”ï¼Œæ¯ä¸ªç±»å‹å¯ä»¥æ‹¥æœ‰ä¸åŒçš„ç­¾åä¸è°ƒè¯•å‚æ•°ç­‰é…ç½®ï¼Œä»¥æ»¡è¶³ä¸åŒå¼€å‘é˜¶æ®µçš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šå¼€å‘ç‰ˆæœ¬ã€æµ‹è¯•ç‰ˆæœ¬ã€ç”¨æˆ·ç‰ˆæœ¬ã€‚

æ¯ä¸ªæ¨¡å—åˆå§‹æ—¶æ‹¥æœ‰"debug"å’Œ"release"ä¸¤ä¸ªç±»å‹ï¼Œå…¶ä¸­"debug"ç±»å‹é¢å‘å¼€å‘è€…ï¼Œé»˜è®¤å…è®¸è¿›è¡Œè°ƒè¯•ã€ç¦ç”¨ä»£ç æ··æ·†ï¼›"release"ç±»å‹é¢å‘æœ€ç»ˆç”¨æˆ·ï¼Œé»˜è®¤ä¸å¯è¿›è¡Œè°ƒè¯•ã€å¯ç”¨ä»£ç æ··æ·†ã€‚

## åŸºæœ¬åº”ç”¨
æ„å»ºç±»å‹éœ€è¦åœ¨å½“å‰æ¨¡å— `build.gradle` é…ç½®æ–‡ä»¶çš„ `android{}` å°èŠ‚ä¸­å£°æ˜ï¼Œé™¤äº†ä¸¤ä¸ªåˆå§‹ç±»å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å£°æ˜æ›´å¤šçš„ç±»å‹ï¼Œå¹¶é…ç½®æ¯ä¸ªç±»å‹çš„å±æ€§ã€‚

ğŸ”´ ç¤ºä¾‹ä¸€ï¼šBuildTypesçš„åŸºæœ¬åº”ç”¨ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸¤ä¸ªé»˜è®¤ç±»å‹çš„é…ç½®ï¼Œå¹¶æ–°å¢ä¸€ä¸ªç±»å‹"dev"ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨å½“å‰æ¨¡å— `build.gradle` æ–‡ä»¶çš„ `android {}` å°èŠ‚ä¸­æ·»åŠ é…ç½®è¯­å¥ï¼Œå£°æ˜è‡ªå®šä¹‰æ„å»ºç±»å‹ã€‚

"build.gradle":

```groovy
android {
    buildTypes {
        // é»˜è®¤ç±»å‹"release"
        release {
            // é…ç½®å±æ€§ï¼šç¦æ­¢Debug
            debuggable = false
        }

        // é»˜è®¤ç±»å‹"debug"
        debug {
            // é…ç½®å±æ€§ï¼šå…è®¸Debug
            debuggable = true
        }

        // è‡ªå®šä¹‰ç±»å‹"dev"
        dev {
            // é…ç½®å±æ€§ï¼šå…è®¸Debug
            debuggable = true
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    buildTypes {
        // é»˜è®¤ç±»å‹"release"
        release {
            // é…ç½®å±æ€§ï¼šç¦æ­¢Debug
            isDebuggable = false
        }

        // é»˜è®¤ç±»å‹"debug"
        debug {
            // é…ç½®å±æ€§ï¼šå…è®¸Debug
            isDebuggable = true
        }

        // è‡ªå®šä¹‰ç±»å‹"dev"
        create("dev") {
            // é…ç½®å±æ€§ï¼šå…è®¸Debug
            isDebuggable = true
        }
    }
}
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨Android Studioä¸­æ‰§è¡Œä¸€æ¬¡Gradle Syncï¼Œå³å¯åœ¨Build Varianté¢æ¿ä¸­æŸ¥çœ‹å¹¶é€‰æ‹©æ–°å¢çš„è‡ªå®šä¹‰ç±»å‹ï¼Œç›¸å…³ç•Œé¢çš„æ ·å¼å¦‚ä¸‹æ–‡å›¾ç‰‡æ‰€ç¤ºï¼š

<div align="center">

![BuildTypesçš„åŸºæœ¬åº”ç”¨](./Assets_åŸºç¡€ç”¨æ³•/BuildTypes_BuildTypesçš„åŸºæœ¬åº”ç”¨.jpg)

</div>

Build Varianté¢æ¿ä¸­å±•ç¤ºäº†æ¯ä¸ªæ¨¡å—æ­£åœ¨ä½¿ç”¨çš„æ„å»ºç±»å‹ï¼Œå½“æˆ‘ä»¬é€šè¿‡"Build"èœå•ç¼–è¯‘"app"æ¨¡å—åï¼Œå¯ä»¥åœ¨ `app/build/outputs/apk/debug/` ç›®å½•ä¸­æ‰¾åˆ°å¯¹åº”çš„æ„å»ºäº§ç‰©ã€‚

æ¯å½“æ¨¡å—ç¼–è¯‘æˆåŠŸæ—¶ï¼ŒGradleä¼šåœ¨æ¨¡å—çš„ `build/outputs/apk/` ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªä¸æ„å»ºç±»å‹åŒåçš„ç›®å½•ï¼Œå…¶ä¸­åŒ…æ‹¬æ„å»ºäº§ç‰©ï¼ˆAPKæˆ–AARæ–‡ä»¶ï¼‰å’Œæ„å»ºä¿¡æ¯ï¼ˆJSONæ ¼å¼çš„æ–‡ä»¶ï¼‰ã€‚

```text
[root@Fedora RootProject]# tree ./app/build/outputs/apk/
./app/build/outputs/apk/
â”œâ”€â”€ debug
â”‚Â Â  â”œâ”€â”€ app-debug.apk
â”‚Â Â  â””â”€â”€ output-metadata.json
â”œâ”€â”€ dev
â”‚Â Â  â”œâ”€â”€ app-dev.apk
â”‚Â Â  â””â”€â”€ output-metadata.json
â””â”€â”€ release
    â”œâ”€â”€ app-release.apk
    â””â”€â”€ output-metadata.json
```

é™¤äº†é€šè¿‡å›¾å½¢åŒ–å·¥å…·æ‰§è¡Œç¼–è¯‘ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œæ“ä½œï¼›ä¸Šè¿°ä¸‰ä¸ªæ„å»ºç±»å‹å¯¹åº”çš„Gradleç¼–è¯‘å‘½ä»¤å¦‚ä¸‹æ–‡ä»£ç å—æ‰€ç¤ºï¼š

```text
# ç¼–è¯‘"app"æ¨¡å—ï¼ŒæŒ‡å®šæ„å»ºç±»å‹ä¸º"release"ã€‚
[root@Fedora RootProject]# ./gradlew app:assembleRelease

# ç¼–è¯‘"app"æ¨¡å—ï¼ŒæŒ‡å®šæ„å»ºç±»å‹ä¸º"debug"ã€‚
[root@Fedora RootProject]# ./gradlew app:assembleDebug

# ç¼–è¯‘"app"æ¨¡å—ï¼ŒæŒ‡å®šæ„å»ºç±»å‹ä¸º"dev"ã€‚
[root@Fedora RootProject]# ./gradlew app:assembleDev


# ç¼–è¯‘å½“å‰å·¥ç¨‹çš„æ‰€æœ‰æ¨¡å—ä¸æ‰€æœ‰æ„å»ºç±»å‹
[root@Fedora RootProject]# ./gradlew assemble
```

æ„å»ºç±»å‹å¯¹åº”çš„Taskåç§°é‡‡ç”¨é©¼å³°å‘½åæ³•ï¼Œ"assemble"ä¸ºå›ºå®šå‰ç¼€ï¼Œéšåä¸ºæ„å»ºç±»å‹çš„åç§°ã€‚


# SigningConfigs
## ç®€ä»‹
SigningConfigsï¼ˆç­¾åé…ç½®ï¼‰ç”¨äºä¸ºAPKç­¾åï¼Œæ ‡è¯†å‘å¸ƒè€…çš„èº«ä»½ã€‚æˆ‘ä»¬å¯ä»¥åœ¨APPæ¨¡å—ä¸­åˆ›å»ºå¤šä¸ªç­¾åé…ç½®ï¼Œå½“Gradleç¼–è¯‘äº§ç”ŸAPKåï¼Œå°†ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„ç­¾åæ–‡ä»¶ä¸ºAPKç­¾åï¼Œç®€åŒ–APPçš„å‘å¸ƒæµç¨‹ã€‚

## åŸºæœ¬åº”ç”¨
æ¯ä¸ªAPPæ¨¡å—éƒ½æœ‰ä¸€ä¸ªåä¸º"debug"çš„é»˜è®¤ç­¾åé…ç½®ï¼Œå®ƒä½¿ç”¨çš„ç­¾åæ–‡ä»¶ä¸º `<ç”¨æˆ·ä¸»ç›®å½•>/.android/debug.keystore` ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡å— `build.gradle` æ–‡ä»¶çš„ `signingConfigs {}` å°èŠ‚ä¸­è¦†ç›–é»˜è®¤é…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨æ­¤å¤„åˆ›å»ºä¸€äº›æ–°çš„ç­¾åé…ç½®ã€‚

ğŸŸ  ç¤ºä¾‹äºŒï¼šSigningConfigsçš„åŸºæœ¬åº”ç”¨ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¿®æ”¹é»˜è®¤çš„ç­¾åé…ç½®ï¼Œä¸ºå…¶æŒ‡å®šæ–°çš„ç­¾åæ–‡ä»¶ï¼Œå¹¶æ–°å¢ä¸€ä¸ªé…ç½®"AOSP"ã€‚

"build.gradle":

```groovy
android {
    signingConfigs {
        // ä¿®æ”¹åä¸º"debug"çš„é»˜è®¤é…ç½®
        debug {
            // æŒ‡æ˜ç­¾åæ–‡ä»¶çš„è·¯å¾„
            storeFile file(rootDir.absolutePath + File.separator + "debug.keystore")
            // å­˜å‚¨åº“å£ä»¤
            storePassword 'android'
            // æŒ‡å®šå¯†é’¥åç§°
            keyAlias 'androiddebugkey'
            // æŒ‡å®šå¯†é’¥å£ä»¤
            keyPassword 'android'
        }

        // åˆ›å»ºåä¸º"AOSP"çš„ç­¾åé…ç½®
        AOSP {
            storeFile file(rootDir.absolutePath + File.separator + "AOSPSystem.keystore")
            storePassword 'AOSPSystem'
            keyAlias 'AOSPSystem'
            keyPassword 'AOSPSystem'
        }
    }

    buildTypes {
        debug {
            // åº”ç”¨åä¸º"debug"çš„ç­¾åé…ç½®
            signingConfig signingConfigs.debug
        }

        release {
            // åº”ç”¨åä¸º"AOSP"çš„ç­¾åé…ç½®
            signingConfig signingConfigs.AOSP
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    signingConfigs {
        // ä¿®æ”¹åä¸º"debug"çš„é»˜è®¤é…ç½®
        getByName("debug") {
            // æŒ‡æ˜ç­¾åæ–‡ä»¶çš„è·¯å¾„
            storeFile = file("${rootDir.absolutePath}${File.separator}debug.keystore")
            // å­˜å‚¨åº“å£ä»¤
            storePassword = "android"
            // æŒ‡å®šå¯†é’¥åç§°
            keyAlias = "androiddebugkey"
            // æŒ‡å®šå¯†é’¥å£ä»¤
            keyPassword = "android"
        }

        // åˆ›å»ºåä¸º"AOSP"çš„ç­¾åé…ç½®
        create("AOSP") {
            storeFile = file("${rootDir.absolutePath}${File.separator}AOSPSystem.keystore")
            storePassword = "AOSPSystem"
            keyAlias = "AOSPSystem"
            keyPassword = "AOSPSystem"
        }
    }

    buildTypes {
        debug {
            // åº”ç”¨åä¸º"debug"çš„ç­¾åé…ç½®
            signingConfig = signingConfigs.getByName("debug")
        }

        release {
            // åº”ç”¨åä¸º"AOSP"çš„ç­¾åé…ç½®
            signingConfig = signingConfigs.getByName("AOSP")
        }
    }
}
```

ç­¾åé…ç½®éœ€è¦å…ˆå£°æ˜åä½¿ç”¨ï¼Œå› æ­¤ `signingConfigs {}` å°èŠ‚å¿…é¡»æ”¾ç½®åœ¨è°ƒç”¨è¯­å¥ä¹‹å‰ã€‚

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†é»˜è®¤ç­¾åé…ç½®"debug"çš„ç­¾åæ–‡ä»¶ï¼Œå¹¶å£°æ˜äº†åä¸º"AOSP"çš„æ–°é…ç½®ï¼Œæœ€åå°†å®ƒä»¬åˆ†åˆ«åº”ç”¨åˆ°"debug"å’Œ"release"ä¸¤ä¸ªBuildTypeä¸­ã€‚å¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä¸ºå¤šä¸ªBuildTypeè®¾ç½®ä¸åŒçš„ç­¾åï¼Œä¹Ÿå¯ä»¥å°†åº”ç”¨ç­¾åçš„è¯­å¥è®¾ç½®åœ¨ `defaultConfig {}` å°èŠ‚ä¸­ã€‚

> âš ï¸ è­¦å‘Š
>
> åä¸º"debug"çš„æ„å»ºç±»å‹é»˜è®¤ä½¿ç”¨çš„ç­¾åé…ç½®ä¹Ÿæ˜¯"debug"ï¼Œä¸å— `defaultConfig {}` å°èŠ‚ä¸­ `signingConfig` é…ç½®é¡¹çš„å½±å“ï¼›å¦‚æœæˆ‘ä»¬è¦æ›´æ”¹è¿™ç§é»˜è®¤è¡Œä¸ºï¼Œå¿…é¡»åƒä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸€æ ·åœ¨ `buildTypes {}` å°èŠ‚ä¸­æ˜¾å¼å£°æ˜æ„å»ºç±»å‹"debug"æ‰€ä½¿ç”¨çš„ç­¾åé…ç½®ã€‚


# Kotlinç›¸å…³é…ç½®
## æ·»åŠ Kotlinæ”¯æŒ
å¦‚æœä¸€ä¸ªå·¥ç¨‹åŸæœ¬å¹¶æœªé…ç½®ä»»ä½•Kotlinç›¸å…³ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Gradleé…ç½®æ–‡ä»¶ä¸­æ–°å¢ä»¥ä¸‹å†…å®¹ï¼Œä½¿å…¶æ”¯æŒKotlinè¯­è¨€ã€‚

ğŸŸ¡ ç¤ºä¾‹ä¸‰ï¼šä¸ºæ¨¡å—æ·»åŠ Kotlinæ”¯æŒã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºä¸æ”¯æŒKotlinçš„å·¥ç¨‹æ·»åŠ é…ç½®ï¼Œä½¿å…¶æ”¯æŒKotlinè¯­è¨€ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„ `build.gradle` æ–‡ä»¶ä¸­å£°æ˜Androidçš„Kotlinæ”¯æŒæ’ä»¶åŠå…¶ç‰ˆæœ¬å·ã€‚

"build.gradle":

```groovy
plugins {
    id 'com.android.application' version '7.4.2' apply false
    id 'com.android.library' version '7.4.2' apply false
    // å£°æ˜Androidçš„Kotlinæ”¯æŒæ’ä»¶ç‰ˆæœ¬
    id 'org.jetbrains.kotlin.android' version '1.9.21' apply false
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
plugins {
    id("com.android.application").version("7.4.2").apply(false)
    id("com.android.library").version("7.4.2").apply(false)
    // å£°æ˜Androidçš„Kotlinæ”¯æŒæ’ä»¶ç‰ˆæœ¬
    id("org.jetbrains.kotlin.android").version("1.9.21").apply(false)
}
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨éœ€è¦æ”¯æŒKotlinè¯­è¨€çš„æ¨¡å—çš„ `build.gradle` æ–‡ä»¶ä¸­å£°æ˜è¯¥æ’ä»¶ã€‚

"build.gradle":

```groovy
plugins {
    id 'com.android.application'
    // æ·»åŠ Androidçš„Kotlinæ”¯æŒæ’ä»¶
    id 'org.jetbrains.kotlin.android'
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
plugins {
    id("com.android.application")
    // æ·»åŠ Androidçš„Kotlinæ”¯æŒæ’ä»¶
    id("org.jetbrains.kotlin.android")
}
```

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿä¸€Javaä¸Kotlinæºä»£ç çš„ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬ã€‚

ç”±äºGradleé»˜è®¤çš„Javaä¸Kotlinæºä»£ç ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¨¡å— `build.gradle` æ–‡ä»¶çš„ `android {}` å°èŠ‚ä¸­å°†äºŒè€…ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬è®¾ä¸ºåŒä¸€ç‰ˆæœ¬ã€‚

"build.gradle":

```groovy
android {
    compileOptions {
        // æŒ‡å®šJavaæºç ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }

    kotlinOptions {
        // æŒ‡å®šKotlinæºç ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬
        jvmTarget = 11
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    compileOptions {
        // æŒ‡å®šJavaæºç ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }

    kotlinOptions {
        // æŒ‡å®šKotlinæºç ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬
        jvmTarget = "11"
    }
}
```

## è®¾ç½®æºä»£ç ç›®å½•åç§°
é»˜è®¤æƒ…å†µä¸‹Kotlinæºä»£ç ä¸Javaæºä»£ç æ··åˆæ”¾ç½®åœ¨ `<æ¨¡å—æ ¹ç›®å½•>/src/main/java/` ç›®å½•ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä¸åŒçš„ç›®å½•åˆ†åˆ«ç®¡ç†ä¸¤ç§æºä»£ç ï¼Œå¯ä»¥åœ¨æ¨¡å—çš„ `build.gradle` æ–‡ä»¶ä¸­æ–°å¢é…ç½®é¡¹ï¼Œä¸ºèµ„æºé›†åˆ"main"æ–°å¢ä¸€ä¸ª `kotlin` ç›®å½•ã€‚

"build.gradle":

```groovy
android {
    sourceSets {
        main {
            java {
                // æ–°å¢Kotlinæºä»£ç ç›®å½•
                java.srcDirs += "src/main/kotlin"
            }
        }
    }
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    sourceSets {
        getByName("main") {
            java {
                // æ–°å¢Kotlinæºä»£ç ç›®å½•
                java.srcDir("src/main/kotlin")
            }
        }
    }
}
```


# ç‰ˆæœ¬å˜æ›´
## ç´¢å¼•

<div align="center">

|       åºå·        |    ç‰ˆæœ¬    |                         æ‘˜è¦                         |
| :---------------: | :--------: | :--------------------------------------------------: |
| [å˜æ›´ä¸€](#å˜æ›´ä¸€) | AGP v7.3.1 | å‘½åç©ºé—´å£°æ˜è¯­å¥ä»Manifestæ–‡ä»¶ç§»åŠ¨è‡³Gradleé…ç½®æ–‡ä»¶ã€‚ |

</div>

## å˜æ›´ä¸€
### æ‘˜è¦
è‡ªä»AGP v7.3.1å¼€å§‹ï¼Œå‘½åç©ºé—´å£°æ˜è¯­å¥ä»Manifestæ–‡ä»¶ç§»åŠ¨è‡³Gradleé…ç½®æ–‡ä»¶ã€‚

### è¯¦æƒ…
åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒManifestæ–‡ä»¶æ ¹æ ‡ç­¾å«æœ‰å‘½åç©ºé—´å£°æ˜è¯­å¥ `package="<Package Name>"` ï¼Œå®ƒå†³å®šäº†Manifestæ–‡ä»¶çš„é»˜è®¤åŒ…åä¸Ræ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚

"AndroidManifest.xml":

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="net.bi4vmr.study">

    <!-- æ­¤å¤„çœç•¥å…¶ä»–é…ç½®... -->
</manifest>
```

è‡ªä»AGP v7.3.1å¼€å§‹ï¼Œå‘½åç©ºé—´å£°æ˜è¯­å¥ä»Manifestæ–‡ä»¶ç§»åŠ¨è‡³Gradleé…ç½®æ–‡ä»¶ï¼Œå¯¹åº”çš„æ–¹æ³•ä¸º `namespace()` ã€‚

"build.gradle":

```groovy
android {
    namespace "net.bi4vmr.study"

    /* æ­¤å¤„çœç•¥å…¶ä»–ä»£ç ... */
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    namespace = "net.bi4vmr.study"

    /* æ­¤å¤„çœç•¥å…¶ä»–ä»£ç ... */
}
```

### å…¼å®¹æ–¹æ¡ˆ
è¾ƒæ–°ç‰ˆæœ¬çš„AGPä»ç„¶å¯ä»¥è¯†åˆ«Manifestæ–‡ä»¶ä¸­çš„å‘½åç©ºé—´å£°æ˜è¯­å¥ï¼Œå¯ä»¥ä¿æŒç°çŠ¶ã€‚


# ç–‘éš¾è§£ç­”
## ç´¢å¼•

<div align="center">

|       åºå·        |                           æ‘˜è¦                            |
| :---------------: | :-------------------------------------------------------: |
| [æ¡ˆä¾‹ä¸€](#æ¡ˆä¾‹ä¸€) |  æ„å»ºå·¥ç¨‹æ—¶å‡ºç°é”™è¯¯ï¼šå¤šä¸ªLIBæ¨¡å—çš„BuildConfigæ–‡ä»¶å†²çªã€‚   |
| [æ¡ˆä¾‹äºŒ](#æ¡ˆä¾‹äºŒ) |    æ„å»ºå·¥ç¨‹æ—¶å‡ºç°é”™è¯¯ï¼šLIBæ¨¡å—çš„Javaç‰ˆæœ¬é«˜äºAPPæ¨¡å—ã€‚     |
| [æ¡ˆä¾‹ä¸‰](#æ¡ˆä¾‹ä¸‰) |   æ„å»ºå·¥ç¨‹æ—¶å‡ºç°é”™è¯¯ï¼šæŸä¸ªä¾èµ–ç»„ä»¶ç¼ºå°‘ `*-r.txt` æ–‡ä»¶ã€‚   |
| [æ¡ˆä¾‹å››](#æ¡ˆä¾‹å››) | Gradle Syncå‡ºç°é”™è¯¯ï¼š `java.lang.NullPointerException` ã€‚ |
| [æ¡ˆä¾‹å››](#æ¡ˆä¾‹äº”) | Gradle Syncå‡ºç°é”™è¯¯ï¼š `java.lang.NullPointerException` ã€‚ |

</div>

## æ¡ˆä¾‹ä¸€
### é—®é¢˜æè¿°
APPæ¨¡å—ç¼–è¯‘å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š `Type <åŒ…å>.BuildConfig is defined multiple times` ã€‚

```text
> Task :app:mergeLibDexDebug FAILED
ERROR: RootProject/app/build/.transforms/655facb924193c287625cad02831b812/transformed/debug/<åŒ…å>/BuildConfig.dex: D8: Type <åŒ…å>.BuildConfig is defined multiple times: ...
com.android.builder.dexing.DexArchiveMergerException: Error while merging dex archives:
Learn how to resolve the issue at https://developer.android.com/studio/build/dependencies#duplicate_classes.
```

### é—®é¢˜åˆ†æ
APPæ¨¡å—ä¾èµ–å¤šä¸ªLIBæ¨¡å—ï¼Œç»æ’æŸ¥æˆ‘ä»¬å‘ç°å…¶ä¸­ä¸¤ä¸ªLIBæ¨¡å—çš„å‘½åç©ºé—´ç›¸åŒã€‚

å‘½åç©ºé—´å†³å®šäº†BuildConfigã€Rç­‰è‡ªåŠ¨ç”Ÿæˆä»£ç çš„å­˜æ”¾è·¯å¾„ï¼Œå› æ­¤å½“ä¸¤ä¸ªLIBæ¨¡å—è¢«åŒä¸€ä¸ªAPPæ¨¡å—ä¾èµ–æ—¶ï¼Œå‘½åç©ºé—´æ‰€æŒ‡å®šçš„åŒ…ä¸‹éƒ½æœ‰ä¸€ä¸ª `BuildConfig.java` æ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿå†²çªå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚

### è§£å†³æ–¹æ¡ˆ
å¦‚æœLIBæ¨¡å—éœ€è¦ç”Ÿæˆå„è‡ªçš„BuildConfigæ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»å°†ä¸¤ä¸ªæ¨¡å—çš„å‘½åç©ºé—´è®¾ä¸ºä¸åŒçš„å€¼ï¼Œé¿å…äº§ç”Ÿå†²çªã€‚

å¦‚æœLIBæ¨¡å—ä¸éœ€è¦ç”Ÿæˆå„è‡ªçš„BuildConfigæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¦æ­¢LIBæ¨¡å—ç”ŸæˆBuildConfigæ–‡ä»¶ï¼Œè¯¦è§ç›¸å…³ç« èŠ‚ï¼š [ğŸ§­ BuildConfig](./02_è¿›é˜¶ç”¨æ³•.md#buildconfig) ã€‚

## æ¡ˆä¾‹äºŒ
### é—®é¢˜æè¿°
APPæ¨¡å—ç¼–è¯‘å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š `Dependency '<ä¾èµ–ç»„ä»¶>' requires core library desugaring` ã€‚

```text
Execution failed for task ':app:checkReleaseAarMetadata'.
> A failure occurred while executing com.android.build.gradle.internal.tasks.CheckAarMetadataWorkAction
    > An issue was found when checking AAR metadata:
        1.  Dependency '<ä¾èµ–ç»„ä»¶>' requires core library desugaring to be enabled for :app.
        See https://developer.android.com/studio/write/java8-support.html for more details.
```

### é—®é¢˜åˆ†æ
æˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹é”™è¯¯ä¿¡æ¯ä¸­æåŠçš„ç½‘é¡µï¼š [ğŸ”— Java 8 Support](https://developer.android.com/studio/write/java8-support.html) ï¼Œå¯ä»¥å¾—çŸ¥é—®é¢˜åŸå› å¦‚ä¸‹ï¼š

APPæ¨¡å—æŒ‡å®šä½¿ç”¨Java 8ç¼–è¯‘ï¼ŒLIBæ¨¡å—ä½¿ç”¨Java 11ç¼–è¯‘ï¼ŒJava 11ä¸­æ–°å¢çš„ç‰¹æ€§æ— æ³•åœ¨Java 8ä¸­ä½¿ç”¨ï¼Œå› æ­¤å¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚

### è§£å†³æ–¹æ¡ˆ
Androidå®˜æ–¹æä¾›äº†åä¸ºâ€œè„±ç³–(Desugaring)â€çš„å…¼å®¹æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨APPæ¨¡å—ä¸­å¼€å¯è¯¥ç‰¹æ€§ï¼Œä½¿Gradleå‘äº§ç‰©ä¸­æ·»åŠ Java 8å¯¹Java 11çš„å…¼å®¹ä»£ç ï¼Œç¡®ä¿LIBæ¨¡å—ä¸­çš„åŠŸèƒ½å¯ä»¥æ­£å¸¸è¿è¡Œã€‚

"build.gradle":

```groovy
android {
    compileOptions {
        // å¼€å¯DesugaringåŠŸèƒ½
        coreLibraryDesugaringEnabled true
    }
}

dependencies {
    // å¼•å…¥å…¼å®¹æ¨¡å—(AGP 7.4åŠæ›´é«˜ç‰ˆæœ¬)
    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:2.0.3'
    // å¼•å…¥å…¼å®¹æ¨¡å—(AGP 7.3)
    // coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:1.2.3'
    // å¼•å…¥å…¼å®¹æ¨¡å—(AGP 4è‡³7.2)
    // coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:1.1.9'
}
```

ä¸Šè¿°å†…å®¹ä¹Ÿå¯ä»¥ä½¿ç”¨Kotlinè¯­è¨€ç¼–å†™ï¼š

"build.gradle.kts":

```kotlin
android {
    compileOptions {
        // å¼€å¯DesugaringåŠŸèƒ½
        isCoreLibraryDesugaringEnabled = true
    }
}

dependencies {
    // å¼•å…¥å…¼å®¹æ¨¡å—(AGP 7.4åŠæ›´é«˜ç‰ˆæœ¬)
    coreLibraryDesugaring("com.android.tools:desugar_jdk_libs:2.0.3")
    // å¼•å…¥å…¼å®¹æ¨¡å—(AGP 7.3)
    // coreLibraryDesugaring("com.android.tools:desugar_jdk_libs:1.2.3")
    // å¼•å…¥å…¼å®¹æ¨¡å—(AGP 4è‡³7.2)
    // coreLibraryDesugaring("com.android.tools:desugar_jdk_libs:1.1.9")
}
```

## æ¡ˆä¾‹ä¸‰
### é—®é¢˜æè¿°
APPæ¨¡å—ç¼–è¯‘å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š `NoSuchFileException: *-r.txt` ã€‚

```text
Execution failed for task ':app:dataBindingGenBaseClassesRelease'.
> java.nio.file.NoSuchFileException: /home/<ç”¨æˆ·åç§°>/.gradle/caches/transforms-3/588a8da163ac759a1b2fd83ea026b397/transformed/<ä¾èµ–åç§°>-r.txt
```

### é—®é¢˜åˆ†æ
è¯¥é—®é¢˜çš„åŸå› æ˜¯æˆ‘ä»¬åˆ é™¤äº†Gradleç¼“å­˜ç›®å½• `<ç”¨æˆ·ç›®å½•>/.gradle/caches/` ä¸­çš„AARç¼“å­˜æ–‡ä»¶ï¼Œå·²ç»å¯åŠ¨çš„Gradleè¿›ç¨‹ä¸ä¼šæ„ŸçŸ¥åˆ°è¿™ç§å˜åŒ–ï¼Œä»ç„¶è®¤ä¸ºAARæ–‡ä»¶å·²ç»ä¸‹è½½å®Œæ¯•ï¼Œå°è¯•åŠ è½½ç›¸å…³æ–‡ä»¶ï¼Œæ‰€ä»¥å‡ºç°äº†é”™è¯¯ã€‚

### è§£å†³æ–¹æ¡ˆ
æˆ‘ä»¬éœ€è¦ç»ˆæ­¢æ­£åœ¨è¿è¡Œçš„Gradleè¿›ç¨‹ï¼Œå¹¶åˆ é™¤Gradleè¿›ç¨‹çš„ç¼“å­˜æ–‡ä»¶ï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´ã€‚ä¾‹å¦‚ï¼šå½“å‰å·¥ç¨‹ä½¿ç”¨çš„Gradleç‰ˆæœ¬ä¸º"8.5"ï¼Œæˆ‘ä»¬åº”å½“åˆ é™¤ `<ç”¨æˆ·ç›®å½•>/.gradle/caches/8.5/` ç›®å½•å¹¶å°è¯•å†æ¬¡ç¼–è¯‘ã€‚

å¯¹äºLinuxå¹³å°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ é™¤ç¼“å­˜æ–‡ä»¶ï¼š

```text
# ç»ˆæ­¢æ‰€æœ‰ä¸å½“å‰å·¥ç¨‹Gradleç‰ˆæœ¬ä¸€è‡´çš„Gradleè¿›ç¨‹
[root@Fedora RootProject]# ./gradlew --stop

# ç»ˆæ­¢æ‰€æœ‰Gradleè¿›ç¨‹
#
# æœ¬æ–¹æ³•å°†ä¼šç»ˆæ­¢æ‰€æœ‰ç‰ˆæœ¬çš„Gradleè¿›ç¨‹ï¼Œé€‚åˆåœ¨å…·æœ‰å¤šä¸ªå­å·¥ç¨‹çš„å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨ã€‚
#
# "grep -v 'gradle-clear.sh'"å¯ä»¥é˜²æ­¢åœ¨è„šæœ¬ä¸­è¿è¡Œæ—¶å‘½ä»¤è‡ªèº«è¢«ç»ˆæ­¢ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼Œå¯ä»¥å¿½ç•¥è¯¥éƒ¨åˆ†ã€‚
[root@Fedora ~]# ps -ef | grep 'gradle' | grep -v 'grep' | grep -v 'gradle-clear.sh' | awk '{print $2}' | xargs -I "{}" sh -c 'if test ! -z "{}";then kill "{}"; fi'

# åˆ é™¤Gradleè¿›ç¨‹çš„ç¼“å­˜æ–‡ä»¶
[root@Fedora ~]# find ~/.gradle/caches -maxdepth 1 -name "[1-9].*" | xargs rm -rf
```

ä¸Šè¿°æ–¹æ³•ä»…å¯ç”¨äºæœ¬åœ°è°ƒè¯•ï¼Œå¯¹äºæœåŠ¡å™¨ç¯å¢ƒï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–Gradleç¼–è¯‘ä»»åŠ¡ä¸­æ–­ï¼›æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨ç¼–è¯‘ä»»åŠ¡çš„å‘½ä»¤è¡Œä¸­æ·»åŠ  `--no-daemon` é€‰é¡¹ï¼Œä¸å†å¤ç”¨Gradleåå°è¿›ç¨‹ã€‚

```text
# ç¼–è¯‘AARæˆ–APKï¼Œä¸”ä¸å¤ç”¨Gradleåå°è¿›ç¨‹ã€‚
[root@Fedora ~]# ./gradlew assembleRelease --no-daemon
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿®æ”¹å…¨å±€æˆ–å·¥ç¨‹çš„ `gradle.properties` é…ç½®æ–‡ä»¶ï¼Œå°†è¯¥é€‰é¡¹ä½œä¸ºæŒä¹…åŒ–é…ç½®ï¼š

"gradle.properties":

```ini
# Disable gradle daemons
org.gradle.daemon=false
```

## æ¡ˆä¾‹å››
### é—®é¢˜æè¿°
APPæ¨¡å—ç¼–è¯‘å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š `D8: java.lang.NullPointerException` ã€‚

```text
Task :app:mergeExtDexDebug FAILED

ERROR:/home/bi4vmr/.gradle/caches/modules-2/files-2.1/<æ¨¡å—åç§°>/<æ¨¡å—ç‰ˆæœ¬>/<æ–‡ä»¶Hash>/<æ–‡ä»¶åç§°>.jar: D8: java.lang.NullPointerException: Cannot invoke "String.length()" because "<parameter1>" is null
```

### é—®é¢˜åˆ†æ
APPæ¨¡å—å¼•ç”¨äº†JARåŒ…ï¼Œè¯¥JARåŒ…å¯¹åº”æ¨¡å—ä¸­åŒ…å«JDKæä¾›çš„MessageDigestå·¥å…·ï¼Œä¸”æ¨¡å—é…ç½®æ–‡ä»¶æŒ‡å®šç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬ä¸ºJava 8ã€‚

å¯èƒ½çš„åŸå› æ˜¯æ ‡å‡†JVMä¸Android JVMå®ç°æœ‰å·®å¼‚ï¼Œå› æ­¤Java 8ç‰ˆæœ¬çš„æ ‡å‡†JVMä¸­MessageDigestå·¥å…·åœ¨Android JVMä¸­ä¸å¯ç”¨ã€‚

### è§£å†³æ–¹æ¡ˆ
æˆ‘ä»¬å°†JARåŒ…å¯¹åº”æ¨¡å—çš„ç¼–è¯‘ç‰ˆæœ¬ä¿®æ”¹ä¸ºJava 11ï¼Œé‡æ–°ç¼–è¯‘ç”Ÿæˆæ–°çš„JARåŒ…ï¼Œå¹¶åœ¨Androidå·¥ç¨‹ä¸­å¼•ç”¨ï¼Œé—®é¢˜å¾—ä»¥è§£å†³ã€‚

"build.gradle.kts":

```kotlin
java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}
```

## æ¡ˆä¾‹äº”
### é—®é¢˜æè¿°
åœ¨Android Studioä¸­æ‰§è¡ŒGradle Syncæ—¶ï¼Œæ“ä½œå¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š `java.lang.NullPointerException` ã€‚

### é—®é¢˜åˆ†æ
å½“æˆ‘ä»¬ä½¿ç”¨ `gradlew` å‘½ä»¤ç¼–è¯‘å·¥ç¨‹æ—¶ä¸ä¼šé‡åˆ°æ­¤é”™è¯¯ï¼Œä»…å½“Android Studioæ‰§è¡ŒGradle Syncæ—¶ä¼šå‡ºç°ï¼Œå› æ­¤å¯ä»¥ç¡®å®šé—®é¢˜ä¸Android Studioæœ‰å…³ã€‚

### è§£å†³æ–¹æ¡ˆ
æˆ‘ä»¬å¯ä»¥ä¾æ¬¡åˆ é™¤ä»¥ä¸‹ç¼“å­˜æ–‡ä»¶ï¼Œå¹¶å°è¯•é‡æ–°å¯åŠ¨Android Studioå†æ¬¡æ‰§è¡ŒGradle Syncï¼š

- åˆ é™¤å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„ `.gradle` ç¼“å­˜ç›®å½•ã€‚
- æ¸…ç†Android Studioçš„ç¼“å­˜æ–‡ä»¶ï¼ˆé€šè¿‡ `File - Invalidate Cache` èœå•ï¼‰ã€‚
- æ¸…ç†Android Studioçš„ç”¨æˆ·é…ç½®ï¼ˆWindowså¹³å° : `%USERPROFILE%\AppData\Local\Google\<Android Studioç‰ˆæœ¬å·>\projects\<åç§°å«æœ‰å·¥ç¨‹åå­—çš„ç›®å½•>\` ï¼›Linuxå¹³å° : `~/.cache/Google/<Android Studioç‰ˆæœ¬å·>/projects/<åç§°å«æœ‰å·¥ç¨‹åå­—çš„ç›®å½•>/` ï¼‰ã€‚
