<!-- TODO -->

# ç–‘éš¾è§£ç­”
## ç´¢å¼•

<div align="center">

|       åºå·        |                                æ‘˜è¦                                 |
| :---------------: | :-----------------------------------------------------------------: |
| [æ¡ˆä¾‹ä¸€](#æ¡ˆä¾‹ä¸€) |  è¿æ¥æœåŠ¡å™¨æ—¶å‡ºç°é”™è¯¯ï¼š `no matching key exchange method found` ã€‚  |
| [æ¡ˆä¾‹äºŒ](#æ¡ˆä¾‹äºŒ) |     è¿æ¥æœåŠ¡å™¨æ—¶å‡ºç°é”™è¯¯ï¼š `no matching host key type found` ã€‚     |
| [æ¡ˆä¾‹ä¸‰](#æ¡ˆä¾‹ä¸‰) | è¿æ¥æœåŠ¡å™¨æ—¶å‡ºç°é”™è¯¯ï¼š `signing failed: agent refused operation` ã€‚ |

</div>

## æ¡ˆä¾‹ä¸€
### é—®é¢˜æè¿°
SSHå®¢æˆ·ç«¯æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š

```text
Unable to negotiate with 10.0.0.1 port 22: no matching key exchange method found. Their offer: diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
```

### é—®é¢˜åˆ†æ
åœ¨OpenSSH v7.2åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå®¢æˆ·ç«¯é»˜è®¤ç¦ç”¨è¾ƒæ—§çš„ `diffie-hellman-group1-sha1` å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œä½†ç›®æ ‡æœåŠ¡å™¨åªæä¾›äº† `diffie-hellman-group14-sha1` å’Œ `diffie-hellman-group1-sha1` ç®—æ³•ï¼Œå› æ­¤æ— æ³•å»ºç«‹è¿æ¥ã€‚

### è§£å†³æ–¹æ¡ˆ
å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç®¡ç†ç›®æ ‡æœåŠ¡å™¨ï¼Œä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œæœ€å¥½å‡çº§æœåŠ¡å™¨çš„SSHè½¯ä»¶ç‰ˆæœ¬ï¼Œå¼ƒç”¨è€æ—§çš„ç®—æ³•ã€‚

å¦‚æœæˆ‘ä»¬æ— æ³•å‡çº§ç›®æ ‡æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯æ·»åŠ é…ç½®ï¼Œå…è®¸ä½¿ç”¨è€æ—§çš„ç®—æ³•ã€‚

ğŸ”· æ–¹æ³•ä¸€

åœ¨SSHå‘½ä»¤è¡Œä¸­æ·»åŠ  `-oKexAlgorithms=+diffie-hellman-group1-sha1` é€‰é¡¹ï¼Œè¯¥æ–¹æ³•é€‚ç”¨äºä¸´æ—¶æ€§çš„è°ƒè¯•å·¥ä½œã€‚

ğŸ”· æ–¹æ³•äºŒ

ç¼–è¾‘å½“å‰ç”¨æˆ·çš„SSHé…ç½®æ–‡ä»¶ï¼Œå…è®¸ä¸ç›®æ ‡æœåŠ¡å™¨è¿æ¥æ—¶ä½¿ç”¨è¯¥ç®—æ³•ã€‚

```text
# æ–°å»ºæˆ–ç¼–è¾‘é…ç½®æ–‡ä»¶
[root@Fedora ~]# vim ~/.ssh/config

# æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å†…å®¹
Host *
KexAlgorithms +diffie-hellman-group1-sha1
```

è¯¥æ–¹æ³•é€‚ç”¨äºå½“å‰ç”¨æˆ·ï¼Œä¸å½±å“å…¨å±€é…ç½®ã€‚

ğŸ”· æ–¹æ³•ä¸‰

ç¼–è¾‘å…¨å±€SSHé…ç½®æ–‡ä»¶ï¼Œå…è®¸ä¸ç›®æ ‡æœåŠ¡å™¨è¿æ¥æ—¶ä½¿ç”¨è¯¥ç®—æ³•ã€‚

```text
# æ–°å»ºæˆ–ç¼–è¾‘é…ç½®æ–‡ä»¶
[root@Fedora ~]# vim /etc/ssh/ssh_config

# æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å†…å®¹
KexAlgorithms +diffie-hellman-group1-sha1
```

è¯¥æ–¹æ³•é’ˆå¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆã€‚

## æ¡ˆä¾‹äºŒ
### é—®é¢˜æè¿°
SSHå®¢æˆ·ç«¯æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š

```text
Unable to negotiate with 10.0.0.1 port 22: no matching host key type found. Their offer: ssh-rsa,ssh-ds
```

### é—®é¢˜åˆ†æ
åœ¨OpenSSH v8.8åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå®¢æˆ·ç«¯é»˜è®¤ç¦ç”¨è¾ƒæ—§çš„ `ssh-rsa` å¯†é’¥ï¼Œä½†ç›®æ ‡æœåŠ¡å™¨åªæä¾›äº† `ssh-rsa` å’Œ `ssh-ds` å¯†é’¥è®¤è¯æ–¹å¼ï¼Œå› æ­¤æ— æ³•å»ºç«‹è¿æ¥ã€‚

### è§£å†³æ–¹æ¡ˆ
å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç®¡ç†ç›®æ ‡æœåŠ¡å™¨ï¼Œä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œæœ€å¥½å‡çº§æœåŠ¡å™¨çš„SSHè½¯ä»¶ç‰ˆæœ¬ï¼Œå¼ƒç”¨è€æ—§çš„å¯†é’¥ã€‚

å¦‚æœæˆ‘ä»¬æ— æ³•å‡çº§ç›®æ ‡æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯æ·»åŠ é…ç½®ï¼Œå…è®¸ä½¿ç”¨è€æ—§çš„å¯†é’¥ã€‚

ğŸ”· æ–¹æ³•ä¸€

åœ¨SSHå‘½ä»¤è¡Œä¸­æ·»åŠ  `-oHostKeyAlgorithms=+ssh-rsa` é€‰é¡¹ï¼Œè¯¥æ–¹æ³•é€‚ç”¨äºä¸´æ—¶æ€§çš„è°ƒè¯•å·¥ä½œã€‚

ğŸ”· æ–¹æ³•äºŒ

ç¼–è¾‘å½“å‰ç”¨æˆ·çš„SSHé…ç½®æ–‡ä»¶ï¼Œå…è®¸ä¸ç›®æ ‡æœåŠ¡å™¨è¿æ¥æ—¶ä½¿ç”¨è¯¥å¯†é’¥ã€‚

```text
# æ–°å»ºæˆ–ç¼–è¾‘é…ç½®æ–‡ä»¶
[root@Fedora ~]# vim ~/.ssh/config

# æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å†…å®¹
Host *
PubkeyAcceptedKeyTypes +ssh-rsa
HostKeyAlgorithms +ssh-rsa
```

è¯¥æ–¹æ³•é€‚ç”¨äºå½“å‰ç”¨æˆ·ï¼Œä¸å½±å“å…¨å±€é…ç½®ã€‚

ğŸ”· æ–¹æ³•ä¸‰

ç¼–è¾‘å…¨å±€SSHé…ç½®æ–‡ä»¶ï¼Œå…è®¸ä¸ç›®æ ‡æœåŠ¡å™¨è¿æ¥æ—¶ä½¿ç”¨è¯¥å¯†é’¥ã€‚

```text
# æ–°å»ºæˆ–ç¼–è¾‘é…ç½®æ–‡ä»¶
[root@Fedora ~]# vim /etc/ssh/ssh_config

# æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å†…å®¹
PubkeyAcceptedKeyTypes +ssh-rsa
HostKeyAlgorithms +ssh-rsa
```

è¯¥æ–¹æ³•é’ˆå¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆã€‚

## æ¡ˆä¾‹ä¸‰
### é—®é¢˜æè¿°
SSHå®¢æˆ·ç«¯æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š

```text
[user@Ubuntu ~]$ ssh -T 10.0.0.1 -vvv
OpenSSH_8.9p1 Ubuntu-3ubuntu0.13, OpenSSL 3.0.2 15 Mar 2022

# æ­¤å¤„å·²çœç•¥éƒ¨åˆ†è¾“å‡ºå†…å®¹...

debug1: Server accepts key: /home/user/.ssh/id_rsa RSA SHA256:pufdBOzQAwJq3s3dj6riXesA8wG+1zNlVAOg6MAqlUU agent
debug3: sign_and_send_pubkey: using publickey with RSA SHA256:pufdBOzQAwJq3s3dj6riXesA8wG+1zNlVAOg6MAqlUU
debug3: sign_and_send_pubkey: signing using rsa-sha2-512 SHA256:pufdBOzQAwJq3s3dj6riXesA8wG+1zNlVAOg6MAqlUU
sign_and_send_pubkey: signing failed for RSA "/home/user/.ssh/id_rsa" from agent: agent refused operation
user@10.0.0.1: Permission denied (publickey).
```

### é—®é¢˜åˆ†æ
ä»æœåŠ¡å™¨è¿”å›çš„æ¶ˆæ¯å¯çŸ¥ï¼Œå®¢æˆ·ç«¯çš„ç§é’¥æ— æ³•è§£å¯†æ•°æ®ï¼Œé€šä¿¡å¤±è´¥ã€‚

### è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨å…¶ä»–è®¾å¤‡ç”Ÿæˆæ–°çš„RSAå¯†é’¥å¯¹ï¼Œå¤åˆ¶åˆ°è¯¥å®¢æˆ·ç«¯ä¸Šå¹¶åœ¨æœåŠ¡å™¨æ³¨å†Œå…¬é’¥åï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¢å¤æ­£å¸¸é€šä¿¡ã€‚

```text
[root@Fedora ~]# ssh-keygen -C "test@example.net"
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /root/id_rsa
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/id_rsa
Your public key has been saved in /root/id_rsa.pub
The key fingerprint is:
SHA256:3E/X0VjlIjuCZbYj7QAWDspQiEXZA1HmFStonpKvYj0 test@example.net
The key's randomart image is:
+---[RSA 3072]----+
|o=**+ +.        +|
|oo.=o+ o       +.|
|  = o.=   + . o.o|
| + . o o B . o o.|
|o o     S * + . .|
| o       + = o   |
|  o       . .    |
|.o E             |
|+   .            |
+----[SHA256]-----+
```

è¯¥é—®é¢˜çš„æ ¹å› å·²æ— æ³•è€ƒè¯ï¼Œå¯èƒ½æ˜¯å®¢æˆ·ç«¯OpenSSHç‰ˆæœ¬ç”Ÿæˆçš„å¯†é’¥ä¸æœåŠ¡ç«¯ä¸åŒ¹é…ï¼Œä¹Ÿå¯èƒ½æ˜¯å…ˆå‰ç”Ÿæˆçš„å¯†é’¥ç±»å‹ä¸æ­£ç¡®ï¼›è‹¥é‡åˆ°åŒç±»é”™è¯¯å¯å°è¯•ä¸Šè¿°æ­¥éª¤ã€‚
