# ç®€ä»‹
éƒ¨åˆ†åŠŸèƒ½æ¨¡å—å¹¶ä¸æ”¯æŒåç¨‹ï¼Œå®ƒä»¬åªæä¾›äº†æ¥å£å›è°ƒé£æ ¼çš„APIï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨åç¨‹ä»£ç ä¸­è°ƒç”¨è¿™äº›æ¥å£ï¼Œå°±ä¼šå¢åŠ åµŒå¥—å±‚çº§ã€é™ä½ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚

Kotlinåç¨‹åº“æä¾›äº† `suspendCoroutine()` ç­‰å·¥å…·ï¼Œç”¨äºå°†æ¥å£å›è°ƒé£æ ¼çš„APIè½¬æ¢ä¸ºæŒ‚èµ·å‡½æ•°ï¼Œä»¥ä¾¿åœ¨åç¨‹ä»£ç ä¸­è°ƒç”¨ï¼Œå‡å°‘åµŒå¥—å±‚çº§å¹¶ç»Ÿä¸€ç¼–ç é£æ ¼ã€‚

ğŸ”´ ç¤ºä¾‹ä¸€

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£å›è°ƒé£æ ¼çš„æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚APIï¼Œå¹¶æ¼”ç¤ºå®ƒçš„è°ƒç”¨æ–¹æ³•ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰å›è°ƒæ¥å£ï¼Œå¹¶åœ¨æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„æ–¹æ³•ä¸­è°ƒç”¨å®ƒçš„å®ç°ã€‚

"TestWorkWithThread.kt":

```kotlin
// ç½‘ç»œè¯·æ±‚å›è°ƒæ¥å£
interface NetCallback {

    // è¯·æ±‚æˆåŠŸ
    fun onSuccess(data: String)

    // è¯·æ±‚å¤±è´¥
    fun onFailure(message: String)
}

/**
 * æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ã€‚
 *
 * @param[result] æ§åˆ¶è¯·æ±‚ç»“æœã€‚
 * @param[callback] ç»“æœå›è°ƒã€‚
 */
fun request(result: Boolean, callback: NetCallback) {
    // å¼€å¯æ–°çº¿ç¨‹è¿›è¡Œç½‘ç»œè¯·æ±‚
    thread {
        // çº¿ç¨‹ä¼‘çœ ï¼Œæ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶ã€‚
        Thread.sleep(3000L)
        // ä¼‘çœ ç»“æŸï¼Œè°ƒç”¨å›è°ƒæ–¹æ³•åé¦ˆæ‰§è¡Œç»“æœã€‚
        if (result) {
            callback.onSuccess("200 - OK.")
        } else {
            callback.onFailure("502 - Bad Gateway.")
        }
    }
}
```

NetCallbackæ¥å£å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ `onSuccess()` æ–¹æ³•åœ¨è¯·æ±‚æˆåŠŸæ—¶è¢«è§¦å‘ï¼Œå‚æ•°ä¸ºæœåŠ¡ç«¯è¿”å›çš„æ•°æ®ï¼› `onFailure()` æ–¹æ³•åˆ™åœ¨è¯·æ±‚å¤±è´¥æ—¶è¢«è§¦å‘ï¼Œå‚æ•°ä¸ºé”™è¯¯ä¿¡æ¯ã€‚

`request()` æ–¹æ³•ç”¨äºæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œå…¶ä¸­å¼€å¯äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œä¼‘çœ 3ç§’ä»¥æ¨¡æ‹Ÿç½‘ç»œè€—æ—¶ï¼Œä¼‘çœ ç»“æŸåæ ¹æ®å‚æ•° `result` è°ƒç”¨NetCallbackå¯¹è±¡çš„å¯¹åº”æ–¹æ³•ï¼Œå‘è°ƒç”¨è€…åé¦ˆè¯·æ±‚ç»“æœã€‚

ç¬¬äºŒæ­¥ï¼Œè°ƒç”¨è€…ä½¿ç”¨è¯¥æ¥å£æ—¶ï¼Œéœ€è¦ä¼ å…¥NetCallbackå®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶åœ¨ç»“æœè¿”å›æ—¶æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼ˆä¾‹å¦‚æ›´æ–°ç•Œé¢ï¼‰ï¼Œæ­¤å¤„æˆ‘ä»¬åªæ˜¯ç®€å•çš„å°†å›è°ƒç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°ä¸Šã€‚

"TestWorkWithThread.kt":

```kotlin
println("Mock request start. Time:[${getTime()}]")
request(true, object : NetCallback {
    override fun onSuccess(data: String) {
        println("OnSuccess. Time:[${getTime()}] Data:[$data]")
    }

    override fun onFailure(message: String) {
        println("OnFailure. Time:[${getTime()}] Info:[$message]")
    }
})
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Mock request start. Time:[23:18:09.453]
OnSuccess. Time:[23:18:12.481] Data:[200 - OK.]
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

`request()` æ–¹æ³•è¢«è°ƒç”¨3ç§’åï¼ŒNetCallbackå¯¹è±¡çš„ `onSuccess()` å›è°ƒæ–¹æ³•è¢«è§¦å‘ï¼Œè¾“å‡ºäº†è¯·æ±‚ç»“æœã€‚

# "suspendCoroutine()"æ–¹æ³•
## åŸºæœ¬åº”ç”¨
`suspendCoroutine()` æ–¹æ³•æ˜¯ä¸€ç§å…è®¸å¼€å‘è€…æ§åˆ¶åç¨‹ä»»åŠ¡æš‚åœä¸æ¢å¤çš„å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒå°†å‰æ–‡â€œç¤ºä¾‹ä¸€â€ä¸­çš„å›è°ƒé£æ ¼æ¥å£ `request()` è½¬æ¢ä¸ºæŒ‚èµ·å‡½æ•°ã€‚

ğŸŸ  ç¤ºä¾‹äºŒ

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `suspendCoroutine()` æ–¹æ³•å°†å›è°ƒæ¥å£ `request()` è½¬æ¢ä¸ºæŒ‚èµ·å‡½æ•°ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰ `requestSuspend()` æ–¹æ³•å®ç°è½¬æ¢é€»è¾‘ã€‚

"TestWorkWithThread.kt":

```kotlin
// æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼ˆæŒ‚èµ·å‡½æ•°å®ç°ï¼‰ã€‚
private suspend fun requestSuspend(result: Boolean): String {
    return suspendCoroutine {
        request(result, object : NetCallback {
            override fun onSuccess(data: String) {
                // è¯·æ±‚æˆåŠŸï¼Œè§£é™¤æŒ‚èµ·çŠ¶æ€å¹¶è¿”å›æ•°æ®ã€‚
                it.resume(data)
            }

            override fun onFailure(message: String) {
                // è¯·æ±‚å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚
                val exception = Exception(message)
                it.resumeWithException(exception)
            }
        })
    }
}
```

å½“åç¨‹ä»»åŠ¡è¿è¡Œè‡³ `suspendCoroutine()` æ–¹æ³•æ—¶ï¼Œè¿›å…¥æš‚åœçŠ¶æ€ï¼Œéšåè°ƒåº¦å™¨å¼€å§‹æ‰§è¡Œæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ã€‚å½“å›è°ƒæ–¹æ³• `onSuccess()` é€šçŸ¥è¯·æ±‚æˆåŠŸäº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ `it.resume()` æ–¹æ³•é€šçŸ¥åç¨‹ä»»åŠ¡ä»æš‚åœçŠ¶æ€æ¢å¤ï¼Œå¹¶ä¼ å…¥å‚æ•°æ¥ä¼ é€’å›è°ƒæ–¹æ³•çš„è¯·æ±‚ç»“æœã€‚ `suspendCoroutine()` æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ï¼Œä¸ `it.resume()` æ–¹æ³•çš„å‚æ•°ç±»å‹ä¿æŒä¸€è‡´ï¼Œæ­¤å¤„è¯·æ±‚ç»“æœ `data` çš„æ•°æ®ç±»å‹ä¸ºStringï¼Œå› æ­¤ `suspendCoroutine()` æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ä¹Ÿæ˜¯Stringã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨åç¨‹ä»»åŠ¡ä¸­è°ƒç”¨ `requestSuspend()` æŒ‚èµ·å‡½æ•°ï¼Œä»¥åç¨‹çš„æ–¹å¼ä½¿ç”¨æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚APIã€‚

"TestWorkWithThread.kt":

```kotlin
CoroutineScope(Dispatchers.IO).launch {
    println("Mock request start. Time:[${getTime()}]")
    // å£°æ˜å˜é‡ä»¥ä¾¿æ¥æ”¶è¯·æ±‚æˆåŠŸçš„ç»“æœ
    val data = requestSuspend(true)
    println("Request success. Time:[${getTime()}] Data:[$data]")
}
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Mock request start. Time:[21:18:09.453]
Request success. Time:[21:18:12.481] Data:[200 - OK.]
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

åç¨‹ä»»åŠ¡è¿è¡Œè‡³ `suspendCoroutine()` æ–¹æ³•æ—¶ï¼Œè¿›å…¥æš‚åœçŠ¶æ€ï¼Œè°ƒåº¦å™¨å¼€å§‹æ‰§è¡Œæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼›3ç§’åï¼Œå›è°ƒæ¥å£è§¦å‘äº† `onSuccess()` å›è°ƒæ–¹æ³•åŠå…¶ä¸­çš„ `it.resume()` æ–¹æ³•ï¼Œè°ƒç”¨è€…æ¥æ”¶åˆ°è¯·æ±‚ç»“æœå¹¶ä»æš‚åœçŠ¶æ€æ¢å¤ã€‚

ä¸‹æ–‡åˆ—è¡¨å±•ç¤ºäº† `suspendCoroutine()` æ–¹æ³•çš„ä¸€äº›ç‰¹æ€§ï¼š

- `it.resume()` è¯­å¥åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå¦åˆ™ä¼šå¯¼è‡´å¼‚å¸¸ï¼š `IllegalStateException: Already resumed` ã€‚
- å¦‚æœ `it.resume()` è¯­å¥ä¹‹åè¿˜æœ‰å…¶ä»–è¯­å¥ï¼Œå½“ `it.resume()` è¯­å¥è¢«è°ƒç”¨åï¼Œå‰©ä½™çš„è¯­å¥ä»ç„¶ä¼šè¢«æ‰§è¡Œã€‚

## åé¦ˆå¼‚å¸¸çŠ¶æ€
NetCallbackæ¥å£æœ‰â€œè¯·æ±‚æˆåŠŸâ€å’Œâ€œè¯·æ±‚å¤±è´¥â€ä¸¤ç§æƒ…å†µï¼Œç”±äºæŒ‚èµ·å‡½æ•°åªèƒ½æœ‰å•ä¸ªè¿”å›å€¼ï¼Œå·²ç»è¢«æˆ‘ä»¬ç”¨æ¥åé¦ˆæˆåŠŸçŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡å¼‚å¸¸æœºåˆ¶åé¦ˆå¤±è´¥çŠ¶æ€ç»™è°ƒç”¨è€…ã€‚

ğŸŸ¡ ç¤ºä¾‹ä¸‰

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ•è· `requestSuspend()` æ–¹æ³•å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸ï¼Œå¤„ç†è¯·æ±‚å¤±è´¥äº‹ä»¶ã€‚

åœ¨å‰æ–‡â€œç¤ºä¾‹äºŒâ€ä¸­ï¼Œæˆ‘ä»¬å·²ç»åœ¨æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å›è°ƒå¤±è´¥ç»“æœæ—¶ï¼Œè°ƒç”¨ `it.resumeWithException()` è¯­å¥å‘è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤åªéœ€è¦åœ¨è°ƒç”¨ `requestSuspend()` æ–¹æ³•çš„åç¨‹ä½“ä¸­æ·»åŠ "try ... catch"è¯­å¥å³å¯ã€‚

"TestWorkWithThread.kt":

```kotlin
CoroutineScope(Dispatchers.IO).launch {
    try {
        println("Mock request start. Time:[${getTime()}]")
        // æ¨¡æ‹Ÿè¯·æ±‚å¤±è´¥çš„æƒ…å†µ
        val data = requestSuspend(false)
        println("Request success. Time:[${getTime()}] Data:[$data]")
    } catch (e: Exception) {
        // æ•è·å¼‚å¸¸ä»¥è·å–å¤±è´¥è¯¦æƒ…
        println("Request failure. Info:[${e.message}]")
    }
}
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Mock request start. Time:[21:22:02.464]
Request failure. Time:[21:22:05.580] Info:[502 - Bad Gateway.]
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å¼€å§‹3ç§’åï¼Œè§¦å‘äº† `onFailure()` å›è°ƒæ–¹æ³•åŠå…¶ä¸­çš„ `it.resumeWithException()` æ–¹æ³•ï¼Œå‘è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯ï¼›éšåè°ƒç”¨ `requestSuspend()` æ–¹æ³•çš„åç¨‹ä½“æ•è·äº†å¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡Exceptionå¯¹è±¡è·å–å¼‚å¸¸è¯¦æƒ…ã€‚

## å¤„ç†ä¸­æ–­è¯·æ±‚
åœ¨å‰æ–‡â€œç¤ºä¾‹äºŒâ€ä¸­ï¼Œé€šè¿‡ `suspendCoroutine()` æ–¹æ³•æ„å»ºçš„æŒ‚èµ·å‡½æ•°å¹¶ä¸æ”¯æŒä¸­æ–­è¯·æ±‚ï¼Œå¤–éƒ¨è°ƒç”¨ `cancel()` æ–¹æ³•ä¸ä¼šæœ‰ä»»ä½•ååº”ï¼Œåç¨‹ä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œç›´åˆ°ä»»åŠ¡å®Œæˆä¸ºæ­¢ã€‚

ä¸ºäº†æ”¯æŒå“åº”ä¸­æ–­ä»»åŠ¡çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å°† `suspendCoroutine()` æ–¹æ³•æ›¿æ¢ä¸º `suspendCancellableCoroutine()` æ–¹æ³•ï¼Œå®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•å®Œå…¨ç›¸åŒï¼Œåè€…é¢å¤–å¢åŠ äº†ä¸­æ–­å¤„ç†åŠŸèƒ½ã€‚

ğŸŸ¢ ç¤ºä¾‹å››

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºå‰æ–‡â€œç¤ºä¾‹äºŒâ€ä¸­çš„ `requestSuspend()` æ–¹æ³•æ·»åŠ ä¸­æ–­å¤„ç†åŠŸèƒ½ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰ `requestSuspend2()` æ–¹æ³•ã€‚

"TestWorkWithThread.kt":

```kotlin
private suspend fun requestSuspend2(result: Boolean): String {
    return suspendCancellableCoroutine {
        // æ­¤å¤„å¯ä»¥ä¹¦å†™æ”¶åˆ°ä¸­æ–­è¯·æ±‚åçš„æ¸…ç†å·¥ä½œ
        it.invokeOnCancellation {
            println("Task was canceled!")
        }

        request(result, object : NetCallback {
            override fun onSuccess(data: String) {
                // è¯·æ±‚æˆåŠŸï¼Œè§£é™¤æŒ‚èµ·çŠ¶æ€å¹¶è¿”å›æ•°æ®ã€‚
                it.resume(data)
            }

            override fun onFailure(message: String) {
                // è¯·æ±‚å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚
                val exception = Exception(message)
                it.resumeWithException(exception)
            }
        })
    }
}
```

æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨ `it.invokeOnCancellation()` æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œå…¶ä¸­çš„ä»£ç å°†åœ¨æ”¶åˆ°ä¸­æ–­è¯·æ±‚åè¢«æ‰§è¡Œï¼Œé€šå¸¸ç”¨æ¥è¿›è¡Œé‡Šæ”¾èµ„æºã€æ¸…ç†ä¸´æ—¶æ–‡ä»¶ç­‰å–„åæ“ä½œã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåç¨‹ä»»åŠ¡è°ƒç”¨æŒ‚èµ·å‡½æ•° `requestSuspend2()` ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸­å‘èµ·ä¸­æ–­è¯·æ±‚ã€‚

"TestWorkWithThread.kt":

```kotlin
val job: Job = CoroutineScope(Dispatchers.IO).launch {
    try {
        println("Mock request start. Time:[${getTime()}]")
        // æ¨¡æ‹Ÿè¯·æ±‚å¤±è´¥çš„æƒ…å†µ
        val data = requestSuspend2(true)
        println("Request success. Time:[${getTime()}] Data:[$data]")
    } catch (e: Exception) {
        // æ•è·å¼‚å¸¸ä»¥è·å–å¤±è´¥è¯¦æƒ…
        println("Request failure. Time:[${getTime()}] Info:[${e.message}]")
    }
}

// å»¶æ—¶1ç§’åå–æ¶ˆåç¨‹ä»»åŠ¡
Thread.sleep(1000L)
job.cancel(CancellationException("Task has been canceled."))
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Mock request start. Time:[16:20:37.158]
Task was canceled!
Request failure. Time:[16:20:38.149] Info:[Task has been canceled.]
```

# "runBlocking()"æ–¹æ³•
`runBlocking()` æ–¹æ³•çš„åŠŸèƒ½ä¸CoroutineScopeçš„ `launch()` å’Œ `async()` æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½å¯ä»¥æä¾›åç¨‹ç¯å¢ƒå¹¶å¼€å¯åç¨‹ä»»åŠ¡ï¼Œä½† `launch()` å’Œ `async()` æ–¹æ³•å±äºCoroutineScopeå¯¹è±¡ï¼Œä¸”ä¸ä¼šé˜»å¡è°ƒç”¨è€…çº¿ç¨‹ï¼› `runBlocking()` æ–¹æ³•åˆ™å¯ä»¥è¢«ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦ä¾èµ–CoroutineScopeå¯¹è±¡ï¼Œå¹¶ä¸”ä¼šé˜»å¡è°ƒç”¨è€…çº¿ç¨‹ï¼Œç›´åˆ°åç¨‹ä»»åŠ¡è¿è¡Œå®Œæ¯•ã€‚

è¯¥æ–¹æ³•çš„ä¸»è¦ç”¨é€”æ˜¯å°†åç¨‹APIè½¬æ¢ä¸ºæ¥å£å›è°ƒAPIï¼Œä»¥ä¾¿è°ƒç”¨è€…åœ¨ä¸æ”¯æŒåç¨‹çš„ç¯å¢ƒä¸­ä½¿ç”¨è¿™äº›APIï¼›é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥æ–¹æ³•è¿˜å¯ä»¥ç”¨äºåœ¨ `main()` æ–¹æ³•ä¸­æµ‹è¯•åç¨‹APIã€‚

ğŸ”µ ç¤ºä¾‹äº”

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `runBlocking()` æ–¹æ³•å°†å‰æ–‡â€œç¤ºä¾‹äºŒâ€ä¸­çš„æŒ‚èµ·å‡½æ•° `requestSuspend()` è½¬æ¢ä¸ºæ¥å£å›è°ƒå½¢å¼ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰ `requestCallback()` æ–¹æ³•å®ç°è½¬æ¢é€»è¾‘ã€‚

"TestWorkWithThread.kt":

```kotlin
// æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼ˆåç¨‹è½¬æ¥å£å›è°ƒï¼‰ã€‚
fun requestCallback(result: Boolean, callback: NetCallback) {
    // åœ¨æ–°çº¿ç¨‹è¿›è¡Œç½‘ç»œè¯·æ±‚
    thread {
        // å¼€å¯åç¨‹ä»»åŠ¡å¹¶é˜»å¡å½“å‰çº¿ç¨‹
        runBlocking {
            try {
                val data: String = requestSuspend(result)
                // è·å–åˆ°ç»“æœåï¼Œé€šè¿‡å›è°ƒæ–¹æ³•é€šçŸ¥è°ƒç”¨è€…ã€‚
                callback.onSuccess(data)
            } catch (e: Exception) {
                callback.onFailure(e.message ?: "")
            }
        }
    }
}
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ä»£ç ä¸­è°ƒç”¨è¯¥æ–¹æ³•ã€‚

"TestWorkWithThread.kt":

```kotlin
println("Mock request start. Time:[${getTime()}]")
requestCallback(true, object : NetCallback {
    override fun onSuccess(data: String) {
        println("OnSuccess. Time:[${getTime()}] Data:[$data]")
    }

    override fun onFailure(message: String) {
        println("OnFailure. Time:[${getTime()}] Info:[$message]")
    }
})
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Mock request start. Time:[14:36:08.621]
OnSuccess. Time:[14:36:11.672] Data:[200 - OK.]
```

ğŸŸ£ ç¤ºä¾‹å…­

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `runBlocking()` æ–¹æ³•ç¼–å†™åç¨‹çš„æµ‹è¯•ä»£ç ã€‚

"TestCooperation.kt":

```kotlin
fun main() {
    runBlocking {
        // å¯åŠ¨åç¨‹åè°ƒç”¨"join()"æ–¹æ³•ï¼Œä½¿ä¸»çº¿ç¨‹ç­‰å¾…åç¨‹æ‰§è¡Œå®Œæ¯•ã€‚
        CoroutineScope(Dispatchers.Default).launch {
            println("Task start.")
            delay(2000)
            println("Task end.")
        }.join()
    }
    println("Main thread end.")
}
```

ä¸Šè¿°ä»£ç æ˜¯ç”¨äºæµ‹è¯•åç¨‹çš„å¸¸ç”¨å†™æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ `runBlocking()` åˆ›å»ºåç¨‹ç¯å¢ƒå¹¶é˜»å¡ä¸»çº¿ç¨‹ï¼Œç„¶åè¿è¡Œå¾…æµ‹è¯•çš„åç¨‹ä»»åŠ¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ `join()` æ–¹æ³•ï¼Œä½¿ `runBlocking()` æ‰€åˆ›å»ºçš„åç¨‹ç­‰å¾…å¾…æµ‹è¯•çš„æ‰§è¡Œå®Œæ¯•ã€‚

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Task start.
Task end.
Main thread end.
```

è¿™ç§æ–¹å¼ç›¸æ¯”å‰æ–‡ç¤ºä¾‹ä¸­è°ƒç”¨ `Thread.sleep()` é˜»å¡ä¸»çº¿ç¨‹æ›´ä¸ºçµæ´»ï¼Œå› ä¸ºå¾…æµ‹è¯•çš„åç¨‹ä»»åŠ¡è¿è¡Œæ—¶é•¿å¯èƒ½æ˜¯éšæœºçš„ï¼Œæ­¤æ—¶æˆ‘ä»¬æ— æ³•å¾—çŸ¥ `Thread.sleep()` çš„å‚æ•°ã€‚
