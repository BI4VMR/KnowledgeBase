# åŸºæœ¬åº”ç”¨
ä¸‹æ–‡ç¤ºä¾‹å±•ç¤ºäº†MyBatisæ¡†æ¶çš„åŸºæœ¬ç”¨æ³•ã€‚

ğŸ”´ ç¤ºä¾‹ä¸€ï¼šMyBatisçš„åŸºæœ¬åº”ç”¨ã€‚

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºMybatisæ¡†æ¶æ‰€éœ€çš„ä»£ç ä¸é…ç½®æ–‡ä»¶ï¼Œå¹¶å°è¯•ä¸SQLiteæ•°æ®åº“äº¤äº’ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¸ºå½“å‰æ¨¡å—å¼•å…¥Mybatisä¸SQLiteçš„ä¾èµ–ç»„ä»¶ï¼Œæ­¤å¤„ä»¥Mavenä¸ºä¾‹ã€‚

"pom.xml":

```xml
<dependencies>
    <!-- JDBCé©±åŠ¨(SQLite) -->
    <dependency>
        <groupId>org.xerial</groupId>
        <artifactId>sqlite-jdbc</artifactId>
        <version>3.46.0.0</version>
    </dependency>

    <!-- MyBatis -->
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>3.5.16</version>
    </dependency>

    <!-- æ—¥å¿—å·¥å…· -->
    <dependency>
        <groupId>org.slf4j</groupId>
        <artifactId>slf4j-simple</artifactId>
        <version>2.0.9</version>
    </dependency>
</dependencies>
```

`org.mybatis:mybatis` æ˜¯Mybatisçš„æ ¸å¿ƒç»„ä»¶ï¼› `org.slf4j:slf4j-simple` åˆ™æ˜¯Mybatisæ‰€ä½¿ç”¨çš„æ—¥å¿—ç»„ä»¶ï¼Œå®ƒæ˜¯å¯é€‰çš„ã€‚

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºMybatisçš„é…ç½®æ–‡ä»¶ä¸Javaä»£ç ï¼Œä¸‹æ–‡ä»£ç å—å±•ç¤ºäº†æ‰€æœ‰æ–‡ä»¶çš„ç»“æ„ï¼š

```text
Project
â””â”€â”€ src
    â””â”€â”€ main
        â”œâ”€â”€ java
        â”‚   â””â”€â”€ net.bi4vmr.study
        â”‚       â”œâ”€â”€ mapper
        â”‚       â”‚   â””â”€â”€ StudentMapper.java
        â”‚       â””â”€â”€ TestBase.java
        â””â”€â”€ resources
            â”œâ”€â”€ mappers
            â”‚   â””â”€â”€ StudentMapper.xml
            â””â”€â”€ mybatis-config.xml
```

æˆ‘ä»¬é¦–å…ˆåœ¨ `resources` ç›®å½•ä¸‹åˆ›å»ºMybatisçš„ä¸»è¦é…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ç”¨äºå£°æ˜æ•°æ®åº“è¿æ¥ä¿¡æ¯ç­‰åŸºç¡€é…ç½®ï¼Œä½¿ç”¨XMLæ ¼å¼ä¹¦å†™ï¼Œæ–‡ä»¶åç§°æ²¡æœ‰é™åˆ¶ï¼Œæ­¤å¤„æˆ‘ä»¬æŒ‰ç…§ä¹ æƒ¯å°†å…¶å‘½åä¸º `mybatis-config.xml` ã€‚

"mybatis-config.xml":

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <environments default="development">
        <!-- æ•°æ®åº“æœåŠ¡å™¨ç¯å¢ƒ -->
        <environment id="development">
            <!-- äº‹åŠ¡ç®¡ç†å™¨ -->
            <transactionManager type="JDBC"/>
            <!-- è¿æ¥ä¿¡æ¯ï¼ˆé©±åŠ¨ã€åœ°å€ã€ç”¨æˆ·åä¸å¯†ç ï¼‰ -->
            <dataSource type="POOLED">
                <property name="driver" value="org.sqlite.JDBC"/>
                <property name="url" value="jdbc:sqlite:data.db"/>
                <property name="username" value="ç”¨æˆ·åç§°"/>
                <property name="password" value="è®¤è¯å£ä»¤"/>
            </dataSource>
        </environment>
    </environments>
</configuration>
```

`<environments/>` æ ‡ç­¾ç”¨äºå£°æ˜æ•°æ®åº“ç¯å¢ƒï¼Œå…¶ä¸­çš„æ¯ä¸ª `<environment/>` æ ‡ç­¾éƒ½æ˜¯ä¸€ä¸ªç¯å¢ƒï¼Œå¿…é€‰æ ‡ç­¾ `<transactionManager/>` ç”¨äºæŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ç±»å‹ï¼› `<dataSource/>` æ ‡ç­¾åˆ™ç”¨äºæŒ‡å®šé©±åŠ¨åç§°ã€æœåŠ¡å™¨åœ°å€ã€ç”¨æˆ·åä¸å¯†ç ã€‚

æ­¤å¤„çš„ `username` å’Œ `password` å±æ€§åªæ˜¯ç¤ºä¾‹ï¼Œå¹¶æ— å®é™…ä½œç”¨ï¼Œå› ä¸ºSQLiteæ˜¯åµŒå…¥å¼æ•°æ®åº“ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ã€‚

ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºStudentMapperæ¥å£ï¼Œå®šä¹‰ä¸€äº›æ“ä½œæ•°æ®åº“çš„æŠ½è±¡æ–¹æ³•ã€‚

"StudentMapper.java":

```java
package net.bi4vmr.study.mapper;

public interface StudentMapper {

    // åˆ›å»ºæ•°æ®åº“
    void createTable();

    // æ’å…¥è®°å½•
    int insertStudent();
}
```

ç¬¬å››æ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸StudentMapperç±»å¯¹åº”çš„XMLæ–‡ä»¶ï¼Œå¹¶ä¹¦å†™StudentMapperç±»ä¸­æŠ½è±¡æ–¹æ³•éœ€è¦æ‰§è¡Œçš„SQLè¯­å¥ã€‚

"StudentMapper.xml":

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- é€šè¿‡"namespace"å±æ€§æŒ‡æ˜Mapperæ–‡ä»¶å¯¹åº”çš„Javaæ¥å£ -->
<mapper namespace="net.bi4vmr.study.mapper.StudentMapper">

    <!-- é€šè¿‡"id"å±æ€§æŒ‡æ˜Javaæ¥å£ä¸­çš„æ–¹æ³•åç§° -->
    <update id="createTable">
        CREATE TABLE IF NOT EXISTS student
        (
        student_id INTEGER PRIMARY KEY AUTOINCREMENT,
        student_name CHAR(32),
        sex CHAR(1)
        );
    </update>

    <insert id="insertStudent">
        INSERT INTO student VALUES(null, 'Test', 'ç”·');
    </insert>
</mapper>
```

`<mapper/>` æ ‡ç­¾ä¸­çš„ `namespace` å±æ€§ç”¨äºå…³è”Mapperé…ç½®æ–‡ä»¶ä¸Javaç±»ï¼Œæ­¤å¤„éœ€è¦å¡«å†™Javaç±»çš„å®Œå…¨é™å®šåç§°ã€‚

`<update/>` ã€ `<insert/>` ç­‰æ ‡ç­¾ç”¨äºå®šä¹‰SQLè¯­å¥ï¼Œå…¶ä¸­ `id` å±æ€§åº”å½“å¡«å†™Javaç±»ä¸­å¯¹åº”çš„æ–¹æ³•åç§°ã€‚

åœ¨"createTable"æ¥å£ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†åä¸º"student"çš„äºŒç»´è¡¨ï¼Œç”¨äºæè¿°å­¦ç”Ÿä¿¡æ¯ã€‚æ¯ä¸ªå­¦ç”Ÿæ‹¥æœ‰æ ‡è¯†ç¬¦ã€å§“åå’Œæ€§åˆ«ä¸‰ä¸ªå±æ€§ã€‚

åœ¨"insertStudent"æ¥å£ä¸­ï¼Œæˆ‘ä»¬å‘"student"è¡¨æ’å…¥ä¸€æ¡æ•°æ®ï¼ŒIDå¡«å†™ä¸ºç©ºå€¼ï¼Œå°†ä¼šè§¦å‘è‡ªå¢ã€‚

ç¬¬äº”æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸»è¦é…ç½®æ–‡ä»¶ä¸­æ³¨å†ŒStudentMapperé…ç½®æ–‡ä»¶ã€‚

"mybatis-config.xml":

```xml
<configuration>

    <!-- æ­¤å¤„çœç•¥å…¶ä»–é…ç½®... -->

    <mappers>
        <!-- æ³¨å†ŒStudentMapperæ–‡ä»¶ -->
        <mapper resource="mappers/StudentMapper.xml"/>
    </mappers>
</configuration>
```

ç¬¬å…­æ­¥ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ä»£ç ä¸­åŠ è½½é…ç½®æ–‡ä»¶ã€è·å–JDBCè¿æ¥å¯¹è±¡ï¼Œå¹¶è°ƒç”¨StudentMapperæ¥å£ä¸­çš„æ–¹æ³•ï¼Œä¸æ•°æ®åº“äº¤äº’ã€‚

"TestBase.java":

```java
// è·å–é…ç½®æ–‡ä»¶çš„è¾“å…¥æµ
InputStream inputStream = Resources.getResourceAsStream("mybatis-config.xml");
// è·å–JDBCä¼šè¯å·¥å‚
SqlSessionFactory sessionFactory = new SqlSessionFactoryBuilder()
        .build(inputStream);
// è·å–JDBCä¼šè¯ï¼Œå¹¶å¼€å¯äº‹åŠ¡è‡ªåŠ¨æäº¤ã€‚
SqlSession session = sessionFactory.openSession(true);
// ä¼ å…¥StudentMapperæ¥å£çš„Classæ–‡ä»¶ï¼Œè·å–ä¸€ä¸ªå®ç°ç±»ã€‚
StudentMapper mapper = session.getMapper(StudentMapper.class);
// æ‰§è¡ŒMapperæ¥å£ä¸­çš„æ–¹æ³•
mapper.createTable();
mapper.insertStudent();
mapper.insertStudent();
mapper.insertStudent();
// å…³é—­ä¼šè¯ï¼Œé‡Šæ”¾èµ„æºã€‚
session.close();
```

æˆ‘ä»¬é¦–å…ˆè·å–Mybatisä¸»è¦é…ç½®æ–‡ä»¶çš„è¾“å…¥æµï¼Œä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ„å»ºSqlSessionFactoryï¼Œå¹¶ä½¿ç”¨ `openSession()` æ–¹æ³•å¾—åˆ°SqlSessionå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±æ˜¯ç”±Mybatisåˆ›å»ºçš„JDBCä¼šè¯å¯¹è±¡ï¼Œèƒ½å¤Ÿä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚

JDBCäº‹åŠ¡é»˜è®¤ä¸ºæ‰‹åŠ¨æäº¤ï¼Œæ¯æ¬¡æ”¹å†™æ•°æ®åæˆ‘ä»¬éƒ½è¦æ‰‹åŠ¨è°ƒç”¨ `commit()` æ–¹æ³•ï¼Œæ‰ä¼šçœŸæ­£ä¿®æ”¹æ•°æ®åº“å†…å®¹ã€‚ `openSession(boolean autoCommit)` æ–¹æ³•å¯ä»¥å¼€å¯äº‹åŠ¡è‡ªåŠ¨æäº¤åŠŸèƒ½ï¼Œä½¿æˆ‘ä»¬ä¸å¿…æ‰‹åŠ¨è°ƒç”¨ `commit()` æ–¹æ³•ã€‚

SqlSessionçš„ `getMapper(Class<T> cls)` æ–¹æ³•ç”¨äºè·å–Mapperæ¥å£å®ç°ç±»çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä¼ å…¥æŸä¸ªMapperæ¥å£çš„Classå¯¹è±¡ï¼Œå³å¯è·å–å¯¹åº”çš„Mapperå¯¹è±¡ï¼Œç„¶åè°ƒç”¨Mapperå¯¹è±¡çš„æ–¹æ³•è®¿é—®æ•°æ®åº“ã€‚

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¦‚æœæ§åˆ¶å°æ²¡æœ‰å‡ºç°é”™è¯¯æ¶ˆæ¯ï¼Œè¯´æ˜Javaç¨‹åºä¸æ•°æ®åº“äº¤äº’æ­£å¸¸ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æˆ–å…¶ä»–å›¾å½¢åŒ–å·¥å…·æŸ¥çœ‹"student"è¡¨çš„å†…å®¹ï¼š

```text
sqlite> SELECT * FROM student;
student_id student_name sex
---------- ------------ ---
1          Test         ç”·
2          Test         ç”·
3          Test         ç”·
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

"student"è¡¨è¢«æˆåŠŸåˆ›å»ºäº†ï¼Œå¹¶ä¸”å…¶ä¸­æœ‰3æ¡æµ‹è¯•æ•°æ®ï¼Œè¿™ä¸Javaä»£ç ä¸­çš„é€»è¾‘æ˜¯ä¸€è‡´çš„ã€‚
