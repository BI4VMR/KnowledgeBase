# é¡ºåºæ‰§è¡Œä»»åŠ¡
çº¿ç¨‹çš„ `run()` æ–¹æ³•ä¸æ™®é€šæ–¹æ³•ç›¸åŒï¼Œå…¶ä¸­çš„è¯­å¥å°†ä¼šæŒ‰ç…§ä¹¦å†™é¡ºåºæ‰§è¡Œï¼Œå½“å‰ä¸€ä¸ªè¯­å¥æ‰§è¡Œå®Œæ¯•åï¼Œåä¸€ä¸ªè¯­å¥æ‰ä¼šå¼€å§‹æ‰§è¡Œï¼Œä»¥æ­¤ç±»æ¨ç›´åˆ°æ‰€æœ‰è¯­å¥éƒ½æ‰§è¡Œå®Œæ¯•ã€‚

ğŸ”´ ç¤ºä¾‹ä¸€

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶è°ƒç”¨ä¸¤æ¬¡ `task()` æ–¹æ³•ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰ `task(String name, long time)` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šä½¿è°ƒç”¨å®ƒçš„çº¿ç¨‹ä¼‘çœ  `time` æ¯«ç§’ï¼Œå¹¶åœ¨ä¼‘çœ å‰åå‘æ§åˆ¶å°è¾“å‡ºä¸€äº›ä¿¡æ¯ã€‚

"TestCooperation.java":

```java
static void task(String name, long time) {
    try {
        System.out.println("Task " + name + " start. Name:[" + getName() + "] Time:[" + getTime() + "]");
        Thread.sleep(time);
        System.out.println("Task " + name + " end. Name:[" + getName() + "] Time:[" + getTime() + "]");
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨ä¸¤æ¬¡ `task()` æ–¹æ³•ï¼Œå¹¶è§‚å¯Ÿæ‰§è¡Œé¡ºåºã€‚

"TestCooperation.java":

```java
Thread thread = new Thread(() -> {
    // å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡
    task("A", 2000L);
    // ç¬¬ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡ã€‚
    task("A", 2000L);
});
thread.start();
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Task A start. Thread:[Thread-0] Time:[14:55:45.261]
Task A end. Thread:[Thread-0] Time:[14:55:47.280]
Task B start. Thread:[Thread-0] Time:[14:55:47.281]
Task B end. Thread:[Thread-0] Time:[14:55:49.282]
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

çº¿ç¨‹é¦–å…ˆæ‰§è¡ŒTaskAï¼Œå½“TaskAæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œç»§ç»­æ‰§è¡ŒTaskBï¼Œä¸¤ä¸ªä»»åŠ¡æ˜¯ä¸²è¡Œå…³ç³»ã€‚

# å¹¶å‘æ‰§è¡Œä»»åŠ¡
æˆ‘ä»¬å¯ä»¥åœ¨ç°æœ‰çº¿ç¨‹ä¸­åˆ›å»ºæ–°çš„Threadå¯¹è±¡å¹¶å¯åŠ¨çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å°†ä¼šåŒæ­¥æ¨è¿›ï¼Œé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰é¡ºåºä¾èµ–å…³ç³»ã€‚

ğŸŸ  ç¤ºä¾‹äºŒ

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«è°ƒç”¨ä¸€æ¬¡ `task()` æ–¹æ³•ã€‚

"TestCooperation.java":

```java
// å®šä¹‰çº¿ç¨‹Aå¹¶å¯åŠ¨å®ƒ
Thread threadA = new Thread(() -> {
    task("A", 2000L);
});
threadA.start();

// å®šä¹‰çº¿ç¨‹Bå¹¶å¯åŠ¨å®ƒ
Thread threadB = new Thread(() -> {
    task("B", 2000L);
});
threadB.start();
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Task A start. Thread:[Thread-0] Time:[17:03:45.228]
Task B start. Thread:[Thread-1] Time:[17:03:45.228]
Task A end. Thread:[Thread-0] Time:[17:03:47.239]
Task B end. Thread:[Thread-1] Time:[17:03:47.239]
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

TaskAä¸TaskBåŒæ—¶å¯åŠ¨ã€åŒæ—¶è¿è¡Œå®Œæ¯•ï¼ŒäºŒè€…æ˜¯å¹¶è¡Œæ¨è¿›çš„ï¼Œæ²¡æœ‰ç›¸äº’ç­‰å¾…ã€‚

# ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆ
ç°æœ‰ä¸€ä¸ªæ•°æ®åˆ†æç¨‹åºï¼Œéœ€è¦ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå¯åŠ¨åˆ†æå™¨è¿›è¡Œåˆ†æï¼›åˆ†æå™¨éœ€è¦ä¸€å®šçš„åˆå§‹åŒ–æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯çº¿ç¨‹Aè¯»å–æ•°æ®ï¼Œå¼€å¯çº¿ç¨‹Båˆå§‹åŒ–åˆ†æå™¨ï¼Œå¹¶ä½¿å¾—çº¿ç¨‹Bç­‰å¾…çº¿ç¨‹Aå®Œæˆï¼Œå†è¿›è¡Œæ•°æ®åˆ†æã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹é¡ºåºæ‰§è¡Œè¯»å–æ•°æ®ã€åˆå§‹åŒ–åˆ†æå™¨ã€åˆ†ææ•°æ®ï¼Œä½†æ­¤å¤„çš„åˆå§‹åŒ–åˆ†æå™¨ä¸ä¾èµ–æ•°æ®ï¼Œåˆ†ææ•°æ®åˆ™ä¾èµ–äºæ•°æ®ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶å¹¶è¡Œåˆå§‹åŒ–å‡å°‘äº†ä»»åŠ¡çš„æ•´ä½“è€—æ—¶ï¼Œèƒ½å¤Ÿæå‡ç”¨æˆ·ä½“éªŒã€‚

æˆ‘ä»¬å¯ä»¥åœ¨çº¿ç¨‹Açš„ä½œç”¨åŸŸå†…ï¼Œè°ƒç”¨çº¿ç¨‹Bå¯¹è±¡çš„ `join()` æ–¹æ³•ï¼Œä½¿çº¿ç¨‹Aé˜»å¡ï¼›ç­‰åˆ°çº¿ç¨‹Bæ‰§è¡Œå®Œæ¯•åï¼Œçº¿ç¨‹Aè§£é™¤é˜»å¡å¹¶ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚

`join(long millis)` æ–¹æ³•æ˜¯ `join()` æ–¹æ³•çš„é‡è½½æ–¹æ³•ï¼Œå‰è€…çš„åŠŸèƒ½åè€…ç›¸åŒï¼Œä½†é¢å¤–è®¾ç½®äº†è¶…æ—¶æ—¶é—´ã€‚å¦‚æœç­‰å¾…æ—¶é•¿åˆ°è¾¾è¶…æ—¶æ—¶é—´åï¼Œçº¿ç¨‹Bä»æœªæ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹Aå°±ä¼šè‡ªåŠ¨å”¤é†’ï¼Œä¸å†ç»§ç»­ç­‰å¾…ã€‚

ğŸŸ¡ ç¤ºä¾‹ä¸‰

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ï¼Œå¹¶ä½¿ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ä»»åŠ¡å®Œæˆã€‚

"TestCooperation.java":

```java
System.out.println("Task root start.");
// å®šä¹‰çº¿ç¨‹Aå¹¶å¯åŠ¨å®ƒ
Thread threadA = new Thread(() -> {
    task("A", 2000L);
});
threadA.start();

try {
    // åœ¨å½“å‰çº¿ç¨‹ä¸­è°ƒç”¨çº¿ç¨‹Açš„"join()"æ–¹æ³•ï¼Œç­‰å¾…çº¿ç¨‹Aç»“æŸå†ç»§ç»­è¿è¡Œã€‚
    threadA.join();
    System.out.println("Task root end.");
} catch (Exception e) {
    e.printStackTrace();
}
```

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Task root start.
Task A start. Time:[09:58:54.416]
Task A end. Time:[09:58:56.433]
Task root end.
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

ä¸»çº¿ç¨‹TaskRootè°ƒç”¨å­çº¿ç¨‹TaskAçš„ `join()` æ–¹æ³•åï¼ŒTaskRootè¿›å…¥é˜»å¡çŠ¶æ€ï¼›ç›´åˆ°å­çº¿ç¨‹è¿è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹æ‰æ¢å¤è¿è¡Œå¹¶è¾“å‡º"Task Root end."æ¶ˆæ¯ã€‚

# è·å–å…¶ä»–ä»»åŠ¡çš„ç»“æœ
æœ‰æ—¶æˆ‘ä»¬ä¸ä»…éœ€è¦ç­‰å¾…æŸä¸ªä»»åŠ¡å®Œæˆï¼Œè¿˜éœ€è¦è·å–è¯¥ä»»åŠ¡çš„ç»“æœï¼Œå¹¶åœ¨åç»­æ“ä½œä¸­ä½¿ç”¨è¯¥ç»“æœï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨FutureTaskã€‚

ğŸŸ¢ ç¤ºä¾‹å››

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ï¼Œå¹¶ä½¿ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ä»»åŠ¡å®Œæˆï¼Œå¹¶è·å–å­çº¿ç¨‹çš„ç»“æœã€‚

"TestCooperation.java":

```java
System.out.println("Task Root start.");
// å®šä¹‰FutureTask
FutureTask<Integer> task = new FutureTask<Integer>(new Callable() {
    @Override
    public Integer call() throws Exception {
        task("A", 2000);
        return 114514;
    }
});
// é€šè¿‡FutureTaskåˆ›å»ºçº¿ç¨‹
Thread threadA = new Thread(task);
// å¯åŠ¨çº¿ç¨‹ï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚
threadA.start();

try {
    // å¼‚æ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¹¶æ¥æ”¶è¿”å›å€¼ã€‚
    int result = task.get();
    System.out.println("Task Root end, task A result is " + result + ".");
} catch (Exception e) {
    e.printStackTrace();
}
```

`FutureTask<T>` æ˜¯ä¸€ç§å¯ä»¥è¿”å›ç»“æœçš„ä»»åŠ¡ï¼Œæ³›å‹ç±»å‹ `T` å³ç»“æœçš„æ•°æ®ç±»å‹ï¼›æŠ½è±¡æ–¹æ³• `T call()` æ˜¯å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿”å›å€¼ç±»å‹ä¸FutureTaskç±»çš„æ³›å‹å‚æ•°ä¸€è‡´ã€‚

FutureTaskå¯ä»¥é€šè¿‡Threadç±»çš„æ„é€ æ–¹æ³•ä¸çº¿ç¨‹å…³è”ï¼Œå½“çº¿ç¨‹å¼€å§‹è¿è¡Œåï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨FutureTaskå¯¹è±¡çš„ `T get()` æ–¹æ³•è·å–ä»»åŠ¡ç»“æœã€‚å½“æˆ‘ä»¬è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå¦‚æœå­çº¿ç¨‹TaskAå°šæœªå®Œæˆï¼Œä¸»çº¿ç¨‹TaskRootå°±ä¼šé˜»å¡ï¼Œç›´åˆ°TaskAå®Œæˆå¹¶è¿”å›ç»“æœã€‚å¦‚æœæˆ‘ä»¬è°ƒç”¨è¯¥æ–¹æ³•æ—¶TaskAå·²ç»å®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœï¼Œä¸ä¼šå¯¼è‡´è°ƒç”¨è€…è¢«é˜»å¡ã€‚

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Task root start.
Task A start. Thread:[Thread-0] Time:[09:58:54.416]
Task A end. Thread:[Thread-0] Time:[09:58:56.433]
Task root end.
```

æ ¹æ®ä¸Šè¿°è¾“å‡ºå†…å®¹å¯çŸ¥ï¼š

ä¸»çº¿ç¨‹TaskRootè°ƒç”¨å­çº¿ç¨‹TaskAæ‰€å…³è”çš„FutureTaskå¯¹è±¡çš„ `get()` æ–¹æ³•åï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼›ç›´åˆ°TaskAè¿è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹æ‰æ¢å¤è¿è¡Œå¹¶è¾“å‡º"Task Root end."æ¶ˆæ¯ã€‚

# åˆå¹¶å¤šä¸ªä»»åŠ¡çš„ç»“æœ
ç°æœ‰ä¸€ä¸ªæ–°é—»é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦è¯·æ±‚â€œçƒ­ç‚¹äº‹ä»¶â€ä¸â€œå¹¿å‘Šæ¨èâ€ä¸¤ä¸ªç½‘ç»œæ¥å£çš„æ•°æ®ï¼Œæœ€ç»ˆç»„åˆä¸ºå•ä¸ªæ•°æ®æºå¹¶æ›´æ–°æ–°é—»åˆ—è¡¨ã€‚ä¸€ä¸ªè¾ƒä¸ºç›´è§‚çš„å®ç°æ–¹æ³•æ˜¯ï¼šé¦–å…ˆè¯·æ±‚â€œçƒ­ç‚¹äº‹ä»¶â€æ•°æ®ï¼Œå½“è¯¥è¯·æ±‚çš„å›è°ƒè§¦å‘åå†è¯·æ±‚â€œå¹¿å‘Šæ¨èâ€æ•°æ®ï¼Œç­‰åˆ°è¯¥è¯·æ±‚å›è°ƒè§¦å‘æ—¶åˆå¹¶äºŒè€…çš„ç»“æœã€‚è¿™ç§æ–¹æ³•ç¡®å®èƒ½å¤Ÿå®ç°åŠŸèƒ½ï¼Œä½†å¼•å…¥äº†ä¸å¿…è¦çš„æ—¶å»¶ï¼Œå‡è®¾æ¯ä¸ªè¯·æ±‚ç”¨æ—¶2ç§’ï¼Œæ€»è®¡éœ€è¦4ç§’æ‰èƒ½å®Œæˆä»»åŠ¡ã€‚

ç”±äºä¸¤ä¸ªç½‘ç»œè¯·æ±‚æ˜¯ç‹¬ç«‹çš„ï¼Œç›¸äº’ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `async()` æ–¹æ³•å¼€å¯å­åç¨‹åˆ†åˆ«è¿›è¡Œè¯·æ±‚ï¼Œç„¶ååœ¨çˆ¶åç¨‹ä¸­è°ƒç”¨å®ƒä»¬çš„ `await()` æ–¹æ³•ç­‰å¾…ç»“æœè¿”å›ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿå°†æ€»è€—æ—¶ä»4ç§’å‡å°‘åˆ°2ç§’ï¼Œæé«˜äº†ç¨‹åºçš„å¹¶è¡Œåº¦ï¼Œæœ‰åˆ©äºæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚

ğŸ”µ ç¤ºä¾‹äº”

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡FutureTaskå®šä¹‰ä¸¤ä¸ªå¹¶è¡Œä»»åŠ¡ï¼Œå¹¶ä½¿ä¸»çº¿ç¨‹ç­‰å¾…å®ƒä»¬å®Œæˆï¼Œæœ€ååˆå¹¶äºŒè€…çš„ç»“æœã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†å‰æ–‡â€œç¤ºä¾‹å››â€ä¸­çš„FutureTaskä»»åŠ¡æå–ä¸ºç±»ï¼Œä»¥ä¾¿åç»­åˆ›å»ºå¤šä¸ªFutureTaskå®ä¾‹ã€‚

"TestCooperation.java":

```java
class MyTask implements Callable<Integer> {

    private final String name;

    public MyTask(String name) {
        this.name = name;
    }

    @Override
    public Integer call() {
        task(name, 2000);
        return 114514;
    }
}
```

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªFutureTaskä¸Threadå®ä¾‹ï¼Œå¹¶è°ƒç”¨FutureTaskå¯¹è±¡çš„ `get()` æ–¹æ³•ç­‰å¾…ç»“æœè¿”å›ã€‚

"TestCooperation.java":

```java
// åˆ›å»ºä¸¤ä¸ªFutureTaskå®ä¾‹
FutureTask<Integer> taskA = new FutureTask<>(new MyTask("A"));
FutureTask<Integer> taskB = new FutureTask<>(new MyTask("B"));

// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«å…³è”ä¸Šè¿°çš„ä¸¤ä¸ªFutureTaskå®ä¾‹ã€‚
Thread threadA = new Thread(taskA);
Thread threadB = new Thread(taskB);

// å¯åŠ¨çº¿ç¨‹ï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚
threadA.start();
threadB.start();

try {
    // å¼‚æ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¹¶æ¥æ”¶è¿”å›å€¼ã€‚
    int result = taskA.get() + taskB.get();
    System.out.println("All task is end, summary is " + result + ".");
} catch (Exception e) {
    e.printStackTrace();
}
```

TaskAä¸TaskBçš„ `get()` æ–¹æ³•éƒ½ä¼šå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œå› æ­¤ä»…å½“ä¸¤ä¸ªä»»åŠ¡éƒ½è¿è¡Œå®Œæ¯•åï¼Œä¸»çº¿ç¨‹æ‰ä¼šè§£é™¤é˜»å¡å¹¶è®¡ç®—ä¸¤ä¸ªè¿”å›å€¼ä¹‹å’Œã€‚

æ­¤æ—¶è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼š

```text
Task A start. Thread:[Thread-0] Time:[17:49:29.807]
Task B start. Thread:[Thread-1] Time:[17:49:29.808]
Task A end. Thread:[Thread-0] Time:[17:49:31.823]
Task B end. Thread:[Thread-1] Time:[17:49:31.823]
All task is end, summary is 229028.
```

# ç¤¼è®©
æˆ‘ä»¬å¯ä»¥åœ¨çº¿ç¨‹ä½œç”¨åŸŸå†…è°ƒç”¨Threadç±»çš„é™æ€æ–¹æ³• `yeild()` ï¼Œä½¿å½“å‰çº¿ç¨‹å›åˆ°â€œå°±ç»ªâ€çŠ¶æ€ï¼Œè®©å‡ºCPUèµ„æºã€‚

è¯¥åŠŸèƒ½ä½¿ç”¨åœºæ™¯è¾ƒå°‘ï¼Œå½“çº¿ç¨‹è®©å‡ºCPUèµ„æºåï¼Œå°†ä¼šé‡æ–°è¿›å…¥å°±ç»ªé˜Ÿåˆ—ç­‰å¾…æ§åˆ¶å™¨è°ƒåº¦ï¼›æ­¤æ—¶è¯¥çº¿ç¨‹ä¹Ÿæœ‰å¯èƒ½ç«‹åˆ»è¢«é‡æ–°è°ƒåº¦ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚
